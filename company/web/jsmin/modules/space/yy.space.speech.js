var editorObj=null;var replayface=null;(function(e){var f=null;var c=0;var d=function(g){this.text=g.text;this.content=g.content;this.selectfun=g.select;this.load=g.load;this.search=g.search;this.sPos=g.position;this.dPos="";this.option=g;this.currentEle=null;this.editor=g.editor;if(this.type!="autoThink"){this.bind()}this.isSelect=false};d.prototype.show=function(){if(this.editor){this.editor.closeEvent();this.isSelect=true}$("ul[role=listbox]").hide();$(this.content).show()};d.prototype.easySelect=function(g){if(this.isSelect&&g==38){return true}return false};d.prototype.hide=function(){if(this.editor){this.editor.openEvent();this.isSelect=false}$("ul[role=listbox]").hide()};d.prototype.select=function(g){this.selectfun(g,this)};d.prototype.position=function(i){var h=this.sPos||{height:0,width:-1},m=i.offset(),g=i.css("height").replace("px",""),k=0,j=0;if(this.editor){if(this.editor.type=="replayEditor"){k=h.height+m.top;j=h.width+m.left}else{this.dPos=this.editor.cursorPosition();k=this.dPos.top+h.height+$(document).scrollTop();j=this.dPos.left+h.width}}else{k=this.dPos.top+h.height;j=this.dPos.left+h.width}$(this.content).css({top:k,left:j})};d.prototype.bind=function(){var g=this;var h=function(j){var k='<a class="ya_contentA icoHt" tabindex="-1" category="45" for="<%=url%>%<%=name%>%" default="<%=name%>" ele_role="need"><span class="block"><%=name%></span></a>',i=YY.util.url("/topic/topic/convs/topic_id/");return k.format({name:j,url:i})};$(this.content).click(function(m){var n="",o=m.target,j=$(o).closest("li"),n=$(j).html(),i=$(o);if($(o).closest(".yy_onenew_topic").length>0){i=$(o).closest(".yy_onenew_topic")}else{i=$(o)}if(i.hasClass("yy_onenew_topic")){var k=i.find("#yy_create_topic").text().substr(1);n=h(k)}g.select(n);g.hide()});$(this.text).live("keyup",function(k){var n=k.keyCode,i=$(k.target);if(g.easySelect(n)&&g.editor){if($(g.content).find("#yy_create_topic").length==0){var o=$(g.content).find("#auto_content_list").find("li").first().html();g.select(o);g.hide();return}else{var o=$(g.content).find("#yy_create_topic").html().substr(1);g.select(h(o));g.hide();return}}g.$target=i;g.currentEle=i;if(!YY.util.keyEnable(n)){return true}g.dPos=$(this).offset();var j="";j=i.html();if(i[0].tagName=="INPUT"||i[0].nodeName=="INPUT"){j=i.val()}var m=g.search(j,g);i.trigger("barPrecess",[m,i])});$(this.text).live("barPrecess",function(n,o,i,m){if(f!=null){f.abort()}if(!o){g.hide();return}var k=o;o=encodeURIComponent(o);var j=YY.util.url("/common/search/index?term="+o);f=YY.util.ajax({url:j,success:function(p){f=null;if(!p&&k.indexOf("@")>-1){g.hide();return}g.load(p,g,o.substr(3));if(g.type=="autoThink"){}else{if(m){g.content=m}else{if(k.indexOf("@")>-1){if(g.text==".yy-contentDiv"){g.content="#auto_content_replay"}else{g.content="#auto_content"}}else{if(g.text==".yy-contentDiv"){return}else{g.content="#auto_content_topic"}}}}g.position(i);g.show()}})});$(document).click(function(j){var k=j.target,i=$(k).closest("div[id=window]").length;if(i<1){g.hide()}})};var b=function(g){this.type="autoThink";b.superclass.constructor.call(this,g);this.render();this.bind()};YY.util.extend(b,d);$.extend(b.prototype,{getEleId:function(){return"_yy"+(c++)},render:function(){var g=$("#auto_ship_code1").html();if(!!g){this.IdSet={};var h=this.getEleId();this.IdSet.shipId="ship"+h;this.content="#"+this.IdSet.shipId;$(".ya_tkBox").append(g.format(this.IdSet))}}});var a=function(g){this.type="autoForInput";this.editor=g.editor;this.option=g;this.eleId=this.getId();this.editorDom="";this.select=g.select;this.itemTemplate=$(g.itemTemplate).html();this.render();this.bind();this.data=""};YY.util.extend(a,d);a.prototype.bind=function(){var g=this;$(this.editor).live("keyup",function(i){if(f!=null){f.abort()}var k=g.editorDom=i.target;var j=$(k).val();var h=YY.util.url(g.option.url+j);f=YY.util.ajax({url:h,success:function(p){f=null;var o="";for(var n=0,m=p.length;n<m;n++){o=o+g.makeOne(p[n])}g.data=p;g.fillList(o);g.show()}})});$("#"+this.listId).find("li").live("click",function(o){var h=$(this);var p=h.find("a").attr("member_id");var n="";for(var m=0,k=g.data.length;m<k;m++){n=g.data[m];if(n.value==p){break}}g.select(n,g)})};a.prototype.makeOne=function(g){if(!this.itemTemplate){return}return this.itemTemplate.format(g)};a.prototype.fillList=function(g){$("#"+this.listId).html(g)};a.prototype.show=function(){this.position();$("#"+this.contentId).show()};a.prototype.position=function(){var g=$(this.editorDom).offset();g.top=g.top+$(this.editorDom).height()+6;$("#"+this.contentId).css(g)};a.prototype.render=function(){var g=$("#yy_autoForInput").html();this.contentId="content"+this.eleId;this.listId="list"+this.eleId;if(!!g){g=g.format({contentId:this.contentId,listId:this.listId});$(".ya_tkBox").first().append(g)}};a.prototype.getId=function(){return this.type+$.getId()};e.autoForInput=a;e.autoThink=b;e.autocomplete=d})(window);var coreFun={showForSpeech:"请输入#选择主题",addNotice:function(a){a.find("div[contenteditable=true]").find("a").each(function(){$(this).attr("href",$(this).attr("for"));if($(this).attr("category")==10){var b='<input type="hidden" value="<%=id%>" ele-role="member-id" name="atperson[]"></input>';var c=$(this).attr("member_id");a.append(b.format({id:c}))}})},getArgument:function(c){var b=document.location.href,a=b.lastIndexOf(c),d="";if(a<0){return}d=b.substring(a,b.length);return d.split("/")[1].replace("#","")},directeAt:function(){var c=this.getArgument("joinuser"),b=this.getArgument("juname"),a="/space/cons/index/id/<%=id%>";html='<a class="ya_contentA iconY_01" ele_role="need" tabindex="-1" category="10" for="<%=url%>" default="<%=name%>" member_id="<%=id%>"><%=name%></a>&nbsp;';if(!c){return}a=YY.util.url(a);a=a.format({id:c});html=html.format({id:c,name:decodeURI(b),url:a});$("#content_div").html(html);this.showForSpeech=html;this.fouseEnd()},directeShap:function(){var c=this.getArgument("topic_id"),b="/topic/topic/convs/topic_id/<%=id%>",a=$("#yy_topicDetial_title").html();if(!c){return}b=YY.util.url(b);b=b.format({id:c});html=this.buildTopic({id:c,name:decodeURI(a),url:b});$("#content_div").html(html);this.fouseEnd()},gTopic:function(b){var a="/topic/topic/convs/topic_id/<%=id%>";a=a.format({id:b.id});html=this.buildTopic({id:b.id,name:decodeURI(b.name),url:a});$("#content_div").html(html)},deleTarget:function(d){var a=this;var c=$(d);c.find(".child").each(function(e,f){while(!$(this).parent().is(c)){$(this).unwrap()}});if(c.html().indexOf("\n")!==-1){c.html(c.html().replace("\n",""))}var b="";c.children().each(function(e,f){if($(f).attr("ele_role")=="need"){return}if($(f).is("br")){return}if($(f).css("display")==="block"){if($.browser.webkit){$(f).before("<br />")}else{if(e>0){$(f).before("<br />")}}}$(f).replaceWith(a.deleTarget(f).html())});c.trigger("valueChange");return c},paste:function(b){var a=$(b);this.deleTarget(b);a.trigger("cursorChange")},buildTopic:function(b){var a='<a class="ya_contentA icoHt" tabindex="-1" category="45" for="<%=url%>" default="<%=name%>" ele_role="need"><span class="block"><%=name%></span></a>';return a.format(b)},fouseEnd:function(){editorObj.focusEnd();editorObj.rememberCurrentRange();$("#content_div").blur()},autoLoadTeam:function(g){var d="";var h=[['<span class="iconY_01 tkIcoBox "></span>'],['<li class="tline" style="height:0px"></li><span class="iconY_02 tkIcoBox "></span>'],['<li class="tline" style="height:0px"></li><span class="iconY_03 tkIcoBox "></span>'],['<li class="tline" style="height:0px"></li><span class="iconY_04 tkIcoBox "></span>'],['<li class="tline" style="height:0px"></li><span class="iconY_05 tkIcoBox "></span>'],['<li class="tline" style="height:0px"></li><span class="iconY_06 tkIcoBox "></span>'],['<li class="tline" style="height:0px"></li><span class="iconY_07 tkIcoBox "></span>'],["热门主题："],['<li style="height:0px" class="tline"></li>热门话题：']];function e(p,i){if(i==2){var m=[],o=[]}var j=$("#auto_category_list").html(),n=j.split("_|_"),i=i||0;tempOne=n[i];var k=p.other3;if(k.length>15){p.other3=k.substring(0,15)+"..."}return tempOne.format(p)}if(g){for(var c=0,a=g.length;c<a;c++){var b=g[c],f=b.category;b.value=YY.util.url(b.value);switch(parseInt(f)){case 10:h[0].push(e(b));break;case 40:h[1].push(e(b,1));break;case 50:h[2].push(e(b,1));break;case 25:h[3].push(e(b,1));break;case 35:h[4].push(e(b,1));break;case 65:h[5].push(e(b,1));break;case 3233:h[6].push();break;case 45:if(b.other1==1){h[7].push(e(b,2));break}else{h[8].push(e(b,2));break}}}for(var c=0,a=h.length;c<a;c++){if(h[c].length>1||(c==7&&h[c].length>2)){d+=h[c].join("")}}}else{d="无相关话题。"}return d},addTopicFor:function(a){a.each(function(){var c=$(this),d=$(this).find(".yj-tag-name").attr("data"),b=$(this).find(".yj-tag-name").html();exp=/^(0|[1-9]\d*)$/;if(exp.test(d)){c.closest("ol").append("<input type='hidden' value='"+d+"' name='topicIsId[]'>")}else{c.closest("ol").append("<input type='hidden' value='"+b+"' name='topicIsStr[]'>")}})}};window.face=function(a){this.selector=a.selector;this.trigger=a.trigger;this.toEle=a.toElement;this.editor=a.editor;this.relative=a.relative;this.bind()};face.prototype.hide=function(){$("#yy_face_show").hide()};face.prototype.show=function(){$("#yy_face_show").show()};face.prototype.bind=function(){var a=this;$(this.trigger).live("click",function(b){var c=b.target;$target=$(c);var d=$target.offset();$("#yy_face_show").css({top:d.top+20,left:d.left});$("#yy_face_show").toggle();a.editor.resetDom($target.closest("form"))});$("#yy_face_show").find("li").live("click",function(e){var f=e.target,c=$(this).find("img").parent().html(),d=a.editor.resume();if(a.relative){a.editor.resetDom($(f).closest(a.relative))}if($.browser.msie&&$.browser.version<"9.0"&&!a.relative){var b=c.lastIndexOf(" ");c=c.substring(0,b)}var g=a.editor.insertHtmlAtCaret(c+"&nbsp;",d);if(g){a.editor.focusNodeAfter(g)}a.editor.setFocus();a.editor.rememberCurrentRange();a.editor.countWord();a.hide()})};window.speeh_face=function(a){speeh_face.superclass.constructor.call(this,a);this.type="speeh_space"};YY.util.extend(speeh_face,face);speeh_face.prototype.bind=function(){var a=this;$(this.trigger).live("click",function(b){var c=b.target;$relative=$(c).closest(a.relative);if(a.relative){$relative.find(a.selector).toggle()}else{$(a.selector).toggle()}});$(this.selector).find("li").live("click",function(e){var f=e.target,c=$(this).find("img").parent().html(),d=a.editor.resume();if(a.relative){a.editor.resetDom($(f).closest(a.relative))}if($.browser.msie&&$.browser.version<"9.0"&&!a.relative){var b=c.lastIndexOf(" ");c=c.substring(0,b)}var g=a.editor.insertHtmlAtCaret(c+"&nbsp;",d);if(g){a.editor.focusNodeAfter(g)}a.editor.setFocus();a.editor.rememberCurrentRange();a.editor.countWord();a.hide()})};speeh_face.prototype.hide=function(){$(this.selector).hide()};speeh_face.prototype.show=function(){$(this.selector).show()};window.editor=function(a){var b={selector:""};this.type="editor";a=a||{};a=$.extend(b,a);this.keyWord=[{target:"@",content:"#auto_content"},{target:"#",content:"#auto_content_topic"}];this.target=this.keyWord[0]["target"];this.prevRange=null;this.$dom=$(a.selector);this.selector=a.selector;this.dom=this.$dom[0];this.isOpen=true};editor.prototype={closeEvent:function(){this.isOpen=false},openEvent:function(){this.isOpen=true},isInput:function(a){if(!this.isOpen&&a==38){return false}return true},constructor:editor,rememberCurrentRange:function(){return this.prevRange=this.cloneRange()||null},resetDom:function(a){this.$dom=a.find(this.selector);this.dom=this.$dom[0]},cloneRange:function(){var a,b;if(window.getSelection){a=window.getSelection();b=a.getRangeAt(0);return b.cloneRange()}a=document.selection;b=a.createRange();return b.duplicate()},resume:function(a){var c=a||this.prevRange,b;if(window.getSelection){b=window.getSelection();b.removeAllRanges();b.addRange(c);return c}c.select();return c},cursorChange:function(){this.$dom.trigger("cursorChange")},dealRange:function(c){var d=c||this.prevRange,e=d.endContainer,b=d.endOffset,a=e.textContent.lastIndexOf("@");e.textContent=e.textContent.substring(0,a-1)},focusEnd:function(a){a=a||this.dom;if(document.selection){var c=document.body.createTextRange();c.moveToElementText(a);c.collapse(false);c.select();return}var b=window.getSelection();b.removeAllRanges();var c=document.createRange();c.selectNodeContents(a);c.collapse(false);b.addRange(c)},insertNode:function(d){var b,c;if(window.getSelection){b=window.getSelection();c=b.getRangeAt(0);b.addRange(c);c.insertNode(d);c.collapse(false);return}b=document.selection;c=b.createRange();var a=d.outerHTML||d.nodeValue;c.pasteHTML(a)},createDom:function(a){var b=document.createElement("div");b.innerHTML=a;return b},bind:function(){var a=this;$(this.selector).live({cursorChange:function(c){var b=a.rememberCurrentRange()},valueChange:function(b){a.countWord();a.focusEnd(b.target)},blur:function(){},click:function(){var b=$(this);b.css("min-height","40px");b.css("height","auto");b.closest("form").find("#upload-div").slideDown();if(b.html()=="请输入#选择主题"){b.html("")}},keydown:function(c){var b=c.keyCode;if(!a.isInput(b)){return false}},keyup:function(c){var b=c.keyCode;$(this).closest("form").find("#savesubmit").removeAttr("disabled").removeClass("darkGrayButton").addClass("new_orgBut");if(b!=8&&b!=46){$(this).find("a").each(function(){if($(this).attr("default")!=$(this).html()){$(this).html($(this).attr("default"));a.focusNodeAfter(this)}})}else{$(this).find("a").each(function(){if($(this).attr("default")!=$(this).html()){var e=$(this),d=e.parent();e.remove();if($.browser.mozilla&&d.html()==""){d.html("<br>")}}})}a.$dom.trigger("cursorChange");a.countWord();if($.browser.msie&&$.browser.version<"9.0"&&c.keyCode==13){a.rememberCurrentRange()}}});$(this.selector).ctrlEnter(function(b){$(this).closest("form").submit()})},getSelection:function(){if(window.getSelection){return window.getSelection()}return document.selection},getRange:function(a){if(a.getRangeAt){return a.getRangeAt(0)}return a.createRange()},createRange:function(){if(document.createRange){return document.createRange()}var a=this.getSelection();return a.createRange()},countWord:function(){var b=this.$dom.html();if(!b){$(".yy-font-num").html("210");return}b=b.replace(/<a[^>]*>/gi,"").replace(/<\/a[^>]*>/gi,"").replace(/[\u4E00-\u9FA5]/gi,"!!").replace(/\<img[\s\S]*?\/?\>/ig,"!!!!").replace(/<br[^>]*>/gi,"").replace(/\&nbsp;/gi," ");var a=210-Math.floor(b.length/2);$(".yy-font-num").html(a)},focusNodeAfter:function(d,a){var b=this.getSelection();if(b.removeAllRanges){b.removeAllRanges()}var c=this.createRange(b);if($.browser.safari){var e=d.nextSibling;if(!e||e.targetName=="BR"){e=document.createTextNode("\xa0")}$(d).after(e);d=e}if(c.setStartAfter&&c.setEndAfter){c.setStartAfter(d);c.setEndAfter(d);b.addRange(c);return}d=a?a:d;c.moveToElementText(d);c.select();c.collapse(false)},focusNodeBefore:function(c){var a=this.getSelection();if(a.removeAllRanges){a.removeAllRanges()}var b=this.createRange(a);if(b.setStartAfter){b.setStartBefore(c);b.setEndBefore(c);a.addRange(b);return}c=ieNode?ieNode:c;b.moveToElementText(c);b.select();b.collapse(true)},rangeFocus:function(d,a){a=a||0;var b=this.getSelection();if(b.removeAllRanges){b.removeAllRanges()}var c=this.createRange(b);if(c.setStart){c.setStart(d,a);c.setEnd(d,a);b.addRange(c);return}c.moveToElementText(d);c.select();c.collapse(false)},setFocus:function(a){a=a||{};try{this.$dom.focus();if(a.focusEnd){this.focusEnd()}if(a.rememberCurrentRange){this.rememberCurrentRange()}}catch(b){}},chooseOne:function(e,a){var f=document.createElement("div");f.innerHTML=e;var d=$(f).find("a");var e=d.find("span").first().html(),c=d.attr("category");d.html(e);switch(parseInt(c)){case 10:d.attr("class","ya_contentA iconY_01");break;case 40:d.attr("class","ya_contentA new_icoqt");break;case 50:d.attr("class","ya_contentA yyIco02");break;case 25:d.attr("class","ya_contentA iconY_04");break;case 35:d.attr("class","ya_contentA iconY_05");break;case 65:d.attr("class","ya_contentA tp_ico");break;case 3233:d.attr("class","ya_contentA new_icoqt");break;case 45:d.attr("class","ya_contentA icoHt");break}$(f).html(d);$(f).find("span").remove();var b=$(f).find("a")[0];return b},insertHtmlAtCaret:function(b,a){var f,a;if(window.getSelection){f=window.getSelection();if(f.getRangeAt&&f.rangeCount){a=a;a.deleteContents();var c=document.createElement("div");c.innerHTML=b;var g=document.createDocumentFragment(),e,d;while((e=c.firstChild)){d=g.appendChild(e)}a.insertNode(g);if(d){a=a.cloneRange();a.setStartAfter(d);a.collapse(true);f.removeAllRanges();f.addRange(a)}return d}}else{if(document.selection&&document.selection.type!="Control"){document.selection.createRange().pasteHTML(b)}}},barBind:function(){var a=this;function b(c){}$("#notice_trigger").live("click",function(){$target=$(this).closest("form").find("div[contentEditable=true]");var c="@";a.target=c;a.insetText(c,$target)});$("#topic_btn").live("click",function(){$target=$(this).closest("form").find("div[contentEditable=true]");var c="#";a.target=c;a.insetText(c,$target)});$(".topic_for_not").live("click",function(){$(this).closest("#upload-div").find(".yy-feedTopicDiv").toggle()});$("#yy_updateVideo_s").live("click",function(){$(this).parent().find(".yy_videoLink_s").toggle()});$("#yy_closeVLink_s").live("click",function(){$(this).closest(".yy_videoLink_s").toggle()});$("#yy_linkInput_s").live("blur",function(){var c=YY.util.url("/file/act/ajaxvideo"),e=$(this),d=e.val();YY.util.ajax({url:c,success:function(f){if(!f||f.videoPic==""){$.yy.rscallback("请输按照说明填写正确的视屏地址。",1)}else{e.closest(".yy_videoLink_s").find("#yy_miniPic_s").attr("src",f.videoPic)}},type:"POST",dataType:"json",data:{posturl:d,ajaxsubmit:1}})})},insetText:function(f,b,d){var c=this.resume();if(window.getSelection){var a=document.createTextNode(f);this.insertNode(a);this.rangeFocus(a,f.length);this.setFocus({rememberCurrentRange:true});this.$dom.trigger("barPrecess",[f,b]);return}c.pasteHTML(f);var e=c.parentElement();var g=this.selected(e).start;this.getSearch($(e).html(),g);this.setFocus({rememberCurrentRange:true});this.$dom.trigger("barPrecess",[f,b,d]);return},selected:function(e){e=e||this.dom;var a=0,f=0;if(typeof(e.selectionStart)=="number"){f=e.selectionStart;a=e.selectionEnd}else{if(document.selection){var b=document.selection.createRange();if(b.parentElement().id==e.id){var c=document.body.createTextRange();c.moveToElementText(e);for(f=0;c.compareEndPoints("StartToStart",b)<0;f++){c.moveStart("character",1)}for(var d=0;d<=f;d++){if($(e).html().charAt(d)=="/n"){f++}}var c=document.body.createTextRange();c.moveToElementText(e);for(a=0;c.compareEndPoints("StartToEnd",b)<0;a++){c.moveStart("character",1)}for(var d=0;d<=a;d++){if($(e).html().charAt(d)=="/n"){a++}}}}}return{start:f,end:a}},getSearchForIE:function(c,f){c=c.replace(/\<img[\s\S]*?\/?\>/ig,"!").replace("&nbsp;"," ").replace(/<[a][^>]*>/ig,"!").replace(/<\/[a][^>]*>/ig,"!").replace(/<br>/ig,"!");c=c.substring(0,f);var e=c.lastIndexOf(" "),b=c.lastIndexOf("@"),d=c.lastIndexOf("#");f=e<f?f:e;b=d>b?d:b;if(d>1){b=d;this.target="#"}else{this.target="@"}if(b>=0){this.IEStart=b;this.IEEnd=f;return c.substr(b,f)}return""},removeAt:function(b){b.moveToElementText(b.parentElement());var a=b;a.collapse(true);a.moveStart("character",this.IEStart);a.moveEnd("character",this.IEEnd-this.IEStart);a.select();a.text="";this.setFocus();this.rememberCurrentRange()},getSearch:function(){var i={},g=this.keyWord,c="",e="",j=null;sel=this.getSelection(),range=this.getRange(sel);var h=this;var f=function(p,s){var r={position:-1},m=0,k=0,q="";for(var o=0,n=s.length;o<n;o++){m=s[o];q=m.target;k=p.lastIndexOf(q);if(r.position<k&&k>-1){r.position=k;r.keyWord=q;r.content=m.content;h.target=q}}return r};if($.browser.msie&&$.browser.version<"9.0"){var b=range.parentElement(),a=this.selected(b).start,d=this.getSearchForIE($(b).html(),a);e=d;i=f(e,g);i.searchContent=e;return i}e=range.startContainer.textContent,j=range.endContainer;i=f(e,g);c=j.endOffset;i.container=range.startContainer;if(i.position<0){return false}i.searchContent=e.substring(i.position,c).replace("<br>","");return i},insertObj:function(f){var c=editorObj.resume(),e=this.chooseOne(f);if(window.getSelection){var c=editorObj.resume(),d=c.endContainer,g=this.target;l=d.textContent.lastIndexOf(g);d.textContent=d.textContent.substring(0,l);this.focusNodeAfter(d);this.insertNode(e);txtNode=document.createTextNode("\xa0");$(e).after(txtNode);this.focusNodeAfter(txtNode);this.setFocus();this.cursorChange()}else{var b=e.outerHTML||e.nodeValue,a=c.duplicate();this.removeAt(a);c=editorObj.resume();c.pasteHTML(b);this.cursorChange()}this.countWord()},cursorPosition:function(){var c=this.getSelection();var d=this.getRange(c);if($.browser.mozilla){return d.getBoundingClientRect()}this.cursorChange();var a=$('<b class="yy_cursor_position" style="width:1px;height:1px;visibility:hidden;">i</b>');this.insertNode(a[0]);var b=$(".yy_cursor_position");var e=b.offset();b.remove();return e}};$(document).ready(function(){$("#speechForm").bind("submit",function(){$("#group_sf").val(combo.val("fyd"))});$("#aside_fyd").find("a").live("click",function(e){var i=e.target});var b=0;var a={addPositon:function(e){b+e},clearForm:function(){}};$(document).click(function(e){var i=e.target;if($(i).attr("id")=="face_trigger"||$(i).hasClass("yy_face_sh")){return}if($(i).closest(".faces_list").length<1){$(".faces_list").hide()}});$("#savesubmit").mouseenter(function(){$(".yy_send_helf").show()}).mouseleave(function(){$(".yy_send_helf").hide()});$("[name=confirm_myBox]").live("click",function(){var j="";$(this).closest("#myBox").find("input[type=checkbox]").each(function(){if($(this).attr("checked")){j=j+$(this).next().text()+" "}});var e=j.split(" "),i=j;if(e.length>6){e.splice(6);i=e.join(" ")+"..."}if(j!=""){$("#yy_roma_content").html(i);$(".yy_roma_list").show()}else{$(".yy_roma_list").hide()}});$("#yy_close_roma").live("click",function(){$(".yy_roma_list").hide();$("#myBox").find("input[type=checkbox]").each(function(){$(this).removeAttr("checked")})});editorObj=new editor({selector:"#content_div"});var d=new speeh_face({selector:"#face_id",trigger:"#face_trigger",toElement:"#content_div",editor:editorObj});editorObj.bind();editorObj.barBind(c);var c=new autocomplete({text:"#content_div",content:"#auto_content,#auto_content_topic",target:"",container:"",editor:editorObj,position:{height:22,width:-37},select:function(e){editorObj.insertObj(e)},load:function(j,k,i){var e=coreFun.autoLoadTeam(j);if(editorObj.target=="@"){if(e==""){return}$(k.content).find("#auto_content_list").html(e)}else{c.content="#auto_content_topic";$(k.content).find("#auto_content_list").html(e)}},search:function(j,m){try{var i=editorObj.getSearch();if(!i||i.searchContent.indexOf(" ")!=-1){return null}m.content=i.content;if(i.keyWord=="#"){$(i.content).find("#yy_create_topic").html(i.searchContent)}return(editorObj.searchContent=i.searchContent)}catch(k){}}});try{$("#content_div").focus();editorObj.rememberCurrentRange();$("#content_div").blur()}catch(g){}$("#speechForm").live("submit",function(){var k=this;var n=$("#content_div");coreFun.addNotice($(k));n.find("img").each(function(){$(this).attr("src",YY.util.url($(this).attr("src")))});coreFun.deleTarget(n[0]);n.find("a").each(function(){var j=$(this).attr("category");if(j=="45"){var p=$(this).attr("for").split("/"),i=p.length;if(p[i-1]){$(k).append("<input name='topic_div_value[]' type='hidden' value="+p[i-1]+" />")}}if(j=="40"){var p=$(this).attr("for").split("/"),i=p.length;if(p[i-1]){$(k).append("<input name='groupids_for_notice[]' type='hidden' value="+p[i-1]+" />")}}$(this).removeAttr("style")});$("#speech_content").val(n.html());$("role=listbox").hide();var e=0;for(var o=0,m=1000;o<m;o++){e=e+1}});var h=function(e){this.selector=e.selector;h.superclass.constructor.call(this,e);this.type="replayEditor"};YY.util.extend(h,editor);h.prototype.bind=function(){var e=this;$(this.selector).live({click:function(i){e.dom=i.target;e.$dom=$(i.target);e.rememberCurrentRange()},keyup:function(i){var k=i.keyCode,j=i.target;$(this).find("a").each(function(){if($(this).html()==""){$(this).remove()}});if(k!=8&&k!=46){$(this).find("a").each(function(){if($(this).attr("default")!=$(this).html()){$(this).html($(this).attr("default"));e.focusNodeAfter(this)}})}else{$(this).find("a").each(function(){if($(this).attr("default")!=$(this).html()){var n=$(this),m=n.parent();n.remove();if($.browser.mozilla&&m.html()==""){m.html("<br>")}}})}$(j).trigger("cursorChange");$(j).trigger("valueChange")},cursorChange:function(j){var i=e.rememberCurrentRange()},valueChange:function(i){e.countWord()}})};h.prototype.barBind=function(){var e=this;function i(j){}$(".yy_replay_at").live("click",function(j){$target=$(j.target).closest("form").find("div[contentEditable=true]");var k="@";e.insetText(k,$target,"#auto_content_replay")})};h.prototype.countWord=function(){var i=this.$dom.html();if(!i){this.$dom.closest("aside").find("#yy_wordConut").html("210");return}i=i.replace(/<a[^>]*>/gi,"").replace(/<\/a[^>]*>/gi,"").replace(/[\u4E00-\u9FA5]/gi,"!!").replace(/\<img[\s\S]*?\/?\>/ig,"!!!!").replace(/<br[^>]*>/gi,"").replace(/\&nbsp;/gi," ");var e=210-Math.floor(i.length/2);this.$dom.closest("aside").find("#yy_wordConut").html(e)};var f={showFaces:function(){},hideFaces:function(){},faceObj:null,editor:null,autocomplete:null,initFaces:function(){this.faceObj=new face({trigger:".yy_face_sh",selector:".yy-feedFaceUl",toElement:"yy-contentDiv",relative:"form",editor:this.editor})},initEditor:function(){var e=this;this.editor=replayface=new h({selector:".yy-contentDiv"});this.editor.bind();this.editor.barBind();this.autocomplete=new autocomplete({text:".yy-contentDiv",content:"#auto_content_replay",target:"@",container:"",editor:e.editor,position:{height:37,width:0},select:function(q){if(window.getSelection){var o=e.editor.getSelection();o.removeAllRanges();var k=e.editor.resume();var n=k.endContainer;var m=document.createTextNode("\xa0");var p=e.editor.chooseOne(q);l=n.textContent.lastIndexOf("@");n.textContent=n.textContent.substring(0,l);e.editor.focusNodeAfter(n);e.editor.insertNode(p);$(p).after(m);e.editor.focusNodeAfter(m);e.editor.setFocus();e.editor.cursorChange()}else{if(document.selection&&document.selection.type!="Control"){var k=e.editor.resume(),p=e.editor.chooseOne(q),j=p.outerHTML||p.nodeValue;var i=k.duplicate();e.editor.removeAt(i);k=e.editor.resume();k.pasteHTML(j);e.editor.cursorChange()}}},load:function(k,m,j){var i=coreFun.autoLoadTeam(k);if(i==""){return}$("#auto_content_replay").find("#auto_content_list").html(i)},search:function(j,m){try{var i=e.editor.getSearch();if(!i||i.searchContent.indexOf(" ")!=-1){return}m.content=i.content;if(i.keyWord=="#"){$(i.content).find("#yy_create_topic").html(i.searchContent)}return(editorObj.searchContent=i.searchContent)}catch(k){}}})}};f.initEditor();f.initFaces();coreFun.directeAt();coreFun.directeShap()});