var JobRelationship=function(b){var a=this;a.url=YY.util.url("/space/member/jrdata");a.addUrl=YY.util.url("/space/member/addjr");a.activeMid=$("#jr_cur_mid").val();a.itemnum=8;a.render=function(i){var k=true,h,j=[],c=["#jr-partner-bg","#jr_senior","#jr-subordinate-1"],e=[];$.each(i,function(l,m){h=$('.jr_containter[relate="'+l+'"]');j.push(m.length);if(m.length>0){h.removeClass("hidden");if(k){k=false}e.push(l-1)}else{if(l=="1"){h.removeClass("hidden");e.push(l-1)}}a.item(l,m)});if(e.length==1){var f=$(c[e[0]]);f.addClass("gxline_none");if(e[0]==2){f.css("paddingTop",0)}}else{if(j[1]<=0&&j[0]>0){$("#jr-partner").css("marginTop",0);$("#jr-partnerlist").css("paddingTop",0)}}var d=$("#yyRelationBox"),g="#nodata-jr";if(k){d.addClass("hidden");$(g).removeClass("hidden");$(".yy-edit-relation",g).removeClass("hidden")}else{d.removeClass("hidden");$(g).addClass("hidden")}};a.item=function(j,g){var k="/space/cons/index/id/";var d="#jr_"+j;var e,h;var c="hidden";var m=true;if($("#jr-edit-main").attr("act")=="save"){c="";m=false}var l;for(var f in g){e=YY.util.url(k+g[f].r_member_id);h=g[f].online?"groupOnline":"groupLev";l=$('<li mid="'+g[f].r_member_id+'"><div class="relative"><a href="'+e+'" tips="1" rel="/api/ajax/partnerinfo/pid/'+g[f].r_member_id+'"><img src="'+g[f].avatar+'"/></a><a href="'+e+'" class="dlMemtitle '+h+'">'+g[f].name+'</a><a href="javascript:;" class="close '+c+'"></a></div></li>');l.draggable({disabled:m,revert:"invalid",containment:".cyListBox",zIndex:999,helper:"clone",cursor:"move"}).addClass("fl").appendTo(d)}};a.defaultOption={url:a.url,render:a.render,add:a.add,more:a.more,item:a.item};$.extend(a.defaultOption,b);a.more=function(){var c=$(this);var d=c.parent("div").find("ul").attr("relate");var f=$("#jr_"+d+">li");var e=[];$.each(f,function(h,g){e.push($(g).attr("mid"))});YY.util.ajaxApi(a.url,function(g){a.defaultOption.render(g.data);if(g.data[d].length<a.itemnum){c.addClass("hidden")}},"POST","json",{mid:a.activeMid,flag:d,exsist:e})};a.add=function(e,d,c,f){YY.util.ajaxApi(this.addUrl,function(h){if(!h.rs){$.yy.rscallback(h.error,1)}else{f[0].online=h.data.online;a.item(c,f);var i="#jr_num_"+c;var g=parseInt($(i).html());$(i).html(g+1)}},"POST","json",{mid:e,rmid:d,flag:c})};a.init=function(){var c=true;YY.util.ajaxApi(a.url,function(e){a.defaultOption.render(e.data);YY.util.loadScript(["modules/space/yy.relation.js"])},"POST","json",{mid:a.activeMid});$(".yy-jr-more").bind("click",a.more)};a.init()};$(document).ready(function(){var f=new JobRelationship();var a=f.activeMid;$(".rcAddmenr").fancybox({onComplete:function(h){var i={};i=$(h).parent().parent().find(".rcAddmenListUl");var g=$(h).attr("for");$("#consoleBtn_"+g).bind("click",function(){var l="";var j=$("#selectedContainter").find("figure");if(j.length<1){$("#msgNote").html("请选择人员!");return}for(var k=0;k<j.length;k++){var n=$(j[k]).attr("itemid");var m=$(j[k]).text().split("(");if($("#yyauto_li_"+n).length==0){l+='<li id="yyauto_li_'+n+'" class="clearfix rcAddmenListli"><span>'+m[0]+'</span><input type="hidden" value="'+n+'" name="'+g+'_value[]"><a class="close" href="javascript:;"></a></li>'}f.add(a,n,g,[{r_member_id:n,name:m[0],avatar:$(j[k]).find("img").attr("src")}])}$(i).prepend(l).find(".close").bind("click",function(){$(this).parent().remove()});$.fancybox.cancel();$.fancybox.close()})}});var e;var c=["添加同事","添加上级","添加下级"];var d=function(h){var g=$(h.target);clearTimeout(e);g.val("");g.removeClass("add_user");g.addClass("add_user_2");g.next("span").removeClass("hidden")};var b=function(h){var g=$(h.target);e=setTimeout(function(){var i=g.attr("id").split("_")[2];g.val(c[i-1]);g.removeClass("add_user_2");g.addClass("add_user");g.next("span").addClass("hidden")},100)};$("#jr_add_1").yyautocomplete({defaultValue:self.manageUser,appendTo:"#jr_lx_1",ajaxUrl:yyBaseurl+"/common/search/ccnotice",select:function(g,i){var h=[{name:i.item.label,r_member_id:i.item.value,avatar:i.item.avatar}];f.add(a,i.item.value,1,h)}}).bind("focus",d).bind("blur",b);$("#jr_add_2").yyautocomplete({defaultValue:self.manageUser,appendTo:"#jr_lx_2",ajaxUrl:yyBaseurl+"/common/search/ccnotice",select:function(g,i){var h=[{name:i.item.label,r_member_id:i.item.value,avatar:i.item.avatar}];f.add(a,i.item.value,2,h)}}).bind("focus",d).bind("blur",b);$("#jr_add_3").yyautocomplete({defaultValue:self.manageUser,appendTo:"#jr_lx_3",ajaxUrl:yyBaseurl+"/common/search/ccnotice",select:function(g,i){var h=[{name:i.item.label,r_member_id:i.item.value,avatar:i.item.avatar}];f.add(a,i.item.value,3,h)}}).bind("focus",d).bind("blur",b)});