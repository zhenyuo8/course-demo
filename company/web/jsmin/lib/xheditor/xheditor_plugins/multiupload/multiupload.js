/*!
 * MultiUpload for xheditor
 * @requires xhEditor
 * 
 * @author Yanis.Wang<yanis.wang@gmail.com>
 * @site http://xheditor.com/
 * @licence LGPL(http://www.opensource.org/licenses/lgpl-license.php)
 * 
 * @Version: 0.9.2 (build 100505)
 */
var swfu,selQueue=[],selectID,arrMsg=[],allSize=0,uploadSize=0;function removeFile(){var b;if(!selectID){return}for(var a in selQueue){b=selQueue[a];if(b.id==selectID){selQueue.splice(a,1);allSize-=b.size;swfu.cancelUpload(b.id);$("#"+b.id).remove();selectID=null;break}}$("#btnClear").hide();if(selQueue.length==0){$("#controlBtns").hide()}}function startUploadFiles(){if(swfu.getStats().files_queued>0){$("#controlBtns").hide();swfu.startUpload()}else{alert("上传前请先添加文件")}}function setFileState(b,a){$("#"+b+"_state").text(a)}function fileQueued(b){for(var a in selQueue){if(selQueue[a].name==b.name){swfu.cancelUpload(b.id);return false}}if(selQueue.length==0){$("#controlBtns").show()}selQueue.push(b);allSize+=b.size;$("#listBody").append('<tr id="'+b.id+'"><td>'+b.name+"</td><td>"+formatBytes(b.size)+'</td><td id="'+b.id+'_state">就绪</td></tr>');$("#"+b.id).hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}).click(function(){selectID=b.id;$("#listBody tr").removeClass("select");$(this).removeClass("hover").addClass("select");$("#btnClear").show()})}function fileQueueError(a,d,c){var b="";switch(d){case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:b="只能同时上传 "+this.settings.file_upload_limit+" 个文件";break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:b="选择的文件超过了当前大小限制："+this.settings.file_size_limit;break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:b="零大小文件";break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:b="文件扩展名必需为："+this.settings.file_types_description+" ("+this.settings.file_types+")";break;default:b="未知错误";break}alert(b)}function uploadStart(a){setFileState(a.id,"上传中…")}function uploadProgress(a,d,c){var b=Math.ceil((uploadSize+d)/allSize*100);$("#progressBar span").text(b+"% ("+formatBytes(uploadSize+d)+" / "+formatBytes(allSize)+")");$("#progressBar div").css("width",b+"%")}function uploadSuccess(file,serverData){var data=Object;try{eval("data="+serverData)}catch(ex){}if(data.err!=undefined&&data.msg!=undefined){if(!data.err){uploadSize+=file.size;arrMsg.push(data.msg);setFileState(file.id,"上传成功")}else{setFileState(file.id,"上传失败");alert(data.err)}}else{setFileState(file.id,"上传失败！")}}function uploadError(a,c,b){setFileState(a.id,"上传失败！")}function uploadComplete(a){if(swfu.getStats().files_queued>0){swfu.startUpload()}else{uploadAllComplete()}}function uploadAllComplete(){callback(arrMsg)}function formatBytes(a){var b=["Byte","KB","MB","GB","TB","PB"];var c=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,Math.floor(c))).toFixed(2)+" "+b[c]};