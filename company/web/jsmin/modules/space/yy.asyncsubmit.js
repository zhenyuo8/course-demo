var YY=YY||{};YY.AsyncSubmit=AsyncSubmit;function AsyncSubmit(a){a=a||{};var b=this;if(typeof b.beforeSubmit!=="function"){AsyncSubmit.prototype.beforeSubmit=function(f,q,p){var e=p.url,m=e.length,n=m?e.substring(m-1):"";e=(n==="/"||n==="\\")?e.substring(0,m-1):e;p.url=e+"/ajaxsubmit/1/ajaxtype/normal";if($("#speechForm").length>0){var h=$("#content_div").html().replace("&nbsp;","");if(h==""){return false}if(parseInt($(".yy-font-num").html())<0){var g=0;var o=setInterval(function(){if(g==0){$(".yy-font-num").css("color","blue");g=1}else{$(".yy-font-num").css("color","red");g=0}},100);setTimeout(function(){clearInterval(o);$(this).css("color","red")},2000);return false}}else{if($("#voteForm").length>0&&$("#ul_vote_pic_option").length>0&&$("#vote_type_nav").length>0){var l=true;if($("#vote_type_nav").find(".cur").attr("link")=="voteForm_pic"){var k=[];$("#ul_vote_pic_option").children().each(function(){var u=$(this).find("input[name^=pic_vote_image]");var r=$(this).find("input[name^=pic_vote_image_des]");if(u.val()!=""){if(r.val()==""){$.yy.rscallback("请填写图片的描述",1);r.focus();l=false;return false}else{if($.trim(r.val())!==""){k.push($.trim(r.val()))}}}});if(l){var j=k.length;$.each(k,function(u,w){var r=0;for(g=0;g<j;g++){if(w==k[g]){r++}}if(r>1){$.yy.rscallback("图片描述有重复项，请修改",1);l=false;return false}})}}else{if($("#div_vote_word_option").length>0){var k=[];$("#div_vote_word_option").children().each(function(){if($.trim($(this).find("input[id^=opt]").val())){k.push($.trim($(this).find("input[id^=opt]").val()))}});var j=k.length;$.each(k,function(u,w){var r=0;for(g=0;g<j;g++){if(w==k[g]){r++}}if(r>1){$.yy.rscallback("投票选项不能有重复项，请修改",1);l=false;return false}})}}if(!l){return false}}}return true};AsyncSubmit.prototype.success=function(h,e,l,n){var j=false,f="错误！",m=0,k=0;try{j=h.rs;f=h.error?h.error:f;m=h.data.objid;k=h.data.objtype}catch(g){}if(m&&k&&j){YY.util.ajaxApi(YY.util.url("/api/info/getfeedhtml"),function(r){if(r){$lastSection=$(".yy-feed-section[ele-role]").last();if($lastSection.length){$lastSection.after(r)}else{if($("#feed_div").length){var o=$("#footer_morefeed").prev(".hidden");if(o.length>0){o.remove().before(r)}$("#yy_conversation_content").prepend(r)}else{$("#nodata").remove();$("#getcontent").prepend(r)}}$.yy.rscallback("操作成功！");if(($("#schedule_detail").length>0&&$("#sid").val()>0)||($("#task_detail").length>0&&$("#tid").val()>0)){return}n.resetForm();n.find(".yy-uploaded-file-list").html("").hide();if($("#schedule_detail").length>0){$("#starthour").removeAttr("disabled");$("#endhour").removeAttr("disabled");$("#schedule_add_type_normal").removeClass("cur");$("#schedule_add_type_important").removeClass("cur");$("#schedule_add_type_normal").addClass("cur");$("#schedule_add_type_text").val(0);$("#schedule_detail").hide();if($("#sub-div").length>0){$("#sub-div>a:first-child").html("填写详情")}if(typeof s!="undefined"){var p=s.getScheduleDefault();$.each(p,function(y,z){if($("#"+y+"_yy_dl").length>0){$("#"+y+"_yy_dl").html(z.txt)}})}}if($("#task_detail").length>0){$("#task_add_type_normal").removeClass("cur");$("#task_add_type_important").removeClass("cur");$("#task_add_type_normal").addClass("cur");$("#task_add_type_text").val(0);$("#task_detail").hide();if($("#sub-div").length>0){$("#sub-div>a:first-child").html("填写详情")}if(typeof t!="undefined"){var w=t.getDefaultText();$.each(w,function(y,z){if($("#"+y+"_yy_dl").length>0){$("#"+y+"_yy_dl").html(z.txt)}})}}$("#notice_list>li.rcAddmenListli,#manageuser_list>li.rcAddmenListli,#joinuser_list>li.rcAddmenListli").remove();$("#savesubmit").attr("class","button grayButton").attr("disabled",true);$(".rcAddmenListli").remove();if($("#vote_type_nav").length>0){if($("#vote_type_nav").find(".cur").attr("link")=="voteForm_word"){var u=$("#div_vote_word_option").children().size();if(u>2){for(i=3;i<=u;i++){$("#div_vote_word_option").children().last().remove()}}if(!$("#word_vote_instruction").hasClass("hidden")){$("#word_vote_instruction").addClass("hidden");$("#word_vote_add_instruction").html("添加说明")}if(!$("#div_vote_word_super_set").hasClass("hidden")){$("#div_vote_word_super_set").addClass("hidden");$("#vote_word_show_super_set").html('展开高级设置<span class="arrowDown"></span>')}if($("#end_date").length>0){$("#end_date").hide()}if($("#end_hour").length>0){$("#end_hour").hide()}if($("#vote_word_optnum_select").length>0){$("#vote_word_optnum_select").children().remove();$("#vote_word_optnum_select").append('<option value="0">单选</option><option value="2">最多选2项</option>')}$("input.[name='search[]']").remove();$("#title_yy_dl,#opt1_yy_dl,#opt2_yy_dl").remove();if(v){$("#title").val("");$("#notice_n").val("");$(":text[id^='opt']").val("");v.offset=1;v.load()}}else{for(i=0;i<2;i++){var x=$("#ul_vote_pic_option").children().eq(i);if(x.length>0){x.find(".yy-pic-placeholder").attr("src","/images/new_qz/pic_tp/pic_tp_up.gif");x.find('input[name^="pic_vote_image["]').val("/images/new_qz/pic_tp/pic_tp_up.gif");x.find(".pic_r_up").hide();x.find(".pic_r_up2").hide()}}var u=$("#ul_vote_pic_option").children().size();if(u>2){for(i=3;i<=u;i++){$("#ul_vote_pic_option").children().last().remove()}}if(!$("#pic_vote_instruction").hasClass("hidden")){$("#pic_vote_instruction").addClass("hidden");$("#pic_vote_add_instruction").html("添加说明")}if(!$("#div_vote_pic_super_set").hasClass("hidden")){$("#div_vote_pic_super_set").addClass("hidden");$("#vote_pic_show_super_set").html('展开高级设置<span class="arrowDown"></span>')}if($("#pic_end_date").length>0){$("#pic_end_date").hide()}if($("#pic_end_hour").length>0){$("#pic_end_hour").hide()}if($("#pic_word_optnum_select").length>0){$("#pic_word_optnum_select").children().remove();$("#pic_word_optnum_select").append('<option value="0">单选</option><option value="2">最多选2项</option>')}}var q=$("#voteForm").find(".yy-feedTopicDiv");if(q.length>0){q.hide();q.find(".ht_tag_list").children().remove()}}}},"POST","html","objid="+m+"&type="+k)}else{$.yy.rscallback(f,1);return}}}AsyncSubmit.prototype.successForSpeech=function(j,f,m,o){o.find("#speech_content").val("");o.find("input[ele-role=member-id]").remove();if(o.attr("id")=="speechForm"){o.find("div[ele-role=textarea]").html("")}o.find("input[id=fids]").val("");var e=o;var o=$("#content_div").closest("form");$("#content_div").css({"min-height":"20px",height:"20px"});o.find("#upload-div").slideUp();o.find(".yy-font-num").html("210");$(".yy-font-num").html("210");$(".yy_roma_list").hide();var k=false,g="错误！",n=0,l=0;try{k=j.rs;g=j.error?j.error:g;n=j.data.objid;l=j.data.objtype}catch(h){}if(n&&l&&k){YY.util.ajaxApi(YY.util.url("/api/info/getfeedhtml"),function(q){if(q){$lastSection=$(".yy-feed-section[ele-role]").last();if($lastSection.length){$lastSection.after(q)}else{if($("#feed_div").length){var p=$("#footer_morefeed").prev(".hidden");if(p.length>0){p.remove().before(q)}$("#yy_conversation_content").prepend(q)}else{$("#nodata").remove();$("#getcontent").prepend(q)}}$.yy.rscallback("操作成功！");if(($("#schedule_detail").length>0&&$("#sid").val()>0)||($("#task_detail").length>0&&$("#tid").val()>0)){return}e.resetForm();e.find(".yy-uploaded-file-list").html("").hide();$("#content_div").blur()}},"POST","html","objid="+n+"&type="+l+"&frommodule="+$("input[name=frommodule]").val())}else{$.yy.rscallback(g,1);return}};AsyncSubmit.prototype.successForTask=function(j,f,m,o){var k=false,g="错误！",n=0,l=0;try{k=j.rs;g=j.error?j.error:g;n=j.data.objid;l=j.data.objtype}catch(h){}if(n&&l&&k){$.yy.rscallback("操作成功，页面正在跳转，请稍等...");if($("#taskaddForm").length>0){var e=yyBaseurl+"/task/task/index"}else{if($("#addForm").length>0){var e=yyBaseurl+"/schedule/index/index"}else{var e=yyBaseurl+"/vote/vote/index"}}if($("#savesubmit").length>0&&typeof $("#savesubmit").attr("preUrl")!="undefined"){e=$("#savesubmit").attr("preUrl")}window.location.href=e}else{$.yy.rscallback(g,1);return}return false};var d={target:"#taskaddForm,#addForm,#voteForm,#speechForm,#shareForm,#imshareForm",beforeSubmit:b.beforeSubmit,success:b.success,successForSpeech:b.successForSpeech,successForTask:b.successForTask};d=$.extend(d,a);function c(){YY.util.loadScript(["plugin/jquery.form.js"],{fn:function(){$(document).on("submit",function(h){var f=$(h.target),g=f.attr("id");if(f.is(d.target)){if(g=="speechForm"){f.ajaxSubmit({beforeSubmit:d.beforeSubmit,success:d.successForSpeech,dataType:"json"});return false}else{if(g=="addForm"||g=="taskaddForm"){f.ajaxSubmit({beforeSubmit:d.beforeSubmit,success:d.successForTask,dataType:"json"});return false}else{if(g=="voteForm"&&$("#vote_add_detail_page").length>0){f.ajaxSubmit({beforeSubmit:d.beforeSubmit,success:d.successForTask,dataType:"json"});return false}else{f.ajaxSubmit({beforeSubmit:d.beforeSubmit,success:d.success,dataType:"json"});return false}}}}})}})}c()}$(document).ready(function(){new YY.AsyncSubmit()});