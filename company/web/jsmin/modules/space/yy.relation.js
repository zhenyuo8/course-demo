$(function(){var s=$("#yyRelationBox"),k=$("#jr_2",s),h=$("#jr_1",s),p=$("#jr_3",s),q=$(".close",s);var m=$("#jr_cur_mid"),e=m.val(),j=YY.util.url("/space/member/deljr"),c="#nodata-jr",g=YY.util.url("/space/member/movejr"),f=["#jr-partner-bg","#jr_senior","#jr-subordinate-1"];function i(){$("#jr_2>li,#jr_1>li,#jr_3>li",s).draggable({disabled:true,revert:"invalid",containment:".cyListBox",zIndex:999,helper:"clone",cursor:"move",start:function(u,v){$item=v.helper;$tips_trigger=$("[tips=1]",$item);rnum=$tips_trigger.attr("rnum");$("#"+rnum).hide();$tips_trigger.removeAttr("tips")}});k.parent().droppable({accept:"#jr_1>li, #jr_3>li",activeClass:"yy-drop-actived",drop:function(z,y){var v=$(this).find("li");var x=0;$.each(v,function(A,B){if($(B).css("display")=="none"){return}x++});if(x>=8){$.yy.rscallback("上级最多只能添加8个",1);return}var w=y.draggable,u=$(z.target).children("#jr_2");t(w,u)}});h.parent().droppable({accept:"#jr_2>li, #jr_3>li",activeClass:"yy-drop-actived",drop:function(x,w){var v=w.draggable,u=$(x.target).children("#jr_1");t(v,u)}});p.parent().droppable({accept:"#jr_2>li, #jr_1>li",activeClass:"yy-drop-actived",drop:function(x,w){var v=w.draggable,u=$(x.target).children("#jr_3");t(v,u)}});o()}function t(v,u){var w={flag:u.attr("relate"),rmid:v.attr("mid"),mid:e};YY.util.ajaxApi(g,function(A){if(A.rs){v.fadeOut(function(){v.prependTo(u).fadeIn(function(){})});var z=$("#jr_num_"+u.attr("relate"));var y=$("#jr_num_"+v.closest("ul").attr("relate"));var x=parseInt(z.html())+1;z.html(x);var x=parseInt(y.html())-1;y.html(x>=0?x:0);if($("#jr-edit-main").attr("act")==="edit"&&x<=0){a()}}},"GET","json",w)}function n(){$("#jr_2>li,#jr_1>li,#jr_3>li",s).draggable("enable")}function r(){$("#jr_2>li,#jr_1>li,#jr_3>li",s).find(".close").toggleClass("hidden")}function o(){$("#jr_2>li,#jr_1>li,#jr_3>li",s).draggable("disable").removeClass("ui-state-disabled")}function b(){$("#jr_2>li,#jr_1>li,#jr_3>li",s).find(".close").toggleClass("hidden")}function a(){var w,z,D,C=true,x,A=[h,k,p],B=[],u=[];for(var y=0;y<A.length;y++){D=A[y];w=D.attr("relate");z=parseInt($("#jr_num_"+w,s).html());B.push(z);x=$('.jr_containter[relate="'+w+'"]',s);if(z<=0){if(w!="1"){x.addClass("hidden")}else{u.push(y)}}else{if(C){C=false;u.push(y)}else{u.push(y)}}$(f[y]).removeClass("gxline_none")}if(u.length==1){var v=$(f[u[0]]);v.addClass("gxline_none");if(u[0]==2){v.css("paddingTop",0)}}else{if(B[1]<=0&&B[0]>0){$("#jr-partner").css("marginTop",0);$("#jr-partnerlist").css("paddingTop",0)}}if(C){s.addClass("hidden");$(c).removeClass("hidden");$(".yy-edit-relation",c).removeClass("hidden")}else{s.removeClass("hidden");$(c).addClass("hidden")}}function l(){$(".jr-add-containter",s).removeClass("hidden");$(".jr_containter",s).removeClass("hidden")}function d(){$(".jr-add-containter",s).addClass("hidden")}$(".yy-edit-relation").live({click:function(){var v=$(this),w=$('.jr_containter[relate="1"]',s);if(v.attr("act")==="edit"){s.removeClass("hidden");$(c).addClass("hidden");v.addClass("hidden");for(var u=0;u<f.length;u++){$(f[u]).removeClass("gxline_none")}v=$(".yy-edit-relation",w);v.removeClass("hidden");$("#jr-partner").css("marginTop",30);$("#jr-partnerlist").css("paddingTop",30);$("#jr-subordinate-1").css("paddingTop",30);$("#jr-subordinatelist").css("paddingTop",30);n();r();l();v.attr("act","save").html("完成")}else{o();b();d();a();v.attr("act","edit").html("编辑上下级")}}});q.live({click:function(){var y=$(this),v=y.closest("li"),u=v.closest("ul").attr("relate"),z=v.attr("mid"),x="#jr_num_"+u;YY.util.ajaxApi(j,function(A){if(A.rs){}},"POST","json",{mid:e,rmid:z});var w=parseInt($(x).html());if(w>0){$(x).html(w-1)}v.draggable("destroy").hide(function(){$(this).remove()})}});i()});