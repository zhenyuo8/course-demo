(function(d,a,c){a=a||{};var b={$body:d("body"),$calendar:d("#yyCalendar",this.$body),$main:d("#yyCalendarMain",this.$calendar),$mainGridWrapper:d("#yyCalendarMainGrid",this.$main),$mainEditWrapper:d("#yyCalendarMainEdit",this.$main),$mainSearchWrapper:d("#yyCalendarMainSearch",this.$main),th1:0,calendarCombo:null,actMap:{checkInCalendar:"checkInCalendar"},initFloatBox:function(){if(!d("#yyFloatbox").length){var e='<div class="yy-floatbox" id="yyFloatbox" style="z-index:1001;display:none;"><div class="yy-floatbox-main"><div class="title"><ul><li class="cur">默认标题</li></ul><a href="#" class="close fr" title="关闭"></a></div><p class="yy-floatbox-bottom-arrow" id="yyFloatboxArrow"></p>';me.$body.append(e)}},openFloatBox:function(s){s=s instanceof Object?s:{};var v=this,l={wrap:"#yyFloatbox",fix_num:220,x:0,y:0};s=d.extend({},l,s);var h=d(s.wrap),k=d(".yy-floatbox-arrow",h),r=s.fix_num,j=s.x,i=s.y,w=d(window).scrollTop();h.show();var e=h.outerHeight(),p=h.outerWidth(),u=p/2,f=k.width(),t=f/2,m=k.height(),n,g,o,q=v.$body.width();if((i-w-49)>(e+m+1)){k.addClass("yy-floatbox-bottom-arrow").removeClass("yy-floatbox-top-arrow");n=i-e-m-1}else{k.addClass("yy-floatbox-top-arrow").removeClass("yy-floatbox-bottom-arrow");n=i+m+1}g=j-u;if(j<(u+r)){g=r;o=j-g-t}else{if((q-j)<(u+r)){g=q-p-r;o=j-g-t}else{o=u-t}}if((o+t>(p-10))||(o-t<10)){o=u-t}k.css({left:o});h.offset({top:n,left:g}).css({visibility:"visible"})},openOperateList:function(e){var g=this,f=e.closest(".yy-calendar-operates"),h=e.closest(".yy-calendar-operate");clearTimeout(g.th1);h.addClass("actived").siblings().removeClass("actived");f.children().show()},closeOpereateList:function(e){var f=this;f.th1=setTimeout(function(){e.children().hide();e.find(".yy-calendar-operate").removeClass("actived")},200)},handleFormStatus:function(e){var f=e.val(),g=e.closest("form").find('input[type="submit"]');d.trim(f)?g.removeClass("darkGrayButton").addClass("blueButton"):g.removeClass("blueButton").addClass("darkGrayButton")},changeCreateTab:function(f){var g=f.attr("tab"),e=d(".yy-floatbox-content").children();f.addClass("cur").siblings().removeClass("cur");e.hide().filter(".yy-calendar-"+g+"-create").show();return true},deleteTask:function(h,j,e){var g=a.calendar,f=a.util.url("/api/feed/delfeed"),i={id:h};a.util.ajaxApi(f,function(){g.deleteTaskData(h,j,e);g.closeFloatBox();g.refreshCalendar();d.yy.rscallback("删除成功！")},"POST","json",i);return true},followTask:function(e,g,i,f){f=f==1?0:1;var h=a.util.url("/space/ajax/follow"),j={id:g,type:i,status:f};a.util.ajaxApi(h,function(){f==1?e.removeClass("blueGz yy-follow").addClass("grayGz yy-followed").html("已关注"):e.removeClass("grayGz yy-followed").addClass("blueGz yy-follow").html("加关注")},"POST","json",j);return true},getTaskDetail:function(f,e,j,h){if(typeof h!=="function"){return}var l=["/schedule/add/api","/task/add/api"],k={from_id:f,feed_id:e},g=j==25?0:(j==35?1:"");a.util.ajaxApi(a.util.url(l[g]),function(m,i){h(m)},"POST","html",k)},openTaskDetailBox:function(l,h,f,i){var j=this,m=d("#yyFloatbox"),k=d(".yy-floatbox-title h3",m),g=d(".yy-floatbox-content",m);j.getTaskDetail(h,f,i,function(e){k.html(i==35?"任务详情":"日程详情");g.html(e);j.openFloatBox({x:l.pageX,y:l.pageY})})},openTaskCreateBox:function(e){e=e instanceof Object?e:{};var g=this,f=a.calendar,h={x:0,y:0,start_time:0,end_time:0};e=d.extend({},h,e);f.initTaskCreatePanel(e.start_time,e.end_time);g.openFloatBox({wrap:"#yyCreatePanel",x:e.x,y:e.y})},taskSearch:function(f){var i=this,j=i.calendarCombo,g={beforeSubmit:e,success:h};f.ajaxSubmit(g);function e(m,l,k){c.trace(m);d.each(m,function(n,o){o.name==="calendarSearchType"&&(o.value=j.val("searchFilter"))});d("#calendarSearchType").val(j.val("searchFilter"));m.push({name:"p",requird:false,type:"text",value:"1"});m.push({name:"first",requird:false,type:"text",value:true});return true}function h(n,o,p,k){try{var m=d.parseJSON(n);d("#yyCalendarMainSearch").html(m.html).show();c.loadScript(["plugin/yy.pageNavi.js"],{fn:function(){var q=new a.PageNavi({perPage:15,pageCount:5,totalNum:m.total,isRender:true,contentLoaded:function(r){}})}});d(".rili_cont").hide();d(".yy-view-button").removeClass("cur")}catch(l){}}return false},initTaskSearch:function(){var e=this;e.calendarCombo=new d.yy.comboDiv({searchFilter:{defaultid:0,labelcss:"icoXsjGray fl xsj",data:[{txt:"全部",id:0},{txt:"日程",id:25},{txt:"任务",id:35}],callback:function(f){}}})},concatScheduleCreateHtml:function(){var e=[];e.push('<div class="yy-calendar-schedule-create">');e.push('<form enctype="multipart/form-data" name="calendar_sche" id="calendar_sche" method="post" action="',a.util.url("/schedule/add/subadd"),'">');e.push('<input type="hidden" name="sid" value="0" />','<input type="hidden" name="type" value="0" />','<input type="hidden" name="type_id" value="0" />','<input type="hidden" name="groupid" value="0" />','<input type="hidden" name="startdate" value="" />','<input type="hidden" name="starthour" value="" />','<input type="hidden" name="enddate" value="" />','<input type="hidden" name="endhour" value="" />');e.push('<div class="yy-date-str fl"><span>时间：</span><span class="yy-formatdate-str"></span></div>');e.push('<p class="mt10" style="clear:both;"><input type="text" id="sche_title" name="title" value="" class="input01" placeholder="日程主题" /></p>');e.push('<div class="rcAddmen mt10 clearfix relative z5"><table width="100%" cellspacing="0" cellpadding="0" border="0" class="rcAddmenTab"><tbody><tr><td valign="top">');e.push('<div class="clearfix"><ul class="clearfx fl rcAddmenListUl notice_list_p"><li class="fl"><div class="relative rcLianxiang z6 notice_div_p"><input type="text" id="sche_notice_p" name="notice_p" class="addInput2" placeholder="+ 添加参与人" /></div></li></ul></div>');e.push('</td><td valign="middle" align="center" class="rbg"><a href="',a.util.url("/space/ajax/selectmember/for/notice_div"),'" for="notice_div" class="rcAddmenr" title="添加"></a></td></tr></tbody></table></div>');e.push('<p class="mt10"><input type="text" id="sche_address" name="address" value="" class="input01" placeholder="地点" /></p>');e.push('<div class="tkFooter clearfix mt20">','<input type="button" class="yy-create-cancel button grayButton fr" value="取消" name="">','<input type="submit" class="button darkGrayButton fr" value="创建" name=""></div></form>');e.push("</div>");return e.join("")},concatTaskCreateHtml:function(){var e=[];e.push('<div class="yy-calendar-task-create" style="display:none;">');e.push('<form enctype="multipart/form-data" name="calendar_task" id="calendar_task" method="post" action="',a.util.url("/task/add/subadd"),'">');e.push('<input type="hidden" name="type" value="0" />','<input type="hidden" name="type_id" value="0" />','<input type="hidden" name="groupid" value="0" />','<input type="hidden" name="startdate" value="" />','<input type="hidden" name="starthours" value="" />','<input type="hidden" name="enddate" value="" />','<input type="hidden" name="endhours" value="" />');e.push('<div class="yy-date-str fl"><span>时间：</span><span class="yy-formatdate-str"></span></div>');e.push('<p class="mt10" style="clear:both;"><input type="text" id="task_title" name="title" value="" class="input01" placeholder="任务名称" /></p>');e.push('<div class="rcAddmen mt10 clearfix relative z8"><table width="100%" cellspacing="0" cellpadding="0" border="0" class="rcAddmenTab"><tbody><tr><td valign="top">');e.push('<div class="clearfix"><ul class="clearfx fl rcAddmenListUl notice_list_n"><li class="fl"><div class="relative rcLianxiang notice_div_n"><input type="text" id="task_notice_n" name="notice_n" class="addInput2" placeholder="+ 添加负责人" /></div></li></ul></div>');e.push('</td><td valign="middle" align="center" class="rbg"><a href="',a.util.url("/space/ajax/selectmember/for/manageuser_div"),'" for="manageuser_div" class="rcAddmenr" title="添加"></a></td></tr></tbody></table></div>');e.push('<div class="rcAddmen mt10 clearfix relative z7"><table width="100%" cellspacing="0" cellpadding="0" border="0" class="rcAddmenTab"><tbody><tr><td valign="top">');e.push('<div class="clearfix"><ul class="clearfx fl rcAddmenListUl notice_list_p"><li class="fl"><div class="relative rcLianxiang notice_div_p"><input type="text" id="task_notice_p" name="notice_p" class="addInput2" placeholder="+ 添加参与人" /></div></li></ul></div>');e.push('</td><td valign="middle" align="center" class="rbg"><a href="',a.util.url("/space/ajax/selectmember/for/joinuser_div"),'" for="joinuser_div" class="rcAddmenr" title="添加"></a></td></tr></tbody></table></div>');e.push('<div class="tkFooter clearfix mt20">','<input type="button" class="yy-create-cancel button grayButton fr" value="取消" name="">','<input type="submit" class="button darkGrayButton fr" value="创建" name=""></div></form>');e.push("</div>");return e.join("")},backCalendar:function(){var f=this,e=f.$mainGridWrapper;f.animateShowBlock(e)},activeSearchView:function(){var e=this,f=e.$mainSearchWrapper;e.animateShowBlock(f)},activeOperate:function(e){var h=this,g=h.$mainEditWrapper,f=e.attr("operate");switch(f){case"create-schedule":h.animateShowBlock(g);break}},animateShowBlock:function(h){var g=this,f=h.siblings(":visible").eq(0),j=h.index(),i=f.index(),e="-"+g.$main.height()+"px";h.css({visibility:"visible"}).show();j>i?(h.css({"margin-top":0}),f.animate({"margin-top":e},"normal","swing",function(){f.hide()})):h.animate({"margin-top":"0px"},"normal","swing",function(){f.hide()})},toggleSearchLineDetail:function(e){var h=e.closest(".yy-calendar-search-line"),g=d(".yy-calendar-search-line-detail",h);if(e.hasClass("zk")&&g.find(".yy-loading").length){var f=e.attr("resource_id");a.util.ajaxApi(a.util.url("/api/calendar/detail/feedid/")+f,function(j,i){if(i==="success"&&j){setTimeout(function(){g.html(j)},200)}},"POST","html")}g.toggle();h.toggleClass("cur");e.toggleClass("zk sq");return true},checkInCalendar:function(e){var g=parseInt(e.attr("timestamp")),f=a.calendar;g=f.getTimestamp(f.getDateObj(g));f.setDay(g);f.openCalendarView(f.viewType[2])},showErrorRange:function(h){var f=this,g=f.$body,i='<div id="yyErrorFloatbox" class="yy-floatbox rili_taskTk riliTishi relative" style="z-index:1001;display:none"><div class="yy-floatbox-main"><div class="yy-floatbox-content"><span class="icoWrongtk">您不能创建结束时间在当前时间前的任务。</span></div><p class="yy-floatbox-arrow yy-floatbox-bottom-arrow"></p></div></div>';g.append(i);f.openFloatBox({wrap:"#yyErrorFloatbox",x:h.pageX,y:h.pageY})},showNoPermission:function(h){var f=this,g=f.$body,i='<div id="yyNoPermissionFloatbox" class="yy-floatbox rili_taskTk riliTishi relative" style="z-index:1001;display:none"><div class="yy-floatbox-main"><div class="yy-floatbox-content"><span class="icoWrongtk">您不可以在Ta人的日历中创建任务和日程。</span></div><p class="yy-floatbox-arrow yy-floatbox-bottom-arrow"></p></div></div>';g.append(i);f.openFloatBox({wrap:"#yyNoPermissionFloatbox",x:h.pageX,y:h.pageY})}};a.calendarBiz=b}(jQuery,YY,YY.util));