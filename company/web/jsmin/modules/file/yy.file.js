$(document).ready(function(){$("#content_div").trigger("click");var a=1;$("#playerBtn").bind("click",function(){showFlash(playertype,imgpath,this,a,"")});$("#httpVideo").bind("click",function(){var g=$(this);showFlash(g.attr("host"),g.attr("flashvar"),this,g.attr("fid"),"share_video")});if(playertype=="video"){if($("#videoType").val()=="http"){$("#httpVideo").click()}else{$("#playerBtn").click();$("#flash_hide_"+a).hide()}}YY.util.loadScript(["lib/yy.image.js"],{fn:function(){var g=new YY.Image(".chakanCont01 img"),j=$(".yy-operate-line");var i=570,h="auto";g.setMaxSize(i,h);g.setOrigSize();$(".yy-turnleft",j).on("click",function(){g.rotate(1)});$(".yy-turnright",j).on("click",function(){g.rotate(-1)})}});$(".share_edit").live("click",function(){var g=$(this);var h=g.attr("fid");$.fancybox({modal:true,width:500,height:160,transitionIn:"elastic",transitionOut:"elastic",speedIn:200,speedOut:200,href:yyBaseurl+"/file/act/editshare/fid/"+h,onComplete:function(){$("#shareuser").yyautocomplete({appendTo:"#share_div",ajaxUrl:url("/common/search/ccnotice"),selAppendTo:"#share_list",select:function(i,j){}});$("#delshare").live("click",function(){var k=$(this);var j=k.attr("data");var i=$("#yyauto_li_"+j);YY.util.ajaxApi(yyBaseurl+"/file/act/delshare/",function(m,l){if(l==="success"&&m){i.fadeOut()}},"POST","json",{fid:h,member_id:j})})},onClosed:function(){window.location.reload()}});return false});$.yy.follow({setsId:"#atten_file",cancel:{txt:"取消关注",css:"gzGrayButton"},callback:function(g,i,k){var j=k.attr("role");var h=k.attr("for");if(g==1&&i.rs){$('<a class="yy-follow button gzGrayButton" role="'+j+'" ele_role="file" type="all" for="'+h+'" href="###">取消关注</a>').appendTo("#atten_file");k.remove()}else{if(g==0&&i.rs){$("#atten_file").html("");$('<a class="yy-follow button gzChengButton cannel" ele_role="file" role="'+j+'" for="'+h+'">加关注</a>').appendTo("#atten_file")}}}});$("a#showimage").fancybox({overlayShow:false,transitionIn:"elastic",transitionOut:"elastic",overlayShow:true});$("#filereply").yyautoWrap(140);$("a#add_version").fancybox();if(pub){$("#speechForm").bind("submit",function(){$("#speech_from_gid").val(c.val("fyd"));return true});var c=new $.yy.comboDiv({fyd:{defaultid:0,remote:yyBaseurl+"/api/info/mygroup",format:function(h){var g=h.data,k=[];for(var j in g){k.push({txt:(g[j].group_name+(g[j].pub==1?"":'<span class="icoSuo"></span>')),id:g[j].gid})}return k}}})}var b=new FlexPaperViewer(player,"viewerPlaceHolder",{config:{SwfFile:escape(imgpath),Scale:0.95,ZoomTransition:"easeOut",ZoomTime:0.5,ZoomInterval:0.2,FitPageOnLoad:true,FitWidthOnLoad:true,PrintEnabled:false,FullScreenAsMaxWindow:false,ProgressiveLoading:false,MinZoomSize:0.2,MaxZoomSize:5,SearchMatchAll:true,InitViewMode:"Portrait",button_window_mode:"Opaque",PrintPaperAsBitmap:false,ViewModeToolsVisible:true,ZoomToolsVisible:true,NavToolsVisible:true,CursorToolsVisible:false,SearchToolsVisible:false,localeChain:"zh_CN"}});(function(){var m=$("#fileTitle"),n=$(".yy-file-title",m),s=$(".placeholder",m),o=s.html(),i=s.width();if(i>125){n.animate({width:(i+5)},"normal")}m.children().bind("click",function(){i=s.width();o=s.html();n.removeClass("hidden");s.addClass("hidden");n.removeAttr("readonly").css("background","#FFF").focus();if(!s.hasClass("hidden")){var t=i<295?300:i+5;n.animate({width:t},"normal")}return false});n.blur(function(){var u=$(this),v=$.trim(u.val());str=v.replace(/<a[^>]*>/gi,"").replace(/<\/a[^>]*>/gi,"").replace(/[\u4E00-\u9FA5]/gi,"!!").replace(/\<img[\s\S]*?\/?\>/ig,"!!!!").replace(/<br[^>]*>/gi,"").replace(/\&nbsp;/gi," ");var w=Math.floor(str.length/2);if(w>28){alert("文件名不能超过28个字！");var v=h(v,28*2)}n.addClass("hidden");s.removeClass("hidden");if(v!=""&&v!=o){YY.util.ajaxApi(yyBaseurl+"/file/act/subupdate",function(){s.text(v);$(".yy-file-title").val(v);i=s.width();var x=i<125?130:(i+5);n.animate({width:x},"normal")},"POST","html","title="+v+"&fid="+f+"&type=1&ajaxsubmit=1")}else{var t=i<125?130:(i+5);n.animate({width:t},"normal")}}).keydown(function(u){var t=$(this);g(u,function(){t.blur()})});var p=$("#fileDesc"),k=$(".yy-file-desc-input",p),q=$(".placeholder",p),j=q.html(),l=q.width();if(l>125){k.animate({width:(l+5)},"normal")}p.children().bind("click",function(){l=q.width();j=q.html();k.removeClass("hidden");q.addClass("hidden");$("#picInfo").attr("href")==="#yy-file-desc-add"?k.removeAttr("readonly").css("background","#FFF").val("").focus():k.removeAttr("readonly").css("background","#FFF").focus();if(!q.hasClass("hidden")){var t=l<295?300:l+5;k.animate({width:t},"normal")}return false});k.blur(function(){var u=$(this),t=$.trim(u.val());str=t.replace(/<a[^>]*>/gi,"").replace(/<\/a[^>]*>/gi,"").replace(/[\u4E00-\u9FA5]/gi,"!!").replace(/\<img[\s\S]*?\/?\>/ig,"!!!!").replace(/<br[^>]*>/gi,"").replace(/\&nbsp;/gi," ");var v=Math.floor(str.length/2);if(v>43){alert("文件名不能超过43个字！");var t=h(t,43*2)}k.addClass("hidden");q.removeClass("hidden");if(t!=""&&t!="这个文档还没有被描述,"&&t!=j){YY.util.ajaxApi(yyBaseurl+"/file/act/subupdate",function(x,w){q.text(t);l=q.width();$("#picInfo").html("&nbsp;").attr("href","#yy-file-desc-edit")},"POST","html","content="+t+"&fid="+f+"&type=2");k.animate({width:q.css("width")},"normal")}}).keydown(function(u){var t=$(this);g(u,function(){t.blur()})});function h(y,t){var u=0;var z=0;var x="";var w=y.split("");for(var v=0;v<w.length;v++){if(v<t&&u+r(w[v])<=t){u+=r(w[v]);z=v+1}}if(y.length>z){x=y.substr(0,z)}else{x=y}return x}function r(t){aMatch=t.match(/[^\x00-\x80]/g);return(t.length+(!aMatch?0:aMatch.length))}function g(v,t){if(typeof t!=="function"){return false}var u=v.keyCode?v.keyCode:(v.which?v.which:v.charCode);if(u==13){t()}}})();$.yy.defaultText({filereply:{txt:"输入内容"}});$("#allMember").mouseover(function(){$("#fydTk").show()}).mouseout(function(){$("#fydTk").hide()});showButton();$("#filereply").bind("keyup",showButton).bind("blur",showButton);var f=$("#fid").val();var e=yyBaseurl+"/space/cons/index/id/";loadScript(["lib/common/pageskip.js"],{fn:function(){var h=$.newInstance("lib.common.pageSkip",{url:YY.util.url("/file/view/filefollow/fid/"+f),callback:function(m,l){var q=m.data.followers;var p="";var k=YY.util.url("/images/default_avatar_small.gif");if(q.length>0){for(var o=0,n=q.length;o<n;o++){p=p+'<li class="relative" tips="1" rel="'+YY.util.url("/api/ajax/partnerinfo/pid/")+q[o].id+'"><a class="vipHref" href="'+e+q[o].id+'" title="'+q[o].name+'"><img src="'+YY.util.url(q[o].avatar)+'" rel="'+k+'" /></a><i class="'+q[o].online+'"></i></li>'}}l.renderList(p)},pageSize:10,template:"#yy_skip_template"});h.render(function(j){j=j.format({fileTitle:"关注的人"});$("#yy_follow_file").html(j)});h.first();var i=$.newInstance("lib.common.pageSkip",{url:YY.util.url("/file/view/downuser/fid/"+f),callback:function(m,l){var q=m.data.followers;var p="";var k=YY.util.url("/images/default_avatar_small.gif");if(q.length>0){for(var o=0,n=q.length;o<n;o++){p=p+'<li class="relative" tips="1" rel="'+YY.util.url("/api/ajax/partnerinfo/pid/")+q[o].id+'"><a class="vipHref" href="'+e+q[o].id+'" title="'+q[o].name+'"><img src="'+YY.util.url(q[o].avatar)+'" rel="'+k+'" /></a><i class="'+q[o].online+'"></i></li>'}}l.renderList(p)},pageSize:10,template:"#yy_skip_template"});i.render(function(j){j=j.format({fileTitle:"下载的人"});$("#yy_down_file").html(j)});i.first();var g=$.newInstance("lib.common.pageSkip",{url:YY.util.url("/file/view/shareuser/fid/"+f),callback:function(m,l){var q=m.data.followers;var p="";var k=YY.util.url("/images/default_avatar_small.gif");if(q.length>0){for(var o=0,n=q.length;o<n;o++){p=p+'<li class="relative" tips="1" rel="'+YY.util.url("/api/ajax/partnerinfo/pid/")+q[o].id+'"><a class="vipHref" href="'+e+q[o].id+'" title="'+q[o].name+'"><img src="'+YY.util.url(q[o].avatar)+'" rel="'+k+'" /></a><i class="'+q[o].online+'"></i></li>'}}l.renderList(p)},pageSize:10,template:"#yy_skip_template"});g.render(function(j){j=j.format({fileTitle:"共享的人"});$("#yy_share_file").html(j)});g.first()}});$("#followcontrol").live("click",function(){var m=$("#fid").val();var j=$("#followpages").val();var i=$(this);var l=i.attr("data");var h=$("#followpage").val();if(l==1){if(h==1){alert("这是第一页！");return false}var k=parseInt(h)-1}else{if(h>=j){alert("已经到了最后一页");return false}var k=parseInt(h)+1}$("#followpage").val(k);var g="";YY.util.ajaxApi(YY.util.url("/file/view/filefollow/fid/"+m+"/page/"+k),function(n){$("#followMembers").html(n)},"POST","html",g)});$("#downcontrol").live("click",function(){var m=$("#fid").val();var l=$("#downpages").val();var i=$(this);var k=i.attr("data");var g=$("#downpage").val();if(k==1){if(g==1){alert("这是第一页！");return false}var j=parseInt(g)-1}else{if(g>=l){alert("已经到了最后一页");return false}var j=parseInt(g)+1}$("#downpage").val(j);var h="";YY.util.ajaxApi(YY.util.url("/file/view/downuser/fid/"+m+"/page/"+j),function(n){$("#downMembers").html(n)},"POST","html",h)});function d(){var k=$("#videoUrl").val();if(k){var g=$.trim(k).match(/http:\/\/.+/);var j=$("#videoPic");if(g==null){$("#videoSta").val(0);$("#errorinfo").show();$("#errorinfo").text("不支持的视频地址")}else{if(g&&j.html()==""){var h=yyBaseurl+"/file/act/ajaxvideo";var i={posturl:k};YY.util.ajaxApi(h,function(l){if(l){data=l;j.show();j.html('<a href="javascript:;" class="videoClosed" onclick="closeVideo();">重新上传</a><img src="'+data.videoPic+'" alt="'+data.title+'" />');$("#errorinfo").html("");$("#errorinfo").hide();$("#videoInput").hide();$("#videoSta").val(1)}else{$("#videoSta").val(0);$("#errorinfo").show();$("#errorinfo").text("不支持的视频地址")}},"POST","json",i)}}}}$(".uploadVersion").live("click",function(){var g=$(this);$.fancybox({modal:true,width:500,height:160,transitionIn:"elastic",transitionOut:"elastic",speedIn:200,speedOut:200,href:yyBaseurl+"/space/cons/uploaddoc/fid/"+g.attr("fid")+"/canse/0",onComplete:function(){YY.util.initUpload(function(){var h=$("#fileFromObj").val(),i=$("#fid").val(),j=new InitUpload({button_placeholder_id:"groupFileUploadBtn",upload_url:YY.util.url("/file/act/swfupload/fileFrom/")+h+"/fid/"+i})});$("#videoAddress").bind("click",function(){var h=$("#uploadVideo").is(":hidden");if(h){$("#uploadVideo").show();$(this).html("关闭媒体链接地址")}else{$("#uploadVideo").hide();$(this).html("打开媒体链接地址")}});$("#videoUrl").bind("keyup",function(i){var h=i.keyCode;if(h==86){d()}}).bind("blur",d);$("#file_delete").live("click",function(){var h=$("#fid").val();YY.util.ajaxApi(yyBaseurl+"/space/cons/ajaxcanlefile/",function(i){$.fancybox.close()},"POST","json",{fid:h})})},onClosed:function(){window.location.reload()}});return false})});$("input[name='groupDocSub']").live("click",function(){var f=$("#videoSta").val();var d=[];var c=$("form[name='myform']");$('input[name="share_div_value[]"]',c).each(function(g){d.push($(this).val())});var e=$("#fids",c).val();if(f>0){var b=YY.util.url("/file/act/urlupload");var a={videourl:$("#videoUrl").val(),fid:$("#fid").val(),videoSta:f};YY.util.ajaxApi(b,function(g){if(g.rs){$.yy.rscallback("上传成功")}else{$.yy.rscallback(g.error,1)}},"POST","json",a);$(".groupUploadColose").click()}else{if($("input.groupUploadFids").val()!=""){$(".groupUploadColose").click()}}});function showButton(){if($("#filereply").val()){$("#savesubmit").removeAttr("disabled").removeClass("darkGrayButton").addClass("blueButton")}else{$("#savesubmit").attr("disabled","true").removeClass("blueButton").addClass("darkGrayButton")}}$(".yy-delete-link").live("click",function(){$(this).closest("div").find(".yy-delete:first").trigger("click")});var tv1=10,tv2=10;$(".yy-delete").live("click",function(){var a=$(this);clearTimeout(tv1);tv2=setTimeout(function(){a.children(".delTk").length?a.children(".delTk").removeClass("hidden"):a.append('<aside class="delTk">确定要删除该文档？<br/><a href="#yy-delete-confirm" class="yy-delete-confirm">删除</a> <a href="#yy-delete-cancel" class="yy-delete-cancel">不删除</a><span class="sj xsj"></span></aside>');$(".yy-file-operate-list").trigger("mouseleave");a.closest("td").removeClass("yy-file-operate-list")},300)});$(".feed-delete-confirm").live("click",function(){var b=$(this).closest("div").parent().find(".yy-delete-link").attr("for");var a=location.href.split("?")[0];var c=$(this).closest("div").parent().find(".yy-delete-link").attr("fid");$(this).closest("td").addClass("yy-file-operate-list");data="fid="+c+"act="+a;$.ajax({type:"POST",url:yyBaseurl+"/file/act/delattach",data:data,success:function(d){if(d==1){$.yy.rscallback("删除成功");window.location.reload()}else{if(d==0){$.yy.rscallback("删除失败")}}}})});$(".yy-delete-cancel").live("click",function(){var a=$(this);a.closest(".delTk").addClass("hidden");$(this).closest("td").addClass("yy-file-operate-list");return false});function trim(a){return a.replace(/(^\s*)|(\s*$)/g,"")}function closeVideo(){$("#videoSta").val(0);$("#videoPic").html("");$("#videoPic").hide();$("#videoInput").show();$("#videoUrl").val("");$("#errorinfo").html("")};