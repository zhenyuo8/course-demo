$(document).ready(function(){$("#speechForm, #addForm, #voteForm, #taskaddForm").unbind("submit").live("submit",function(){if($("#fyd").attr("data")>=0){$("input[name='groupid']").val($("#fyd").attr("data"))}$("#speech_content").val($("#content_div").html())});var c=new $.yy.comboDiv({att:{labelcss:"",data:[{txt:"全部",id:"all"},{txt:"发言",id:"speech"},{txt:"投票",id:"vote"}],callback:function(e){YY.util.ajaxApi(url("/api/feed/group"),function(f){$("#yy_conversation_content").html("");$(f).appendTo("#yy_conversation_content")},"POST","html",{filter:e,ajaxpend:1,gid:$("#feed_div").attr("data")})}}});$.yy.defaultText({email:{txt:"邮箱"}});$(".groupYqButton,.subQz_inviteMember").live("click",function(){var f=$(this);if(f.attr("flag")<=0){$.yy.rscallback("您没有权限进行此操作！");return false}var e=$(this).attr("data")==0?"#invite_box":yyBaseurl+"/group/ajax/invite/gid/"+$(this).attr("data");$.fancybox({modal:true,width:500,height:160,transitionIn:"elastic",transitionOut:"elastic",speedIn:200,speedOut:200,href:e,onComplete:function(){$.yy.defaultText({inviteName:"请输入姓名或者邮箱"});h();$("#inviteName").yyautocomplete({appendTo:"#invite_div",ajaxUrl:url("/common/search/ccnotice"),selAppendTo:"#invite_list",select:function(i,j){}});var g=$(".addInviteMember").height();function h(){YY.log(111);var i=$(".addInviteMember").height();var j=$(".cyAdd").height()-i;if($(".groupMemlist").height()<j){$(".groupMemberDiv").css({"overflow-x":"hidden","overflow-y":"hidden"})}else{$(".groupMemberDiv").css({height:j,"overflow-x":"hidden","overflow-y":"scroll"})}}setTimeout(h,1000);$("input[name='groupInviteSubForm']").bind("click",function(){$("#invite_list li.rcAddmenListli").length>0?$(this).closest("form").submit():""})}})});var a=["modules/space/yy.space.title.js","modules/space/yy.space.js","modules/space/yy.space.speech.js"];YY.util.loadScript(a,{async:true});YY.util.initUpload(function(){YY.util.loadScript(["lib/upload/upload.js"])});function d(){var i=$("#videoUrl").val();if(i){var e=$.trim(i).match(/http:\/\/.+/);var h=$("#videoPic");if(e==null){$("#videoSta").val(0);$("#errorinfo").show();$("#errorinfo").text("不支持的视频地址")}else{if(e&&h.html()==""){var f=yyBaseurl+"/file/act/ajaxvideo";var g={posturl:i};YY.util.ajaxApi(f,function(j){if(j){data=j;h.show();h.html('<a href="javascript:;" class="videoClosed" onclick="closeVideo();">重新上传</a><img src="'+data.videoPic+'" alt="'+data.title+'" />');$("#errorinfo").html("");$("#errorinfo").hide();$("#videoInput").hide();$("#videoSta").val(1)}else{$("#videoSta").val(0);$("#errorinfo").show();$("#errorinfo").text("不支持的视频地址")}},"POST","json",g)}}}}$("#uploadProgressBar").hide();$(".uploadFileGroup").live("click",function(){var e=$(this);if(e.attr("flag")<=0){$.yy.rscallback("您没有权限进行此操作！");return false}$.fancybox({modal:true,width:500,height:160,transitionIn:"elastic",transitionOut:"elastic",speedIn:200,speedOut:200,href:yyBaseurl+"/group/index/uploaddoc/gid/"+e.attr("data")+"/from/"+e.attr("from"),onComplete:function(){YY.util.initUpload(function(){var g=$("#fileFromObj").val();var f=new InitUpload({button_placeholder_id:"groupFileUploadBtn",upload_url:YY.util.url("/file/act/swfupload/fileFrom/")+g+"/gid/"+$("#gid").val()})});$("#videoAddress").bind("click",function(){var f=$("#uploadVideo").is(":hidden");if(f){$("#uploadVideo").show();$(this).html("关闭媒体链接地址")}else{$("#uploadVideo").hide();$(this).html("打开媒体链接地址")}});$("#videoUrl").bind("keyup",function(g){var f=g.keyCode;if(f==86){d()}}).bind("blur",d)},onClosed:function(){window.location.reload()}});return false});$("input[name='groupDocSub']").live("click",function(){var k=$("#videoSta").val();var g=$("form[name='myform']");var j=$("#fids",g).val();var i=$("#gid",g).val();if(k>0){var f=YY.util.url("/file/act/urlupload");var e={videourl:$("#videoUrl").val(),gid:i,videoSta:k};YY.util.ajaxApi(f,function(n){if(n.rs){if(j){var m=j+","+n.data.fid}else{var m=n.data.fid}if(i){var l={fids:m,fileFromObj:$("#fileFromObj",g).val(),gid:i};YY.util.ajaxApi(g.attr("action"),function(o){if(o.rs){$.yy.rscallback("上传成功")}else{$.yy.rscallback(o.error,1)}},"POST","json",l)}}else{$.yy.rscallback(n.error,1)}},"POST","json",e)}else{if($("input.groupUploadFids").val()!=""){var g=$("form[name='myform']"),i=$('input[name="gid"]',g).val();if(i){var h={fids:$("#fids",g).val(),fileFromObj:$("#fileFromObj",g).val(),gid:i};YY.util.ajaxApi(g.attr("action"),function(l){if(l.rs){$.yy.rscallback("上传成功")}else{$.yy.rscallback(l.error,1)}},"POST","json",h)}}}$(".groupUploadColose").click()});$("#invite_sub").bind("click",function(){if($("#email").val()==""){$("#email_yy_dl").html("邮箱不能为空！");return false}YY.util.ajaxApi(yyBaseurl+"/group/index/subinvite",function(e){if(e.rs=="error"){$("#invite_sub").prev().html(e.error);return false}else{$("a[class^='invite_close']").trigger("click")}$.yy.rscallback("邮件已发送")},"POST","JSON",{email:$("#email").val()})});$("select[name='documentType']").change(function(){$("form[name='myform']").submit()});$("a.subQz_inviteMember").length>0?$("a.subQz_inviteMember").trigger("click"):"";if($("#yyGroupTable").length>0){var b=yyBaseurl+"/file/file/ajaxindex/flag/"+$(".uploadFileGroup").attr("data");YY.util.loadScript(["plugin/yy.dataTable.js"],{fn:function(){var f=new YY.DataTable({selector:"#yyGroupTable",actLine:"#yyGroupPage",pageLine:".yy-page-line",pageBtn:".yy-page",nextBtn:".yy-next-page",prevBtn:".yy-prev-page",firstBtn:".yy-first",lastBtn:".yy-last",perPage:15,pageCount:15,remoteUrl:YY.util.url(b),isOnce:false,success:function(){}});function e(m,l,o){var n=f;n.setRemoteUrl(m);n.reloadTable(o);if(l){$("#leftcontent_1").addClass("hidden");$("#leftcontent_2").addClass("hidden");$("#leftcontent_3").addClass("hidden")}}$(".searchfiletype").live({mouseenter:function(){var l=$(this);l.children("aside").removeClass("hidden")},mouseleave:function(){var l=$(this);l.children("aside").addClass("hidden")}});$(".searchfiletype a").live("click",function(){var n=$(this);var o=n.attr("data");var l=$(".uploadFileGroup").attr("data");var m=YY.util.url("/file/file/ajaxindex/flag/"+l+"/fileext/"+o);e(m,0,function(){var r=n.html(),p=n.index()+1,q=$(".searchfiletype a");q.show();q.eq(p).hide();$(".typeAll").html(r)});return false});$(".yy-file-operate-list","#yyGroupTable").live({mouseenter:function(){var l=$(this);l.children().addClass("relative").children("aside").removeClass("hidden")},mouseleave:function(){var l=$(this);l.children().removeClass("relative").children("aside").addClass("hidden")}});$.yy.followCommon({setsId:"#yyGroupTable",confirm:{txt:"关注",css:"confirm"},cancel:{txt:"取消关注",css:"cancel"},reload:false,followSelector:".yy-follow-doc"});var k=10,i=10,h="doc-del-containter",g="doc-del-confirm",j="doc-del-cancel";$(".doc-del").live("click",function(){var n=$(this),p=n.closest("div.yy-file-operate-list").parent(),o=n.attr("fid"),m=n.attr("for"),l=n.attr("flag"),q=n.attr("callback");clearTimeout(k);i=setTimeout(function(){p.children("."+h).length?p.children(".delTk").removeClass("hidden"):p.append('<div class="delLay relative fl yy-delete z5" style="left:48px;top:20px;"><aside class="delTk doc-del-containter">确定要删除该'+n.attr("name")+'？<br/><a href="javascript:;" url="'+m+'" fid="'+o+'"'+((typeof(l)!="undefined")?' flag="'+l+'"':"")+((typeof(q)!="undefined")?' callback="'+q+'"':"")+' class="'+g+'">删除</a> <a href="javascript:;" class="'+j+'">不删除</a><span class="sj xsj"></span></aside></div>');$(".yy-file-operate-list").trigger("mouseleave")},300);return false});$("."+g,"#yyGroupTable").live("click",function(){var m=$(this),l=m.attr("url"),n=m.closest("."+h);n.addClass("hidden");$.ajax({type:"GET",url:l,success:function(o){if(o==1){$.yy.rscallback("删除成功");m.closest("tr").remove()}else{if(o==0){$.yy.rscallback("删除失败")}}}});return false});$("."+j,"#yyGroupTable").live("click",function(){var l=$(this);l.closest("."+h).addClass("hidden");return false})}})}});function closeVideo(){$("#videoSta").val(0);$("#videoPic").html("");$("#videoPic").hide();$("#videoInput").show();$("#videoUrl").val("");$("#errorinfo").html("")};