var blogReplySubmitCallback=function(f,j,e,k,c){var g=e.closest(".reply-placeholder-block").find(".yyFeedReplyBox:first");var h='<div class="gzContHuifu clearfix yy-reply-list-div yy-reply-list-top2 reply-block" reply_id="'+f.data.id+'">';h+='<figure class="fl c9a">'+f.data.avatar_url+"</figure>";h+='<section class="fl gzContRight" resource-id="'+f.data.id+'">';h+='<h2 class="line16">';h+='<a href="'+yyBaseurl+"/space/cons/index/id/"+f.data.user_id+'" class="blueLink">'+f.data.user_name+'</a> 回复 <a href="'+yyBaseurl+"/space/cons/index/id/"+(c.feed_reply_to_mid?c.feed_reply_to_mid:c.feed_reply_obj_mid)+'" class="blueLink">'+c.feed_reply_to_name+"</a> ："+f.data.content+"</h2>";if(f.data.files){var a=f.data.files[0];var b=a.length;h+='<ul class="new_dt_fj mt10">';for(i=0;i<b;i++){if(a[i].isImg==false){h+='<li class="cur">';h+="<article>";h+='<figure class="fl"><a class="ico_'+a[i].ext+'_s"></a></figure>';h+='<section class="fl secr">';h+='<a class="fl name" href="#">'+a[i].title+"</a>";h+='<div class="fr dtlist_but">';h+='<a class="fd_ico blueLink2" href="'+yyBaseurl+"/file/view/index/fid/"+a[i].fid+'">预览</a>';h+='<a class="xz_ico blueLink2" href="'+yyBaseurl+"/file/act/down/fid/"+a[i].fid+'">下载</a>';h+='<a class="ck_ico blueLink2" href="'+yyBaseurl+"/file/view/index/fid/"+a[i].fid+'">查看文档主页</a>';h+="</div></section></article></li>"}}h+="</ul>";h+='<ul class="new_tup_fj clearfix mb10">';for(i=0;i<b;i++){if(a[i].isImg==true){h+='<li class="mr10 yyFeedReplyAttchmentPic" data="'+a[i].fid+'" reply-id="'+f.data.id+'"><img src="'+a[i].filepath+'" /></li>'}}h+="</ul>"}if(f.data.replyDelUrl){h+='<div class="line18 gzContRighta c9a clearfix mt5"><span class="fl c6">1秒前</span><div class="fr relative yyFeedReplyOp hidden"><a class="blueLink2 yyFeedReplyAdd" href="javascript:;">回复</a><a class="blueLink2 relative yyFeedReplyDel" href="javascript:;">删除</a><aside class="delTk hidden">确定要删除该事件？<br><a class="yy-delete-confirm" href="#yy-delete-confirm"';h+="action=";h+=f.data.replyDelUrl;h+='>删除</a> <a class="yy-delete-cancel" href="#yy-delete-cancel">不删除</a><span class="sj xsj"></span></aside></div></div>'}else{h+='<div class="line18 gzContRighta c9a clearfix mt5"><span class="fl c6">1秒前</span><div class="fr relative yyFeedReplyOp hidden"><a class="blueLink2 yyFeedReplyAdd" href="javascript:;">回复</a><a class="blueLink2 relative yyFeedReplyDel" href="javascript:;">删除</a><aside class="delTk hidden">确定要删除该事件？<br><a class="yy-delete-confirm" href="#yy-delete-confirm">删除</a> <a class="yy-delete-cancel" href="#yy-delete-cancel">不删除</a><span class="sj xsj"></span></aside></div></div>'}h+='<div class="yyFeedReplyBoxDiv hidden">';if(f.data.replyUrl){h+='<form method="post" class="yy-upload-block "action='+f.data.replyUrl+" >"}else{h+='<form method="post" class="yy-upload-block">'}h+='<div class="textarea01 mt10 yy-contentDiv cor_3c" contenteditable="true" onpaste=" var self = this;setTimeout(function(){ coreFun.paste(self); },50);"></div><div class="yy-upload-containter"><div class="barBox clearfix yy-upload-bar-containter yy-upload-process-container" style="display: none;"><div class="grayBar mt10 fl"> <span class="blueBar yy-upload-process-bar"></span> </div><a href="javascript:;" class="fr c6Link yy-upload-process-cancel">×</a></div><div class="mt10 rcFjList"><ul class="yy-upload-file_containter yy-uploaded-file-list" style="display: none;"></ul></div></div><div class="clearfix gzContHfht rcAddFj z3 mt5 yyFeedReplyBox"><div class="fl relative mt8 ya_talkConIcon yy-feedIco">';h+='<a title="添加表情" class="icon_face fl yy_face_sh" href="javascript:;"></a>';h+='<ul class="faces_list clearfix faces_list clearfix z6 yy-feedFaceUl" style="display:none;">';h+=e.closest(".yyFeedReplyBox").find(".yy-feedFaceUl:first").html();h+="</ul>";h+='<a title="@" class="icon_ait fl yy_replay_at" href="javascript:;"></a><a title="添加文档" class="icoWd fl yy-file-upload-ico" href="javascript:;"></a><aside class="tkBox c3a yy-file-upload-aside" style="top: -99999px;"><a href="#yy-file-upload-ico" class="icoSc yy-file-upload-swf"><span class="yy-file-uploadbtn">上传文件</span></a><a href="'+yyBaseurl+'/api/file/selected" class="selectedfileBtn icoSel">选择空间文档</a></aside></div><div class="fr rcChuang"><input type="hidden" name="fids" value="" />';h+='<input type="hidden" value="'+c.feed_reply_to_id+'" name="feed_reply_to_id" />';h+='<input type="hidden" value="'+c.id+'" name="qzfeed_id" />';h+='<input type="hidden" value="'+c.feed_type+'" name="feed_type" />';h+='<input type="hidden" value="'+c.feed_reply_to_name+'" name="feed_reply_to_name" />';h+='<input type="hidden" name="file_group_id" value="" />';h+='<input type="hidden" value="'+c.feed_reply_to_mid+'" name="feed_reply_to_mid" />';h+='<input type="hidden" value="'+c.feed_reply_obj_mid+'" name="feed_reply_obj_mid" />';h+='<textarea name="feed_reply_content" class="hidden reply-area"></textarea>';h+='<input type="button" value="发布" class="button gzGrayButton fr yy-replySubmit"/>';h+="</div></div></form></div>";h+="</section></div>";g.after(h);k.find(".textarea01").html("");k.find(".yy-uploaded-file-list").html("")};var blogScrollAddlisten=function(h,f,d){f=f.toLowerCase();var c,b,a;if(f.indexOf("on")==0){c=f;b=f.substr(2)}else{c="on"+f;b=f}if(c=="onmousewheel"||c=="mousewheel"||b=="ondommousescroll"||b=="dommousescroll"){c="onmousewheel";b="DOMMouseScroll";a="mousewheel"}try{h.addEventListener(b,d,true);if(a){h.addEventListener(a,d,true)}}catch(g){h.attachEvent(c,d);try{window.event.cancelBubble=true}catch(g){}}};var blog={ajax_handel:false,url:"/blog/blog/",dataType:"json",tmp:new Array(),tag:new Array(),type:new Array(),contentfont:"14px",resubmit:false,async:true,status:false,init:function(){blog.url="/blog/blog/";blog.dataType="json";blog.tmp=new Array();blog.tag=new Array();blog.type=new Array();blog.contentfont="14px"},autoReply:function(){var a=$("#blog_input_show_id").val();replayface.rangeFocus($(".yy-contentDiv")[0]);replayface.rememberCurrentRange();blog.blogreplyMore(a)},addtag:function(){var c=$("#tag").val();if($.trim(c)==""){return false}$("#tag").attr("value","");$("#tag").focus();var a=blog.tag.length;var b=0;if(a){for(b=0;b<a;b++){if(blog.tag[b]==c){return false}}}blog.tag.push(c);$("#taglist_show").prepend('<li><a href="javascript:;">'+c+'</a><a href="javascript:;" class="delbut" id="0" data="'+c+'"></a></li>')},addtype:function(){if(blog.resubmit){$.yy.rscallback("请不要重复提交",1);return false}$("#showaddtypetip").html("");$(".typelen").css("color","");$(".typestring").css("color","");var c=$("#blog_input_typename").val();var a=blog.strlen(c);if(c==""||a>12){$(".typelen").css("color","#ff0000");return false}var b=/^(\w|-|_|~|[\u4E00-\u9FA5])*$/;if(!c.match(b)){$(".typestring").css("color","#ff0000");return false}blog.resubmit=true;blog.tmp.func="addType";blog.tmp.typename=c;blog.ajax("addType","POST","name="+encodeURIComponent(c))},boxdata:function(){$("input[name='blog_checkbox']").each(function(a,b){if($(b).attr("checked")=="checked"){blog.tmp.push($(b).attr("value"))}});return blog.tmp.join(",")},revert:function(a){if(a==0){a=blog.boxdata()}else{blog.tmp.push(a)}$(".blog-recyclebin-delete").addClass("hidden");$(".blog-recyclebin-revert").addClass("hidden");if(a){blog.tmp.func="revert";blog.ajax("revert","GET","id="+a)}else{$.yy.rscallback("请选择要删除的项",1);return false}},blog_delete:function(a){if(a==0){a=blog.boxdata()}else{blog.tmp.push(a)}$(".blog-recyclebin-delete").addClass("hidden");$(".blog-recyclebin-revert").addClass("hidden");if(a){blog.tmp.func="delete";blog.ajax("delete","GET","id="+a)}else{$.yy.rscallback("请选择要删除的项",1);return false}},edit_blog_type:function(a){$("#edit_type_"+a).addClass("hidden");$("#show_type_name_"+a).addClass("hidden");$("#type_name_"+a).removeClass("hidden");$("#save_type_"+a).removeClass("hidden")},move:function(a){blog.tmp.blog_id=a;blog.tmp.func="blog_move";blog.url="/blog/blog/ajax/r/";blog.ajax("move","GET","id="+a)},save_type:function(d){var b=$("#type_name_"+d).val();var c=$("#show_type_name_"+d).html();if(c==b){$("#show_type_name_"+d).removeClass("hidden");$("#edit_type_"+d).removeClass("hidden");$("#type_name_"+d).addClass("hidden");$("#save_type_"+d).addClass("hidden");return false}var a=blog.strlen(b);if(a==0){alert("请填写分类名称");return false}if(a>12){alert("分类名称长度不超过12个英文字母或6个汉字长度");return false}if(b){blog.tmp.func="save_type";blog.tmp.type_id=d;blog.tmp.typename=b;blog.url="/blog/type/";blog.ajax("update","POST","id="+d+"&name="+encodeURIComponent(b))}},deleteType:function(a){blog.url="/blog/type/";blog.tmp.type_id=a;blog.tmp.func="deleteType";blog.ajax("delete","GET","id="+a)},changeFont:function(a){$(".rzContent").find("p").css("font-size",a)},create_type:function(){var c=$("#create_type_name").val();c=$.trim(c);var a=blog.strlen(c);if(a==0){alert("请填写分类名称");return false}var b=/^(\w|[\u4E00-\u9FA5])*$/;if(!c.match(b)){$.yy.rscallback("分类名称由12个英文字母或6个汉字组合");return false}if(a>12){alert("分类名称长度不超过12个英文字母或6个汉字长度");return false}$("#create_type_btn").attr("disabled","disabled");blog.type.push(c);blog.tmp.func="create_type";blog.tmp.typename=c;blog.url="/blog/type/";blog.ajax("add","POST","name="+encodeURIComponent(c))},strlen:function(a){a=a.replace(/<a[^>]*>/gi,"").replace(/<\/a[^>]*>/gi,"").replace(/[\u4E00-\u9FA5]/gi,"12").replace(/\<img[\s\S]*?\/?\>/ig,"1234").replace(/<br[^>]*>/gi,"").replace(/\&nbsp;/gi,"");return Math.floor(a.length/2)},trim:function(a){return a.replace(/(^\s*)|(\s*$)/g,"")},forwarding:function(e){blog.tmp.func="forwarding";blog.tmp.blog_id=e;var b=$('input[name="privacy"]:checked').val();var c=$("#blog_type").val();var a=blog.tag.join(",");var d=$("#blog_description").val();blog.url="/blog/blog/ajax/r/";blog.ajax("forwarding","POST","id="+e+"&privacy="+b+"&show_type="+c+"&taglist="+encodeURIComponent(a)+"&desc="+encodeURIComponent(d))},calendarUrl:function(){var a=$("#calendar_member_id").val();if(a=="undefined"){a=0}return YY.util.url("/blog/blog/ajax/r/count/id/"+a+"/date/")},typeBlogList:function(b,a){blog.tmp.func="type_blog_list";blog.url="/blog/blog/ajax/r/type_blog/";if(a=="undefined"){a=0}blog.ajax("list","GET","id="+b+"&uid="+a)},blogreplyMore:function(a){blog.url="/api/feed/blogreply/";blog.tmp.func="blog_reply_list";blog.tmp.blog_id=a;var b=$("#blog_last_feed_id_"+a).val();blog.tmp.offset=b;blog.ajax("","POST","objId="+a+"&objType=60&offset="+b)},deleteTag:function(a,b){blog.url="/blog/tag/";blog.tmp.func="deleteTag";blog.ajax("move","POST","blog_id="+a+"&tag_id="+b)},blogScroll:function(a){a.css("height","115px");blogScrollAddlisten(a[0],"mousewheel",function(g){var j=arguments[0]||window.event;var k=j.wheelDelta?j.wheelDelta/120:(0-j.detail/3);$list=a.find(".blog_follow_member");var h=$list.position().top,b=a.height(),f=$list.height(),c=f+b/2,d=0;h=h+(k*80);if(h>0){h=0}if(h<(b-c)){h=(b-c)}$list.css("top",h);try{j.preventDefault()}catch(j){}return false})},ajax:function(a,c,b){ajax_handel=$.ajax({type:c,url:blog.url+a,data:b,async:blog.async,success:function(d){blog.callback(d)},error:function(d){blog.callback(d)},complete:function(){},dataType:blog.dataType})},callback:function(f){var e=blog.tmp.func;switch(e){case"add":if(f.code==0){alert("标签已经存在，请换一个):")}else{if(f.code>0){$("#blog_tag").prepend('<option selected value="'+json.code+'">'+tmp.tagname+"</option>")}}break;case"addType":if(f.code==-2){$.yy.rscallback("分类已经存在，请换一个):",1);$("#blog_input_typename").focus()}else{if(f.code>0){$("#blog_type").prepend("<option value='"+f.code+"' selected>"+blog.tmp.typename+"</option>");$("#addtypediv").CloseDiv()}}blog.resubmit=false;break;case"deleteTag":blog.status=f.code;break;case"blog_move":if(f.code==1){var b=blog.tmp.blog_id;$("#blog_show_content_"+b).fadeOut(500)}break;case"forwarding":if(f.code==1){alert("转发成功")}break;case"revert":var a=blog.tmp.length;var c=0;if(a>0){for(c=0;c<a;c++){$("#blog_tr_"+blog.tmp[c]).remove()}}$("#blog_checkbox").removeAttr("checked");blog.tmp=new Array();break;case"delete":if(f.code==1){var a=blog.tmp.length;var c=0;if(a>0){for(c=0;c<a;c++){$("#blog_tr_"+blog.tmp[c]).remove()}}$("#blog_checkbox").removeAttr("checked");blog.tmp=new Array()}break;case"deleteType":blog.status=f.code;if(f.code==1){$("#blog_type_"+blog.tmp.type_id).remove()}break;case"create_type":$("#create_type_btn").removeAttr("disabled");if(f.code>0){var d='<tr class="odd" id="blog_type_'+f.code+'"><td><span id="show_type_name_'+f.code+'">'+blog.tmp.typename+'</span><input type="text" class="setText hidden" name="type_name" id="type_name_'+f.code+'" value="'+blog.tmp.typename+'"  ></td><td><a class="button blueButton hidden" href="javascript:;" id="save_type_'+f.code+'" onclick="blog.save_type('+f.code+')">保存</a><a class="button blueButton" href="javascript:;" id="edit_type_'+f.code+'"onclick="blog.edit_blog_type('+f.code+')">编辑</a><a class="button gzGrayButton blog_type_delete_ck" href="javascript:;" >删除</a><div style="left:-80px;top:1px;" class="delLay yy-delete z5 hidden"><aside class="delTk">确定要删除该主题？<br><a style="color:#FFF" class="feed-delete-confirm blog-type-delete-confirm" href="javascript:;" data="'+f.code+'">删除</a><a class="yy-delete-cancel blog-type-delete-cancel" href="javascript:;">不删除</a><span class="sj xsj"></span></aside></td></tr>';$("#create_type").before(d)}else{if(f.code==-2){$.yy.rscallback("分类已经存在，请换一个):",1)}else{if(f.code==0){$.yy.rscallback("请稍候再试",1)}}}$("#create_type_name").attr("value","");break;case"type_blog_list":if(f.code==1){if(f.html){$("#blog_content_view").hide().html(f.html).fadeIn(1000)}}break;case"save_type":if(f.code==1){var g=blog.tmp.type_id;$("#type_name_"+g).addClass("hidden");$("#save_type_"+g).addClass("hidden");$("#edit_type_"+g).removeClass("hidden");$("#show_type_name_"+g).html(blog.tmp.typename).removeClass("hidden")}break;case"blog_reply_list":var b=blog.tmp.blog_id;if(f.data){$("#blog_last_feed_id_"+b).attr("value",f.offset);if(f.count!=0){if(f.count==10){$(".blog_reply_more_"+b).css("display","")}else{$(".blog_reply_more_"+b).css("display","none")}if(blog.tmp.offset==0){$(".blog_reply_div_"+b).html(f.data)}else{$(".blog_reply_div_"+b).append(f.data)}}else{$(".blog_reply_more_"+b).css("display","none")}}break;default:}blog.init()}};$(document).ready(function(){$("#fontsmall").click(function(){if(blog.contentfont=="16px"){blog.changeFont("14px");blog.contentfont="14px"}else{var m=$(this).attr("class");if(m!="fontS"){$(this).removeClass("fontSd");$(this).addClass("fontS");$("#fontbig").removeClass("fontD");$("#fontbig").addClass("fontDd");blog.changeFont("12px");blog.contentfont="14px"}}});$("#fontbig").click(function(){if(blog.contentfont=="16px"){$("#fontsmall").removeClass("fontS");$("#fontsmall").addClass("fontSd");$(this).removeClass("fontDd");$(this).addClass("fontD");blog.changeFont("16px")}else{var m=$(this).attr("class");if(m!="fontD"){blog.changeFont("14px");blog.contentfont="16px"}}});$("#blog_addtype").click(function(){$("#addtypediv").OpenDiv();$("#blog_input_typename").focus()});$("#blog_closetype").click(function(){$("#addtypediv").CloseDiv()});$("#blog_addtype_btn").click(function(){blog.addtype()});$(".open_follow_list").click(function(){var m=$(this).attr("val");var n=$(this).hasClass("rzAddIcon");if(n){$(this).removeClass("rzAddIcon");$(this).addClass("rzMinusIcon");$("#follow_list_"+m).show();blog.blogScroll($(".blog_follow_scro_"+m))}else{$(this).removeClass("rzMinusIcon");$(this).addClass("rzAddIcon");$("#follow_list_"+m).hide();$(".blog_follow_scro_"+m).css("height",0)}});$(".rzMinusIcon").click(function(){var m=$(this).attr("val");$(this).removeClass("rzMinusIcon");$(this).addClass("rzAddIcon");$("#follow_list_"+m).css("display","none")});$(".blog_type_view").click(function(){var p=$(this).find("#blog_type_id").val();var m=$("#blog_member_id").val();var n=$(this).attr("data");var o=$(this).find("#blog_type_name").html();if(n==0){$.yy.rscallback("【"+o+"】0篇博客");return false}if(m!=0){$("#show_type_name").html("【"+o+"】")}else{$("#blog_me").addClass("meCur")}blog.typeBlogList(p,m)});$("#blog_savebtn").click(function(){var p=$("#title").val();p=$.trim(p);var n=blog.strlen(p);if(p=="标题"){$.yy.rscallback("请输入标题",1);return false}if(n==0){$.yy.rscallback("标题不能为空");return false}if(n>30){$.yy.rscallback("您输入的标题长度超出限制");return false}var o=$("#content").val();var o=blog.trim(o);n=blog.strlen(o);if(n==0){$.yy.rscallback("请输入博客内容",1);return false}var m=blog.tag.join(",");$("#taglist").attr("value",m);$(this).attr("disabled","disabled");$("#frm_blog_save").submit()});$("#blog_addtag").click(function(){blog.addtag()});$("#title").focus(function(){var m=$.trim($(this).val());if(m=="标题"){$(this).attr("value","")}}).blur(function(){var m=$.trim($(this).val());if(m==""){$(this).attr("value","标题")}});$("#blog_checkbox").click(function(){var m=false;if($(this).attr("checked")=="checked"){m=true}$("input[name='blog_checkbox']").each(function(){$(this).attr("checked",m)})});$(".rzOtherKind").click(function(){$(this).css("display","none");$(".blog_type_other").css("display","")});$(".delbut").live("click",function(){var n=$(this).attr("data");var o=$(this).attr("id");blog.async=true;if(o){blog.deleteTag(o,n)}var m=blog.tag.length;for(i=0;i<m;i++){if(blog.tag[i]==n){blog.tag.splice(i,1)}}$(this).parent().remove()});$(".rzlistFoot").mouseover(function(){$(this).find(".blogact").removeClass("hidden")}).mouseout(function(){$(this).find(".blogact").addClass("hidden")});$(".yy-feedReplySpan").live("click",function(){var m=$(this).attr("id");var n=$(this).next().hasClass("hidden");if(n){blog.blogreplyMore(m,0)}});var g=new RefMiniCalendar({selector:"#blogMiniCalendar",day_attr:{tips:1},ref:blog.calendarUrl()},{position:"top",wrapper:"#blogMiniCalendar",tipClass:"riliTk",remote:true,events:"hover"});var h=new refReply({replyContainersSelector:"li.yy-reply-li",replySubmitCallback:blogReplySubmitCallback});var d=location.href;var j=d.indexOf("/blog/blog/index/");var l=d.indexOf("/blog/blog/me/");var b=d.indexOf("/blog/blog/add/");var e=d.indexOf("/blog/blog/edit/");var f=d.indexOf("/blog/blog/show/");var c=d.indexOf("/blog/blog/member/");if(c!=-1||l!=-1){g.init()}if(f!=-1){blog.autoReply()}h.init();$(".yy-delete-cancel").live("click",function(){var m=$(this);m.closest(".delTk").addClass("hidden");return false});$(".yy-delete-confirm").live("click",function(){var n=$(this);var m=n.attr("action")?n.attr("action"):yyBaseurl+"/space/ajax/delreply",o={id:n.closest("section").attr("resource-id")};YY.util.ajaxApi(m,function(q,p){if(q&&q.rs==true&&q.type==="delete"&&p==="success"){n.closest(".delTk").addClass("hidden").closest(".gzContHuifu ").hide("normal",function(){var r=$(this);if(!r.hasClass("yy-reply-list-top2")){var u=r.closest(".yy-feed-section");var t=$(".yy-reply-list-li",u).length-$(".yy-reply-list-top2",u).length;if(t>1){var s=$(".yy-reply-more-num",u);s.html(parseInt(s.html())-1)}else{$(".gzMore",u).remove()}}$(this).remove()})}},"GET","json",o);return false});var a=10,k=10;$(".yyFeedReplyDel").live("click",function(){var m=$(this);clearTimeout(a);k=setTimeout(function(){m.parent().find("aside").removeClass("hidden")},300)});$(".yy-reply-list-div").live("mouseover",function(){$(this).find(".yyFeedReplyOp").removeClass("hidden")}).live("mouseout",function(){$(this).find(".yyFeedReplyOp").addClass("hidden")});$(".yyFeedReplyAdd").live("click",function(){var m=(new Date()).getTime();$(".yyFeedReplyBoxDiv").addClass("hidden");var n=$(this).closest("section").find(".yyFeedReplyBoxDiv");n.removeClass("hidden").find(".yy-file-uploadbtn").attr("id",m);YY.util.initUpload(function(){new InitUpload({button_placeholder_id:m,upload_url:YY.util.url("/file/act/swfupload/fileFrom/")+20+"/gid/"+n.find('input[name="file_group_id"]').eq(0).val()})})})});