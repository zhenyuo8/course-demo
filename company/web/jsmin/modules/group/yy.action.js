$(document).ready(function(){$("input[name='groupAdd_btn']").bind("click",function(){$("a#showGroupadd").trigger("click")});$("#groupTabList input.join").live("click",function(){var f=$(this).attr("data");c(f,1,$(this))});$("#groupTabList a.quit").live("click",function(){var f=$(this).attr("data");c(f,2,$(this))});function c(g,f,h){$.get(yyBaseurl+"/group/lists/opmemberstatus/gid/"+g+"/flag/"+f,function(i){var j=$(h).parents("td");switch(i.rs){case 1:if(typeof($(j).attr("data"))=="undefined"){$(j).html('<aside class="groupSet"><span class="buttonBox"><a href="javascript:;" class="c3Link icoBluer">已加入</a> | <a href="javascript:;" class="quit" data="'+g+'">退出</a></span></aside>');$(j).prev().html(parseInt($(j).prev().html())+1)}else{$(j).html('<input type="button" name="verify" value="审核中" class="button grayGz" >')}break;case 2:if($(j).attr("data")=="mylist"){$(j).parent().hide()}else{$(j).html('<input type="button" name="join" value="立即加入" class="join button blueGz" data="'+g+'" />');$(j).prev().html(parseInt($(j).prev().html())-1)}break;case"error":break}},"JSON")}$(".yy-myGroupOrder").live("change",function(){var g=$(this),f=g.closest("tr");sid=Math.abs(g.val())?Math.abs(g.val()):1;console.log(sid);YY.util.ajaxApi(url("/group/ajax/grouporder"),function(i,h){var j=$("#groupTabList tr").length;if(sid!=f.index()){if(sid>j){f.remove()}else{console.log(f);f.insertAfter($("#groupTabList tr").eq(sid))}}},"GET","json",{gid:g.attr("data"),sid:sid})});$(".groupOrder").change(function(){var f=$(this);YY.util.ajaxApi(url("/group/ajax/savegroupset"),function(h,g){window.location.href=yyBaseurl+"/group/lists/mylist"},"GET","json",{sid:f.val()})});$("#groupMemberList").live("click",function(g){var f=g.target;var h=$(f).attr("data");if($(f).hasClass("allow")){e(h,1,$(f))}if($(f).hasClass("refuse")){e(h,2,$(f))}if($(f).hasClass("setAdmin")){e(h,3,$(f))}if($(f).hasClass("delMember")){$(f).next("div.yy-groupDel").removeClass("hidden")}if($(f).hasClass("cancelAdmin")){e(h,5,$(f))}});$(".yy-groupDelete-confirm").live("click",function(){e($(this).attr("data"),4,$(this))});$(".yy-groupDelete-cancel").live("click",function(){$(this).closest("div").addClass("hidden")});function e(i,f,h){var g=$("#gid").val();$.get(yyBaseurl+"/group/manage/opmemberstatus/gid/"+g+"/member_id/"+i+"/flag/"+f,function(j){switch(j.rs){case 1:$(h).parents("tr").hide();break;case 2:$(h).parents("tr").hide();break;case 3:$(h).val("撤销管理员").attr("class","cancelAdmin button blueGz w90").attr("name","cancelAdmin");break;case 4:$(h).parents("tr").hide();break;case 5:$(h).val("设置成管理员").attr("class","setAdmin button blueGz w90").attr("name","setAdmin");break;case"error":break}},"JSON")}$("#delGroup").live("click",function(g){var f=g.target;if($(f).attr("name")=="delGroup"){$(this).find("aside").show()}if($(f).attr("name")=="subDel"){window.location.href=yyBaseurl+"/group/manage/del/gid/"+$("input[name='gid']").val()}if($(f).attr("name")=="reset"){$(this).find("aside").hide()}});$(".yy-bgPic").change(function(){var g=$(this).val();var f=g.substring(g.lastIndexOf(".")).toLowerCase();if(!checkFileExt(f)){alert("您上传的文件类型不合要求，请重新选择！");return}$(".imagesrc").val(g)});$("input.groupLogo").change(function(){onUploadImgChange(this,"groupImg")});var a=$("#groupImg").attr("src")?false:true;jQuery.validator.addMethod("checkLength",function(k,j,l){var m=0,f=k.length,g=-1;for(var h=0;h<f;h++){g=k.charCodeAt(h);if(g>=0&&g<=128){m+=1}else{m+=2}}if(m>l){return false}return true},"长度超过100字");$("#myform").validate({validClass:"icoRightt",errorClass:"icoWrongtk",errorBg:"yellowBg",hasIco:false,rules:{groupName:{required:true,remote:{url:yyBaseurl+"/group/create/checkgroupname/",type:"GET",dataType:"json",data:{group_name:function(){return encodeURIComponent($("#groupName").val())},gid:function(){return $("input[name='gid']").val()},rid:function(){return Math.random()}}}},groupInfo:{required:true,checkLength:"200"},groupLogo:{required:a}},messages:{groupName:{required:"请输入群组名",remote:"此群组名已存在"},groupLogo:{required:"请上传群组封面"},groupInfo:{required:"请输入群组简介"}}});var b={},d;$(".ui-widget input[name^='name']").autocomplete({minLength:1,source:function(h,f){var g=h.term;if(g in b){f(b[g]);return}d=$.getJSON(yyBaseurl+"/group/manage/ajaxsearch/gid/"+$(".ui-widget input[name='sub']").attr("data"),h,function(j,i,k){b[g]=j;if(k===d){f(j)}})}});$.yy.defaultText({inviteName:"请输入姓名或者邮箱"});$("#inviteName").yyautocomplete({appendTo:"#invite_div",ajaxUrl:url("/common/search/ccnotice"),selAppendTo:"#invite_list",select:function(f,g){}});$("input[name^='name']:last").live("focus",function(g){var f=$(this).parent();f.clone().insertAfter(f)})});