var updateAjax=function(b){var e={boxId:"topicBox",inputId:"topicInput",titleId:"topicTitle"};var b=$.extend(e,b),d=$("#"+b.boxId),a=$("#"+b.inputId),c=$("#"+b.titleId);d.children("strong,a").bind("click",function(){c.addClass("hidden");a.removeClass("hidden").focus()});a.bind("blur",function(){var g=$.trim(a.val()),f=c.html(),h=a.attr("tid");if(g!=""){$.ajax({url:yyBaseurl+"/topic/topic/subupdate",type:"POST",data:"title="+encodeURI(g)+"&id="+h,dataType:"json",success:function(i){if(i.rs){c.text(g);a.addClass("hidden");c.removeClass("hidden")}else{alert(i.error);a.focus()}}})}else{a.addClass("hidden");c.removeClass("hidden")}})};$(document).ready(function(){$("select[name='firstext']").change(function(){$("form[name='myform']").submit()});$("#moreButton").live("click",function(){var $me=$(this);$me.html("加载中...");var contioner=$("#"+$me.attr("resource-id"));var len=contioner.find("a[class='htLink']").length;$.get($me.attr("data"),{offset:len,ajaxpend:1},function(data){if(data.indexOf("nodata")>=0){$me.html("没有更多内容了");$("#moreButton").die("click")}else{var json=eval("("+data+")");contioner.children("ul").append(json.data);$me.html("查看更多>>")}},"html")});$.yy.follow({setsId:"#documentTab",confirm:{txt:"关注",css:"confirm"},cancel:{txt:"取消关注",css:"cancel"}});$(".yy-topicListLi").live({mouseover:function(){$(this).find(".yy-topicDel").removeClass("hidden")},mouseout:function(){$(this).find(".yy-topicDel").addClass("hidden")}});$(".yy-topicDel").live("click",function(){var Li=$(this).closest("li"),url=$(this).attr("data");YY.util.ajaxApi(url,function(data,status){if(data.rs){Li.remove();$.yy.rscallback("操作已完成！")}},"GET","JSON")});$(".yy-topicAllNum").live({mouseenter:function(){var $me=$(this);$me.children("aside").removeClass("hidden")},mouseleave:function(){var $me=$(this);$me.children("aside").addClass("hidden")}});$(".addNewSubject").fancybox({width:340,scrolling:"no",centerOnScroll:true,showCloseButton:false});$(".yy-topicDel").click(function(){$(this).next().removeClass("hidden")});$(".yy-delete-cancel").click(function(){$(this).closest(".yy-delete").addClass("hidden")});$(".feed-delete-conv-confirm").click(function(){var self=$(this),url=$(this).closest("td").find(".yy-topicDel").attr("data");YY.util.ajaxApi(url,function(data,status){if(data.rs){self.closest("tr").remove();$.yy.rscallback("操作已完成！")}},"GET","JSON")});$(".yy-topicEdit").live("click",function(){var editTr=$(this).closest("tr"),order=editTr.find(".order"),title=editTr.find(".title");if(!editTr.hasClass("editTr")){editTr.addClass("editTr");order.html('<input type="text" class="edit1" value="'+order.text()+'" name="order" />');title.html('<input type="text" class="edit2" value="'+title.text()+'" name="order" />')}});$("body").click(function(e){var self=e.target,obj=$(self).closest("tr.editTr");if($(".subjectTab tr.editTr").length>0&&obj.length<=0){var editTr=$(".subjectTab tr.editTr"),sid=$("tr.editTr").attr("data"),order=$("tr.editTr").find(".edit1").val(),title=$("tr.editTr").find(".edit2").val();YY.util.ajaxApi(url("/topic/topic/editsubject"),function(data,status){if(data.rs){editTr.find(".order").html(data.data.order);editTr.find(".title").html(data.data.title);$.yy.rscallback(data.error)}else{editTr.find(".order").html(order);editTr.find(".title").html(title)}editTr.removeClass("editTr")},"POST","json",{sid:sid,order:order,title:encodeURI(title)})}});YY.util.ajaxApi(url("/api/feed/topic/topicid/"+$("#topic_id").val()),function(data,status){$("#yy_conversation_content").html(data)});$(".yy-recommendToSubject").mouseenter(function(){$(this).find("aside").removeClass("hidden")});$("body").live("click",function(e){$(".yy-recommendSubject").addClass("hidden")});$(".yy-recommendSubject a").click(function(){var self=$(this),url=yyBaseurl+"/topic/topic/ajaxpushtopic/";$(".yy-recommendSubject").find(".yy-recommendConfirm").addClass("hidden");$(this).find("span:last").removeClass("hidden");YY.util.ajaxApi(url,function(data,status){if(data.rs){$.yy.rscallback("推送成功！")}else{$.yy.rscallback("推送失败！",1)}},"GET","JSON",{tid:self.parent().attr("data"),sid:self.attr("data")})});$(".topicLi").click(function(){var self=$(this);$(".topicLi").removeClass("cur");self.addClass("cur");YY.util.ajaxApi(self.attr("data"),function(data,status){if(data){$("#footer_morefeed").removeClass("hidden").find("#moreFeedByAjax").html("查看更多&gt;&gt;");$("#yy_conversation_content").html(data)}})});$("#moreFeedByAjax").live("click",function(){var self=$(this),url=$(".topicLi").filter(".cur").attr("data"),type=$(".topicLi").filter(".cur").attr("type");if(type=="files"){YY.util.ajaxApi(url,function(data,status){if(data!=""){$(data).insertBefore(".filePageTr")}else{self.html("没有更多内容了")}},"GET","html",{page:$(".filePageTr").attr("data")})}else{console.log($(".gzContRight:last").attr("feed-id"));YY.util.ajaxApi(url,function(data,status){if(data!=""){$(data).appendTo("#yy_conversation_content")}else{self.html("没有更多内容了")}},"GET","html",{fid:$(".yy-feed-section > .gzContRight:last").attr("feed-id")})}});$(".yyChangeTopic").live("click",function(){var self=$(this);YY.util.ajaxApi(url("/topic/topic/ajaxhot"),function(data,status){if(data!=""){$(".yyChangeTopicUl").html(data);self.attr("data",$("#changeTopicPage").attr("data"))}},"GET","html",{topicid:$("#topic_id").val(),page:self.attr("data")})});$("#yy_theme_display").find(".yy_more").live("click",function(){var $relave=$("#yy_theme_display"),$this=$(this);if($relave.find("#yy_area").height()!=25){$relave.find("#yy_area").height(25);$this.find("span").removeClass("ico_jt2");$this.find("span").addClass("ico_jt")}else{$this.find("span").removeClass("ico_jt");$this.find("span").addClass("ico_jt2");$relave.find("#yy_area").height($relave.find("#yy_topic_content").height())}});$(".yy-file-operate-list").live({mouseenter:function(){var $me=$(this);$me.children().addClass("relative").children("aside").removeClass("hidden")},mouseleave:function(){var $me=$(this);$me.children().removeClass("relative").children("aside").addClass("hidden")}});$(".yy-delete-link").live("click",function(){$(this).closest("div").find(".yy-delete:first").trigger("click")});var tv1=10,tv2=10;$(".yy-delete").live("click",function(){var $me=$(this);clearTimeout(tv1);tv2=setTimeout(function(){$me.children(".delTk").length?$me.children(".delTk").removeClass("hidden"):$me.append('<aside class="delTk">确定要删除该文档？<br/><a href="#yy-delete-confirm" class="yy-delete-confirm">删除</a> <a href="#yy-delete-cancel" class="yy-delete-cancel">不删除</a><span class="sj xsj"></span></aside>');$(".yy-file-operate-list").trigger("mouseleave");$me.closest("td").removeClass("yy-file-operate-list")},300)});$(".feed-delete-confirm").live("click",function(){var obj=$(this),url=$(this).closest("div").parent().find(".yy-delete-link").attr("for"),old=location.href.split("?")[0],fid=$(this).closest("div").parent().find(".yy-delete-link").attr("fid");$(this).closest("td").addClass("yy-file-operate-list");data="fid="+fid+"act="+old;$.ajax({type:"POST",url:yyBaseurl+"/file/act/delattach",data:data,success:function(html){if(html==1){$.yy.rscallback("删除成功");obj.closest("tr").remove()}else{if(html==0){$.yy.rscallback("删除失败")}}}})});$(".yy-delete-cancel").live("click",function(){var $me=$(this);$me.closest(".delTk").addClass("hidden");$(this).closest("td").addClass("yy-file-operate-list");return false});updateAjax()});