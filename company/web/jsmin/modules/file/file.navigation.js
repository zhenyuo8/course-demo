var fileNavigation=function(){var k=this,l=YY.util.url("/file/file/ajaxindex/flag/"),t=YY.util.url("/file/box/ajaxshare/type/"),I=l+DOC_CUR_FLAG,v="#doc-top-navigation a",u="meCur",y=["个人文档","全部文档","群组文档","企业文档"],g=".doc-path",b="#doc-path-containter",c='<span class="fl sep doc-path-sep">&gt;</span><span class="fl doc-path-append">%title</span>',m=".doc-leftnav",o="#doc-leftnav-containter",C="#subnav-containter-",d=".sub-leftnav-containter",i="zskMenuCur",h=".leftnav-title",B="#doc-right-option-containter",f="#right-option-upload",A="#right-option-folder",a="#right-option-newfolder",F="#right-option-quit",E="#right-option-return",s;function x(L){var P=L,O=P.length,K,J=0;$(g,b).each(function(Q){J=Q;K=$(".doc-path-sep:eq("+(Q-1)+")",b);if(Q<O){$(this).html(P[Q]);$(this).show();Q>0?K.show():""}else{$(this).hide();Q>0?K.hide():""}});$(".doc-path-append",b).each(function(Q){$(this).prev("span.doc-path-sep").remove();$(this).remove()});var N="";for(var M=J+1;M<O;M++){N=c.replace("%title",P[M]);$(N).appendTo(b)}}function r(J){J.closest("ul").find("li").removeClass(u);J.closest("li").addClass(u);x(["全部文档",J.html()])}function w(){$(v).bind("click",function(){var K=$(this),J=l+K.attr("flag");$(d,o).addClass("hidden");s.reload(J);r(K);z("topnav",0);return false})}function e(){r($(v+'[flag="'+DOC_CUR_FLAG+'"]'));w()}function j(J){if($.isArray(J)){J=J.join(",")}$(J,B).removeClass("hidden")}function z(J,K,M){$(B+" a").addClass("hidden");if(J!="topnav"){$(v).closest("li").removeClass(u)}var L={self:1,group:K,corp:2,folder:K,topnav:1};$(f,B).attr("data",K);$(A,B).attr("data",L[J]);switch(J){case"self":j([f,A]);break;case"topnav":$("a",o).removeClass(i);case"group":j([f]);break;case"corp":if(K<=0){$(A,B).trigger("click");break}YY.util.ajaxApi("/file/box/rightbutton/",function(P,O){if(O==="success"&&P){j(P.data)}},"POST","json",{boxid:K,type:L[J]});break;case"folder":$(a).attr("data",K);$(F).attr("data",K);$(E).attr("data",M.pid);var N=[a];if(M.pid){N.push(E)}else{N.push(F)}j(N);break;default:}}function p(){$(d+" a",o).live("click",function(){var K=$(this);remoteUrl=K.attr("url"),$subleftnavContainter=K.closest(d);flag=$subleftnavContainter.attr("id").split("-")[2],$mainLeftnav=$(m+'[flag="'+flag+'"]',o),title=K.attr("title"),path=[$(h,$mainLeftnav).html(),title],floor=K.attr("floor"),item_id=K.attr("item_id"),reload=true;var L=K.attr("pmvalid")?K.attr("pmvalid"):false;var J=L?(K.attr("validresult")=="valid"?true:false):true;if(L&&typeof(K.attr("validresult"))=="undefined"){YY.util.ajax({url:K.attr("pmvalid"),success:function(N,M){if(!N.rs){K.attr("validresultmsg",N.error);K.attr("validresult","invalid");reload=false;J=false}else{K.attr("validresult","valid");J=true}},async:false,type:"POST",dataType:"json"})}if(!reload||!J){$.yy.rscallback(K.attr("validresultmsg"))}s.reload(remoteUrl);$(d+" a",o).removeClass(i);K.addClass(i);if(floor!="0"){path.splice(1,1);$('a[floor_id="'+K.attr("floor_id")+'"]',$subleftnavContainter).each(function(M){$item=$(this);if(parseInt($item.attr("floor"))<parseInt(floor)){path.push($item.attr("title"))}});path.push(title)}x(path);z(flag,item_id);return false})}function H(K,N,J,M){var L=$("dl",C+K),O=L.find('a[item_id="'+M+'"]');O.attr("fullname",J);O.html('<span class="zsIcon1 fl"></span><span>'+N+"</span>")}function G(O,J,Q,R,K,N){if(N>0){var M=$('a[item_id="'+N+'"]',C+O).next("ul"),P='<li><a title="'+Q+'" href="javascript:;" floor="1" floor_id="'+N+'" item_id="'+R+'" url="'+K+'"><span class="zsIcon1 fl"></span><span>'+J+"</span></a></li>";$(P).appendTo(M);return}var L=$("dl",C+O),P='<dd><a title="'+Q+'" floor="0" item_id="'+R+'" url="'+K+'" href="javascript:;"><span class="zsIcon1 fl"></span><span>'+J+"</span></a><ul></ul></dd>";$(P).appendTo(L)}function D(){$(m,o).bind("click",function(){var K=$(this),J=K.attr("flag"),M=C+J,L=$(M+" a:first");$(d,o).addClass("hidden");$(M).removeClass("hidden");if(L.length>0){$(M+" a:first").trigger("click")}else{x(["企业文档"]);s.reload("/file/box/ajaxfile/boxid/0/type/2");if(K.attr("showfolder")>0){z("corp",0)}else{$(B+" a").addClass("hidden")}}})}function n(){$(m,o).css("cursor","pointer");p();D()}function q(){$(A).bind("click",function(R,L,O){var Q=$(this),P=Q.attr("data"),K=YY.util.url("/file/box/ajaxindex/type/")+Q.attr("data"),M=["个人文档","个人文档","企业文档"],N=[M[P]];if(typeof(L)!="undefined"){K+="/pid/"+L;N.push(O)}else{L=0}x(N);s.reload(K);z("folder",P,{pid:L})});$(E).bind("click",function(){$(A).trigger("click")});$(F).bind("click",function(){var K=$("."+i,o);if(K.length>0){K.trigger("click")}else{var L=$(this).attr("data"),M=["","self","corp"];$(m+'[flag="'+M[L]+'"]',o).trigger("click")}});$(a).bind("click",function(R,Q){var P=$(this),O=P.attr("data");if(O=="1"){var M=yyBaseurl+"/file/box/addbox/",N=["self","self","corp"];if(typeof(Q)!="undefined"){M+="boxid/"+Q}$.fancybox({modal:true,width:500,height:300,transitionIn:"elastic",transitionOut:"elastic",speedIn:200,speedOut:200,href:M,onComplete:function(){$("#addboxForm").validate({validClass:"icoRightsss",errorClass:"icoWrong",errorBg:"yellowBg",hasIco:false,rules:{boxname:"required"},messages:{boxname:{required:"文件夹名称必须填写"}}});$("#addboxForm").bind("submit",function(){var S=$(this),T=S.attr("action");YY.util.ajaxApi(T,function(W,U){if(U==="success"&&W){var V=W.data;if(typeof(Q)!="undefined"){H(N[O],V.boxname,V.fullboxname,Q,0)}else{G(N[O],V.boxname,V.fullboxname,V.boxid,V.url,0)}s.reload();$.yy.rscallback(V.msg)}else{$.yy.rscallback(W.error,1)}},"POST","json",{boxid:$("#boxid").val(),boxname:$("#boxname").val()});$.fancybox.close();return false})}})}else{var M=yyBaseurl+"/file/box/groupaddbox",N=["self","self","corp"],L=0,K=$(E);if(!K.hasClass("hidden")){L=K.attr("data")}if(typeof(Q)!="undefined"){M+="/boxid/"+Q}M+="/pid/"+L;YY.util.ajaxApi(M,function(S){$("#yyDataTable").hide();$("#yyActLine").hide();$(S).insertAfter(s.getTableSelector());new docBoxAdd();$("#addGroupboxForm").bind("submit",function(){var U=$(this),V=U.attr("action"),X={boxid:$("#boxid").val(),boxname:$("#boxname").val(),pid:$("#pid").val()},T=$('input[name="upset"]'),W=$('input[name="viewset"]');X.notice_div_value=[];X.notice_div_n_value=[];$('input[name="notice_div_value[]"]').each(function(Y){X.notice_div_value.push($(this).val())});$('input[name="notice_div_n_value[]"]').each(function(Y){X.notice_div_n_value.push($(this).val())});X.upset=(T.attr("checked"))?1:0;X.viewset=(W.attr("checked"))?1:0;YY.util.ajaxApi(V,function(Z){if(Z.rs){var Y=Z.data;if(typeof(Q)!="undefined"){H(Y.flag,Y.boxname,Y.fullboxname,Q,L)}else{G(Y.flag,Y.boxname,Y.fullboxname,Y.boxid,Y.url,L)}s.reload();$.yy.rscallback(Y.msg)}else{$.yy.rscallback(Z.error,1)}},"POST","json",X);return false})},"POST","html")}});function J(){var O=$("#videoUrl").val();if(O){var K=$.trim(O).match(/http:\/\/.+/);var N=$("#videoPic");if(K==null){$("#videoSta").val(0);$("#errorinfo").show();$("#errorinfo").text("不支持的视频地址")}else{if(K&&N.html()==""){var L=yyBaseurl+"/file/act/ajaxvideo";var M={posturl:O};YY.util.ajaxApi(L,function(P){if(P){data=P;N.show();N.html('<a href="javascript:;" class="videoClosed" onclick="closeVideo();">重新上传</a><img src="'+data.videoPic+'" alt="'+data.title+'" />');$("#errorinfo").html("");$("#errorinfo").hide();$("#videoInput").hide();$("#videoSta").val(1)}else{$("#videoSta").val(0);$("#errorinfo").show();$("#errorinfo").text("不支持的视频地址")}},"POST","json",M)}}}}$(f).live("click",function(){var Q=$(this),N=yyBaseurl+"/group/index/uploaddoc/gid/"+Q.attr("data"),M={group:0,self:1,corp:2},O=$("."+i,o),K="group",P=0,L=0;if(O.length>0){K=O.closest(d).attr("id").split("-")[2];L=O.attr("item_id");if(L<0&&K=="self"){L=-1}}var P=M[K];func=function(){YY.util.initUpload(function(){var S=$("#fileFromObj").val();var R=new InitUpload({button_placeholder_id:"groupFileUploadBtn",upload_url:YY.util.url("/file/act/swfupload/fileFrom/")+S+"/gid/"+$("#uploadGroupID").val()})});$("#videoAddress").bind("click",function(){var R=$("#uploadVideo").is(":hidden");if(R){$("#uploadVideo").show();$(this).html("关闭媒体链接地址")}else{$("#uploadVideo").hide();$(this).html("打开媒体链接地址")}});$("#videoUrl").bind("keyup",function(S){var R=S.keyCode;if(R==86){J()}}).bind("blur",J).bind("keydown",J)};if(P>0){N=yyBaseurl+"/file/box/uploaddoc/boxid/"+L+"/type/"+P;func=function(){YY.util.initUpload(function(){var S=$("#fileFromObj").val();var R=new InitUpload({button_placeholder_id:"boxFileUploadBtn",upload_url:YY.util.url("/file/act/swfupload/fileFrom/")+S+"/gid/"+$("#uploadGroupID").val()+"/boxid/"+$("#boxid").val()})});$("#shareuser").yyautocomplete({appendTo:"#share_div",ajaxUrl:YY.util.url("/common/search/ccnotice"),selAppendTo:"#share_list",select:function(R,S){}});$("#videoAddress").bind("click",function(){var R=$("#uploadVideo").is(":hidden");if(R){$("#uploadVideo").show();$(this).html("关闭媒体链接地址")}else{$("#uploadVideo").hide();$(this).html("打开媒体链接地址")}});$("#videoUrl").bind("keyup",function(S){var R=S.keyCode;if(R==86){J()}}).bind("blur",J).bind("keydown",J);$("a.groupUploadColose").one("click",function(){$.fancybox.close()})}}$.fancybox({modal:true,width:500,height:160,transitionIn:"elastic",transitionOut:"elastic",speedIn:200,speedOut:200,href:N,onComplete:func,onClosed:function(){s.reload()}});return false})}k.init=function(){e();n();q();var J=I;if(DOC_RT_FLAG!=""){J="";s=new fileTable(J);$('a[item_id="'+DOC_RT_ITEM+'"]',C+DOC_RT_FLAG).trigger("click");$(C+DOC_RT_FLAG).removeClass("hidden")}else{s=new fileTable(J)}};k.reload=function(J,K,N,M){if(arguments.length>3){for(var L in M){s.setParam(L,M[L])}}s.reload(J,K,N)};k.leftSubNavSyncSort=function(K,O,J,M){var N=M>0?"li":"dd";var L=$('a[item_id="'+O+'"]',C+K).closest(N),P;if(J=="up"){P=L.prev(N);P.insertAfter(L)}else{P=L.next(N);P.insertBefore(L)}}};function closeVideo(){$("#videoSta").val(0);$("#videoPic").html("");$("#videoPic").hide();$("#videoInput").show();$("#videoUrl").val("");$("#errorinfo").html("")};