(function(b,a){a.loadScript(["/plugin/jquery.Jcrop.js"],{fn:function(){b(function(){var g=function(){var B=this,C=[150,150],x=[48,48],u=[30,30],z=b("#bigwidth"),v=b("#bigheight"),y=b("#avatarMiddle"),A=b("#avatarSmall"),w=b("#avatarTiny");B.goss=function(D){var E=v.val(),F=z.val();move_flag=F*t<48||E*t<48?false:true;b("#avatarOrigin").Jcrop({boxWidth:400,boxHeight:400,minSize:x,allowSelect:false,allowMove:move_flag,onChange:B.showPreview,onSelect:B.showPreview,onSelect:B.updateCoords,setSelect:D,aspectRatio:1},function(){B.api=this})};B.updateCoords=function(D){b("#x").val(D.x/t);b("#y").val(D.y/t);b("#w").val(D.w/t);b("#h").val(D.h/t)};B.showPreview=function(I){var L=C[0]/I.w,K=C[1]/I.h,F=x[0]/I.w,E=x[1]/I.h,J=u[0]/I.w,H=u[1]/I.h,D=z.val()*t,G=v.val()*t;y.css({width:Math.round(L*D)+"px",height:Math.round(K*G)+"px",marginLeft:"-"+Math.round(L*I.x)+"px",marginTop:"-"+Math.round(K*I.y)+"px"});A.css({width:Math.round(F*D)+"px",height:Math.round(E*G)+"px",marginLeft:"-"+Math.round(F*I.x)+"px",marginTop:"-"+Math.round(E*I.y)+"px"});w.css({width:Math.round(J*D)+"px",height:Math.round(H*G)+"px",marginLeft:"-"+Math.round(J*I.x)+"px",marginTop:"-"+Math.round(H*I.y)+"px"})}};var l=b("#userInfo"),s=l.attr("mid"),h=l.attr("uid");var k=b("#avatarUploadBlock"),f=b(".yy-upload-process-container",k),o=b("#avatarOrigin"),n=b("#avatarMiddle"),i=b("#avatarSmall"),c=b("#avatarTiny"),t=1,p=new g();var e=b(".yy-button-line",k),m=b(".yy-cancel-avatar-upload",k);m.on({click:function(){window.location.href=window.location.href}});b("#sub").live("click",function(){var u=a.url("/common/avatar/sub");r(u,function(v){b.yy.rscallback("头像保存成功！");window.location.href=window.location.href})});b("#subLogo").live("click",function(){var u=a.url("/setting/base/subthumb");r(u,function(v){b.yy.rscallback("头像保存成功！");window.location.href=window.location.href})});b("#sublead").live("click",function(){var u=a.url("/common/avatar/sub");r(u,function(v){b.yy.rscallback("头像保存成功！")})});b("#subLogolead").live("click",function(){var u=a.url("/setting/base/subthumb");r(u,function(v){b.yy.rscallback("头像保存成功！")})});a.initUpload(function(){new InitUpload({file_types:"*.jpg;*.jpeg;*.png;",post_params:{sessid:sessid,mid:s,uid:h},file_size_limit:"5 MB",button_width:"111",button_height:"28",button_text_left_padding:"55",button_text:"",button_text_style:"",button_placeholder_id:"avatarUploadButton",upload_url:a.url("/common/avatar/upload"),upload_start_handler:function(v){try{f.html('上传中，已上传 <span class="percent">0%</span>')}catch(u){}return true},upload_progress_handler:function(v,y,x){try{var w=Math.ceil((y/x)*100);var z="";if(w===100){z="，正在处理，请稍候.."}f.find(".percent").html(w+"%"+z)}catch(u){this.debug(u)}},upload_success_handler:function(x,v){try{v=b.parseJSON(v);if(typeof v.rs!=="undefined"&&v.rs){e.css({visibility:"visible"});if(typeof p!=="undefined"&&typeof p.api!=="undefined"){p.api.destroy()}var u=v.data+"?"+Math.random();o.removeAttr("style").attr("src",u);n.attr("src",u);i.attr("src",u);c.attr("src",u);o.on("load",function(){b("#bigwidth").val(o.width());b("#bigheight").val(o.height());var z="avatar"+v.data.split("avatar")[1];b("#filepath").val(z);f.html("请选择合适区域");d();var y=q();p.goss(y);b(this).off("load")})}}catch(w){f.html("很抱歉，您的图片没有上传成功。")}},upload_error_handler:function(){f.html("很抱歉，您的图片没有上传成功。")}})});function d(){var w=288,u=288,x=o.width(),v=o.height();t=1;o.css({visibility:"visible"});if(x>w||v>u){if(x<v){o.css({height:u});t=u/v}else{o.css({width:w});t=w/x}}}function q(){var w=o.is(":hidden");w&&o.show();var G=288,H=288,v=o.width(),z=o.height(),C=v<z,A=C?v:z,B=A-10,F,u,E,D;if(C){F=5;E=(z-B)/2}else{F=(v-B)/2;E=5}u=F+B;D=E+B;w&&o.hide();return[F,E,u,D]}function r(u,v){if(!j()){return false}var w={sub:1,filepath:b("#filepath").val(),mid:b("#mid").val(),uid:b("#uid").val(),bigwidth:b("#bigwidth").val(),bigheight:b("#bigheight").val(),x:b("#x").val(),y:b("#y").val(),w:b("#w").val(),h:b("#h").val()};a.ajaxApi(u,function(x){if(x&&typeof x.rs!=="undefined"&&x.rs){typeof v==="function"&&v(x.data)}},"POST","json",w)}function j(){if(b("#x").val()==""){alert("请先上传图片然后选择裁切头像最后进行保存！");return false}return true}})}})}(jQuery,YY.util));