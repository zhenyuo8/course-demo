(function(c,a,b){a=a||{};var d=a.calendar={init:function(){var e=this;e.initTaskColor();e.initCalendar();e.initEventHandler();setTimeout(function(){e.getTaskHtml()},100)},getId:function(){var e=0;return function(){return e++}},initTaskColor:function(){var e=this;e.taskcolor=e.bg_color[0];e.schecolor=e.bg_color[1]},setTaskColor:function(e){if(typeof e==="object"&&!!e.length){var f=this;c.each(e,function(h,g){f[h]=g})}},initCalendar:function(){var e=this;e.initDate();e.initRequestData();e.showType=e.viewType[0];e.showMonth();e.initTask();e.getInitData()},mid:0,today:{year:0,month:0,day:0,theweek:0,timestamp:0},viewType:["month","week","day"],month:[0,0],fixed_date:[0,0],mini_date:[0,0],week:[0,0],week_name:["周日","周一","周二","周三","周四","周五","周六"],day:[0,0],time:[],hour_height:42,onehalfhour:1800,onehour:3600,oneday:86400,oneweek:604800,timeblock:3628800,bg_color:["blueBg","yeBg","orangeBg","greenBg","redBg"],task:{},week_count:5,line_num:4,line_height:20,top_start:18,arrow_width:7,requestData:{start_time:"",end_time:"",month:"",mid:""},requestRange:[0,0],responseData:{},flagMousedown:0,flagSelectDay:false,flagSelectTime:false,showType:"month",$window:c(window),$document:c(document),$body:c("body"),$calendar:c("#yyCalendar",this.$body),$main:c("#yyCalendarMain",this.$calendar),$mainGridOuter:c("#yyCalendarMainGrid",this.$main),$mainEditOuter:c("#yyCalendarMainEdit",this.$main),$mainSearchOuter:c("#yyCalendarMainSearch",this.$main),$timeColWrapper:null,monthHtml:"",editPanelHtml:"",setMid:function(e){e=parseInt(e||0);var f=this;f.mid=e?e:0},openCalendarView:function(f){var g=this,e=g.viewType;if(c.inArray(f,e)!==-1){g.showType=f;g.showView()}g.getData();return true},showView:function(){var f=this,g=f.showType,e=f.viewType;g===e[0]?f.showMonth():(g===e[1]?f.showWeek():f.showDay())},timeSelectValue:{endTimePos:0,clientY:0,top:0,numState:0,div:null,boxState:false,weekStartTime:0,startTime:"",endTime:"",weekDayNum:""},getTime:function(h){var f=Math.floor(h/21);var e=Math.floor(f/2);var g=f%2==0?"00":"30";return e+":"+g},getMillTime:function(e){function f(g){var h=g.split(":");return h[0]*60*60+h[1]*60}if(this.showType=="week"){return this.week[0]+this.timeSelectValue.weekDayNum*24*60*60+f(e)}else{return this.day[0]+this.timeSelectValue.weekDayNum*24*60*60+f(e)}},timeSelectStart:function(k,m){var o=this;function i(){if(o.timeSelectValue.div!=null){o.timeSelectValue.div.remove();var e=c("#timeBox");e.hide()}}var g=function(e){return e.substring(e.length-1,e.length)};i();m.flagMousedown=k.which;m.flagSelectTime=true;m.$timeColWrapper=c(k.target);var l=c(k.target);var j=this.timeSelectValue.weekDayNum=g(l.attr("id"));l=c("#yyOver"+j);if(c("div[id=chooseDiv"+j+"]").length<1){l.append("<div id ='chooseDiv"+j+"'class='borderFff alignLeft'></div>")}var f=l.find("#chooseDiv"+j);var h=function(p){var e=k.clientY+c("#yyCalendarWeekBlock").scrollTop()-c("#yyCalendarWeekBlock").offset().top+c(window).scrollTop();return e-e%p+1};var n=this.timeSelectValue.top=h(42);f.css({width:"99.5%",height:"35px",background:"#BCD3FC",left:"0px",top:n+"px","z-index":1000,"-moz-opacity":0.5,opacity:0.5,"text-align":"left","font-size":"14px",color:"#1D1D1D",position:"relative"});this.timeSelectValue.div=f;f.html((this.timeSelectValue.startTime=this.getTime(n))+"-"+(this.timeSelectValue.endTime=this.getTime(n+57)));this.timeSelectValue.clientY=k.clientY;this.timeSelectValue.endTimePos=(this.timeSelectValue.endTime==="24:00")?k.clientY:0;f.click(function(){c(this).remove();var e=c("#timeBox");e.hide();o.timeSelectValue.div=null})},timeSelectChange:function(j,h){if(this.timeSelectValue.endTime==="24:00"&&this.timeSelectValue.endTimePos<=j.clientY){return false}var m=this.timeSelectValue.div;var l=this.timeSelectValue.numState;var i=this.timeSelectValue.top;var f=j.clientY+c("#yyCalendarWeekBlock").scrollTop()-c("#yyCalendarWeekBlock").offset().top-this.timeSelectValue.top+c(window).scrollTop();var g=i;function k(e,o,n){l=Math.floor(e/n);if(l<=0){g=(o-Math.abs(l)*n);if(g<0){return}m.css("top",g+"px");e=Math.abs(l)*n+n-7}else{e=l*n+n-7}return e}f=k(f,i,42);m.height(f);m.html((this.timeSelectValue.startTime=this.getTime(g))+"-"+(this.timeSelectValue.endTime=this.getTime(g+f+17)));this.timeSelectValue.endTimePos=(this.timeSelectValue.endTime==="24:00"&&j.clientY>this.timeSelectValue.endTimePos)?j.clientY:this.timeSelectValue.endTimePos;this.timeSelectValue.top=i;this.timeSelectValue.numState=l},timeSelectEnd:function(i,g){var g=this,k=a.calendarBiz,h=g.timeSelectValue.boxState,j=g.timeSelectValue.div;g.flagMousedown=0;g.flagSelectTime=false;g.timeSelectValue.numStat=0;g.noSelect(false);if(!h){g.timeSelectValue.boxState=true}if(g.mid!==0){k.showNoPermission(i)}else{if(g.getMillTime(g.timeSelectValue.endTime)*1000<=new Date().getTime()){k.showErrorRange(i)}else{var f=j.width();k.openTaskCreateBox({x:j.offset().left+f/2,y:j.offset().top+3,start_time:g.getMillTime(g.timeSelectValue.startTime),end_time:g.getMillTime(g.timeSelectValue.endTime)})}}},dayDateDeal:function(C){function v(j,i){return(parseInt(j.value[7])<=parseInt(i.value[6])||parseInt(j.value[6])>=parseInt(i.value[7]))?false:true}function n(i,j){return parseInt(i.value[6])<=parseInt(j.value[6])&&parseInt(i.value[7])>parseInt(j.value[6])}var I=[];for(var e=0;0<1;e++){var f=[];for(var K=0,J=C.length;K<J;K++){if(C[K].isCol>-1){continue}var L=true;for(var P=0,N=f.length;P<N;P++){if(v(f[P],C[K])){L=false;break}}if(L){f.push(C[K]);C[K].isCol++;C[K].col=e}}if(f.length==0){break}I.push(f)}for(var K=0,J=I.length;K<J;K++){var g=I[K];if(K==I.length-1){for(var t=0,E=g.length;t<E;t++){g[t].deep=I.length}continue}for(var k=0,p=g.length;k<p;k++){var H=g[k];for(var R=I.length-1;R>=0;R--){if(k>R){continue}var l=I[R];for(var B=0,r=l.length;B<r;B++){var O=l[B];var M=n(H,O);if(M&&H.deep<R+1){H.deep=R+1}if(k==I.length-1){continue}if(v(H,O)&&H.next>R+1){H.next=R+1}}}}}for(var K=I.length-1;K>0;K--){var F=I[K];var D=I[K-1];for(var R=F.length-1;R>=0;R--){var h=F[R];for(var G=D.length-1;G>=0;G--){var s=D[G];if(v(h,s)&&h.deep>s.deep){s.deep=h.deep}}}}for(var K=0,J=I.length;K<J;K++){var y=I[K];for(var R=0,Q=y.length;R<Q;R++){var A=y[R];A.init()}}return C},dealDisplayData:function(f){for(var e=0,h=7;e<h;e++){var g=f[e];f[e]=this.dayDateDeal(g)}return f},filterTime:function(k,f,l){var m=[];for(var h=0,g=l.length;h<g;h++){var e=l[h];if(!e[14]){continue}if(k<=e[2]&&f>e[2]){m.push(e)}}return m},ORM:function(f,e){var g=function(i,h){this.parent=[];this.children=[];this.isExhibit=false;this.layerNum=100;this.isCol=-1;this.next=0;this.isOK=0;this.deep=1;this.col=0;this.value=i;this.hight=((i[7]-i[6])*42-4);this.width=0;this.left=0;this.top=i[6]*42;this.content="";this.dayNum=h;this.nextObj=null};g.prototype.show=function(){c("#yyCol"+this.dayNum).find(".yy-gutter").append(this.content)};g.prototype.doWidth=function(){if(this.col+1>this.deep){this.deep=this.col+1}if(this.deep-1==this.col){this.width=100/this.deep}else{if(this.next==0){this.width=100/this.deep*2-15/(this.deep-1)}else{this.width=100/this.deep*2-15/(this.deep-1)+(this.next-this.col-1)*100/this.deep}}};g.prototype.doLeft=function(){if(this.col+1>this.deep){this.deep=this.col+1}if(this.col==0){this.left=0}else{this.left=100/this.deep*this.col}};g.prototype.bind=function(){c("#schedule"+this.value[0]).mouseenter(function(){c(this).toggleClass("borderFff").toggleClass("borderBlue")}).mouseleave(function(){c(this).toggleClass("borderFff").toggleClass("borderBlue")})};g.prototype.init=function(){this.doLeft();this.doWidth()};return new g(f,e)},addCrossDayTask:function(j){var i=this,g=i.task,h=i.viewType,k=j===h[1]?i.week:i.day,l=i.line_height,m=0,e=c(".yy-calendar-allday");g.segment_width=e.children(".yy-calendar-day-grid").outerWidth();i.top_start=0;i.drawCrossDayTask(k[0],k[1],".yy-calendar-allday",false);var f=c(".yy-calendar-allday");f.find(".yy-calendar-content").each(function(){var o=c(this).children().last(),p=o.css("top"),n=p?parseInt(p)+l+5:l+5;m=m>n?m:n});m&&f.css("height",m+"px");i.fixGridHeight(j)},drawWeekTask:function(){var u=this,w=u.oneday,r=u.viewType,e=u.week,l=u.requestData,f=u.responseData,q=f[l.start_time+"-"+l.end_time],g=e[0],s=e[1];u.addCrossDayTask(r[1]);c("div[class=yy-gutter]").empty();var v=u.filterTime(g,s,q);var t=[[],[],[],[],[],[],[]];v.sort(function(m,j){var i=parseInt(m[7])-parseInt(m[6]);var n=parseInt(j[7])-parseInt(j[6]);return parseInt(m[6])==parseInt(j[6])?n-i:parseInt(m[6])-parseInt(j[6])});for(var p=0,o=v.length;p<o;p++){var x=v[p];for(var k=0,h=7;k<h;k++){if(x[2]>=g+k*w&&x[2]<g+(k+1)*w){t[k].push(this.ORM(x,k))}}}t=this.dealDisplayData(t);for(var k=0,h=7;k<h;k++){this.allInit(t[k])}},allInit:function(h){for(var g=0,f=h.length;g<f;g++){var e=h[g];this.render(e);e.show();e.bind()}},drawDayTask:function(){var p=this,n=p.viewType,q=p.day,h=p.requestData,e=p.responseData,m=e[h.start_time+"-"+h.end_time],f=q[0],o=q[1];p.addCrossDayTask(n[2]);c("div[class=yy-gutter]").empty();var g=this.filterTime(f,o,m);g.sort(function(s,j){var i=parseInt(s[7])-parseInt(s[6]);var t=parseInt(j[7])-parseInt(j[6]);return parseInt(s[6])==parseInt(j[6])?t-i:parseInt(s[6])-parseInt(j[6])});var r=[];for(var l=0,k=g.length;l<k;l++){r.push(this.ORM(g[l],0))}r=this.dayDateDeal(r);this.allInit(r)},render:function(e){var f=this,h=e.value[9]==25?f.taskcolor:f.schecolor,g=[];g.push('<div class="yy-calendar-task borderFff ',h,' alignLeft" feedid="',e.value[11],'" type="',e.value[9],'" fromid="',e.value[8],'" cid="',e.value[0],'" id="schedule',e.value[0],'" style="top:',(e.top+1),"px;left:",(e.left==-1?e.left+"px":e.left+"%"),";width:",e.width,"%; position:absolute;z-index:",(100+e.col),";height:",e.hight,'px;">');g.push('<dl class="cbrd" style="height:',e.hight,'px;"><dt>',e.value[6],"点-",e.value[7],"点</dt>");g.push("<dd>",e.value[1],"</dd></dl></div>");e.content=g.join("")},coverRange:[[0,0],[0,0]],setCoverRange:function(){var l=this;if(l.showType==="month"){var f=l.task,m=c("#yyCalendarMonthGrid",l.$yyCalendarMain),j=m.offset(),e=m.outerWidth(),n=m.outerHeight(),k=l.coverRange;k[0][0]=j.left;k[0][1]=j.top;k[1][0]=k[0][0]+e;k[1][1]=k[0][1]+n;f.segment_width_average=e/7;f.segment_height_average=n/l.week_count}else{var g=c(".yy-calendar-day-grid"),i=g.first().offset(),h=g.last().offset(),f=l.task,k=l.coverRange;k[0][0]=i.left;k[0][1]=i.top;k[1][0]=h.left+f.segment_width;k[1][1]=h.top+f.segment_height}},selectStart:function(k,m){m.flagMousedown=k.which;m.flagSelectDay=true;var h=c(k.target).closest(".yy-calendar-day-grid"),l=parseInt(h.attr("timestamp")),j=h.offset(),i=j.left,n=j.top,r=k.pageX,q=k.pageY,f=h.outerWidth(),p=h.outerHeight(),g=m.task,o="";g.$start=g.$end=h;g.segment_width=f;g.segment_height=p;g.start_time=l;g.end_time=l+g.segment_time;g.start_left=i;g.start_top=n;g.end_left=i;g.end_top=n;g.start_x=r;g.start_y=q;g.end_x=r;g.end_y=q;m.setCoverRange();o='<div class="yy-calendar-cover-container" style="z-index:10;display:block;"><div style="left:'+i+"px;top:"+n+"px;width:"+f+"px;height:"+p+'px;" class="yy-calendar-cover">&nbsp;</div></div>';m.$body.append(o);m.$coverContainer=c(".yy-calendar-cover-container",m.$body)},selectChange:function(H,L){var o=H.pageX,k=H.pageY;var J=L.$coverContainer,u=null,f=L.coverRange,B=f[0][0],A=f[0][1],G=L.task,I=L.showType==="month"?G.segment_height_average:G.segment_height,j=L.showType==="month"?G.segment_width_average:G.segment_width,z=G.start_left,E=G.start_top,s=Math.floor((o-B)/j)*j+B,q=Math.floor((k-A)/I)*I+A;G.end_x=o;G.end_y=k;G.end_left=s;G.end_top=q;var v=s-z,t=q-E,p=Math.abs(t)/I,r=Math.ceil(p),K=r-p>0.95?r:r+1,n=Math.abs(t)>10?(t>0?1:-1):0,D=[];for(var F=0;F<K;F++){D[F]='<div style="height:'+I+'px;" class="yy-calendar-cover">&nbsp;</div>'}D=D.join("");u=c(D);var h=n>0?E:q,w=n>0?z:(n===0?(v>0?z:s):s),C=(f[1][0]-w)/j,g=Math.floor(C),m=K>1?((C-g)>0.95?(g+1)*j:g*j):j+(Math.abs(s-z)),l=n>0?(s-B+j):(z-B+j);u.each(function(e){var M=h+I*e,y=e?B:w,x=e?(e===(K-1)?l:j*7):m;c(this).css({left:y,top:M,width:x})});J.children(".yy-calendar-cover").replaceWith(u)},selectEnd:function(h,g){var f=g.getSelectTime(),i=a.calendarBiz;if(g.mid!==0){i.showNoPermission(h)}else{if(f[1]<=g.today.timestamp){i.showErrorRange(h)}else{i.openTaskCreateBox({x:h.pageX,y:h.pageY,start_time:f[0],end_time:f[1]})}}g.flagMousedown=0;g.flagSelectDay=false;g.noSelect(false)},endThanStart:function(){var j=this,g=j.task,e=g.end_left-g.start_left,k=g.end_top-g.start_top,i=Math.round(e/g.segment_width),h=Math.round(k/g.segment_height),f=h>0?1:(h<0?-1:(i>0?1:(i<0?-1:0)));return f},getSelectTime:function(){var k=this,m=c(".yy-calendar-cover",k.$body),h=k.task,i=h.segment_width,e=h.segment_time,j=h.start_time,g=0,f=0;m.each(function(n){f=f+c(this).width()});var l=Math.round(f/i)*e;if(k.endThanStart()>=0){g=j+l}else{j=j-l+e;g=h.start_time+e}return[j,g]},drawTask:function(){var g=this,i=a.calendarBiz;switch(g.showType){case"month":var f=g.fixed_date,h=f[0],e=f[1];g.top_start=18;g.drawCrossDayTask(h,e,"#yyCalendarMonthGrid");break;case"week":g.drawWeekTask();break;case"day":g.drawDayTask();break}i.backCalendar()},getInitData:function(){var f=this,e=f.requestData;f.getAjaxData(e,function(){f.drawTask()})},getData:function(){var y=this,f=arguments,l=y.oneweek,v=y.timeblock,e=y.requestRange,t=y.requestData,x=t.mid,j=0,g=0;switch(y.showType){case"month":var h=y.fixed_date;j=h[0];g=h[1];y.top_start=18;break;case"week":var n=y.week;j=n[0];g=n[1];y.top_start=0;break;case"day":var p=y.day;j=p[0];g=p[1];y.top_start=0;break}if(j>=e[0]&&g<=e[1]){y.drawTask();j=j-v;g=g+v;if(j<e[0]){e[0]=e[0]-v;var s={start_time:e[0],end_time:e[0]+v,month:t.month,mid:x};y.getAjaxData(s)}if(g>e[1]){e[1]=e[1]+v;var r={start_time:e[1]-v,end_time:e[1],month:t.month,mid:x};y.getAjaxData(r)}}else{var k=20,A=e[0],z=e[1],m=false,q=null;if(j<e[0]){for(var o=0;o<k;o++){A-=v;if(j>=A){e[0]=A;q={start_time:A,end_time:A+v,month:t.month,mid:x};y.getAjaxData(q,function(){if(o===0){f.callee.apply(y);return}for(;o>0;o--){q.start_time=q.end_time;q.end_time+=v;if(q.start_time<g){y.getAjaxData(q,function(){f.callee.apply(y)})}else{y.getAjaxData(q)}}});m=true;break}}}else{if(g>e[1]){for(var o=0;o<k;o++){z+=v;if(g<=z){e[1]=z;q={start_time:z-v,end_time:z,month:t.month,mid:x};y.getAjaxData(q,function(){if(o===0){f.callee.apply(y);return}for(;o>0;o--){q.end_time=q.start_time;q.start_time-=v;if(q.end_time>j){y.getAjaxData(q,function(){f.callee.apply(y)})}else{y.getAjaxData(q)}}});m=true;break}}}}if(!m){y.responseData={};var w=y.month,u=y.fixMonthDate(w[0],w[1]);u[0]=u[0]-v;u[1]=u[1]+v;y.setRequestData(u[0],u[1]);e[0]=u[0];e[1]=u[1];y.getInitData()}}},getAjaxData:function(f,h){var g=this,i=f.start_time,e=f.end_time;a.util.ajaxApi(a.util.url("/api/calendar/index"),function(l,k){var j=l.data;j.sort(function(n,m){return g.sortTaskData(n,m)});g.responseData[i+"-"+e]=j;typeof h==="function"&&h()},"POST","json",f)},sortTaskData:function(f,e){var j=f[2]-e[2],k=e[13]-f[13],g=f[6]-e[6],i=e[7]-f[7],h=f[10]-e[10];return j!==0?j:(k!==0?k:(!e[14]&&f[14]?1:(e[14]&&f[14]?(g!==0?g:(i!==0?i:h)):h)))},fixGridHeight:function(h){var i=this,e=i.viewType,g=i.getMainHeight(),f=i.$mainGridOuter;if(f.is(":hidden")){f.css("visibility","hidden").show()}var j=c(".yy-calendar-main-header",f).height();i.$main.height(g);h===e[0]?i.$mainGridOuter.children("#yyCalendarMonthGrid").height(g-j-1):((h===e[1]||h===e[2])?i.$mainGridOuter.children("#yyCalendarWeekBlock").height(g-j-2):"")},getGridHeight:function(){var f=this,e=f.getMainHeight(),g=c(".yy-calendar-main-header",f.$mainGridOuter).height();f.$main.height(e);f.$mainGridOuter.height(e);f.$mainEditOuter.height(e);return(e-g-2)},getMainHeight:function(){var e=740;return e},initRequestData:function(){var i=this,f=i.timeblock,g=i.oneweek,j=i.month,e=i.today.month,h=i.fixMonthDate(j[0],j[1]),k=i.requestRange;h[0]=h[0]-f;h[1]=h[1]+f;i.setRequestData(h[0],h[1],e);k[0]=h[0];k[1]=h[1]},setRequestData:function(h,f,i){var g=this,e=g.requestData;h=h?h:e.start_time;f=f?f:e.end_time;e.start_time=h;e.end_time=f;e.month=i?i:e.month;e.mid=g.mid},initDate:function(){var j=this,g=j.today,f=j.getDateObj(),h=f.getFullYear(),e=f.getMonth()+1,i=f.getDate(),k=f.getDay();g.year=h;g.month=e;g.day=i;g.theweek=k?k:7;g.timestamp=Date.parse(e+"/"+i+"/"+h)/1000;j.setDay(g.timestamp)},setDay:function(h){var f=this,g=f.oneday,e=f.day;e[0]=h?parseInt(h):e[0];e[1]=e[0]+g;f.setWeek(e[0]);f.setMonth(e[0])},setWeek:function(i){var g=this,j=0,h=g.oneday,e=g.oneweek,f=g.week;if(i<f[0]||i>=f[1]){dateObj=g.getDateObj(i);j=dateObj.getDay();j=j?j:7;f[0]=i-(j-1)*h;f[1]=f[0]+e}},setMonth:function(j){var h=this,i=h.month,f,e,g;if(j<i[0]||j>=i[1]){f=h.getDateObj(j);e=f.getFullYear();g=f.getMonth()+1;i[0]=Date.parse(g+"/1/"+e)/1000;i[1]=(g===12?Date.parse("1/1/"+(e+1)):Date.parse((g+1)+"/1/"+e))/1000;h.fixed_date=h.fixMonthDate(i[0],i[1])}h.setMiniDate(i[0])},setMiniDate:function(j){var h=this,i=h.mini_date,f,e,g;if(j<i[0]||j>=i[1]){f=h.getDateObj(j);e=f.getFullYear();g=f.getMonth()+1;i[0]=Date.parse(g+"/1/"+e)/1000;i[1]=(g===12?Date.parse("1/1/"+(e+1)):Date.parse((g+1)+"/1/"+e))/1000}},nextMonth:function(){var e=this;e.setMonth(e.month[1]);e.showMonth()},prevMonth:function(){var e=this;e.setMonth(e.month[0]-e.oneday);e.showMonth()},showMonth:function(){var k=this,l=k.today,m=k.day,j=k.month,h=k.fixed_date,n=k.getMonthDateArr(j[0],j[1],h[0],h[1]),e=n[0],o=n[1],p=n[2];if(m[0]>=j[1]||m[0]<j[0]){var i=k.hasToday(j[0],j[1])?l.timestamp:Date.parse(o+"/1/"+p)/1000;k.setDay(i)}k.week_count=parseInt(e.length/7);var g=k.drawBigMonth(e,o,p);k.$mainGridOuter.html(g);k.fixGridHeight("month");k.fixTask();var f=k.drawMiniMonth(e,o,p);c("#yyMiniCalendar").html(f);c("#yyCalendarDate").html(k.formatDate(j[0],4)[0])},nextMiniYear:function(){var f=this,e=f.getNextDateTime(f.mini_date[0],"year");f.setMiniDate(e);f.showMiniMonth();return true},prevMiniYear:function(){var f=this,e=f.getPrevDateTime(f.mini_date[0],"year");f.setMiniDate(e);f.showMiniMonth();return true},nextMiniMonth:function(){var e=this;e.setMiniDate(e.mini_date[1]);e.showMiniMonth();return true},prevMiniMonth:function(){var e=this;e.setMiniDate(e.mini_date[0]-e.oneday);e.showMiniMonth();return true},showMiniMonth:function(){var f=this,g=f.mini_date,h=f.fixMonthDate(g[0],g[1]),i=f.getMonthDateArr(g[0],g[1],h[0],h[1]);dateArr=i[0],the_month=i[1],the_year=i[2];var e=f.drawMiniMonth(dateArr,the_month,the_year);c("#yyMiniCalendar").html(e);return true},getMonthDateArr:function(o,m,h,k){if(!o||!m){return false}h=h||o;k=k||m;var A=this,p=A.oneday,n=A.getDateObj(o),s=n.getDay(),x=s?s:7,z=A.getDateObj(m-p),g=z.getDay(),B=g?g:7,q=z.getDate(),f=o===h?0:(x-1),e=m===k?0:(7-B),y=[],l=n.getFullYear(),u=n.getMonth()+1;if(f){var t=A.getDateObj(h),r=t.getDate();for(;f>0;f--){y.push(-r++)}}for(var w=1;w<=q;w++){y.push(w)}if(e){for(var v=1;v<=e;v++){y.push(-v)}}return[y,u,l]},drawBigMonth:function(v,p,f){v=v||[];var y=this,l=p-1,e=p+1,n=f,j=f,x=y.month,o=y.today.day,u=y.hasToday(x[0],x[1]),q=0,m=0,g=0,w=0,h=[];if(l===0){l=12;n-=1}if(e===13){e=1;j+=1}h.push('<table width="100%" border="0" cellspacing="0" cellpadding="0" class="yy-calendar-main-header yueliTable yue_rili_title"><tbody><tr><th class="header">周一</th><th class="header">周二</th><th class="header">周三</th><th class="header">周四</th><th class="header">周五</th><th class="header">周六</th><th class="header">周日</th></tr></tbody></table><table width="100%" border="0" cellspacing="0" cellpadding="0" class="yueliTable" id="yyCalendarMonthGrid"><tbody>');for(var r=0,s=v.length;r<s;r++){q=(q===7)?0:q;m=v[r];g=Math.abs(m);w=(m>0?Date.parse(p+"/"+g+"/"+f):((m<0&&g>20)?Date.parse(l+"/"+g+"/"+n):Date.parse(e+"/"+g+"/"+j)))/1000;h.push((q===0?"<tr>":""),'<td class="yy-calendar-day-grid ',(m>0?"yy-calendar-valid":"yy-calendar-invalid"),(u&&o===m?" yy-calendar-today":""),'" timestamp="',w,'" week="',(q+1),'" day="',g,'"><div class="yy-calendar-content relative',(q===0?" yy-calendar-row-first":(q===6?" yy-calendar-row-last":"")),'"><p class="',(m>0?"title":"title_sy"),'">',g,"</p></div></td>",(q===6?"</tr>":""));q++}h.push("</tbody></table>");return h.join("")},drawMiniMonth:function(F,z,g){var H=this,o=z-1,f=z+1,q=g,n=g,x=H.showType,u=H.mini_date,G=H.month,y=H.week,B=H.day,C=0,r=0,A=0,p=0,j=0,m=[],w="",l="",D=F.length,s=F[D-1],E=H.hasToday(u[0],u[1]),v=H.today.day,h=c.inArray(v,F),e=!!(u[0]===G[0]);if(o===0){o=12;q-=1}if(f===13){f=1;n+=1}w='<div class="riliSmall2"><header class="clearfix today"><p class="fl year alignCenter"><a class="icoLeft yy-prev-year" href="#"></a><span>'+g+'</span><a class="icoRt yy-next-year" href="#"></a></p><p class="fl day alignCenter"><a class="icoLeft yy-prev-month" href="#"></a><span>'+z+'</span><a class="icoRt yy-next-month" href="#"></a></p></header><table width="170"><thead><tr><td>一</td><td>二</td><td>三</td><td>四</td><td>五</td><td>六</td><td>日</td></tr></thead><tbody>';for(;C<D;C++){A=(A===7)?0:A;p=F[C];j=Math.abs(p);tstamp=(p>0?Date.parse(z+"/"+j+"/"+g):((p<0&&j>20)?Date.parse(o+"/"+j+"/"+q):Date.parse(f+"/"+j+"/"+n)))/1000;l=e&&(x==="month"||(x==="week"&&tstamp>=y[0]&&tstamp<y[1])||(x==="day"&&tstamp===B[0]))?"blueBg ":"";bd_str=E?(h<7?(C===(h-1)?"blueBor-right ":""):(C===(h-1)&&h%7?"blueBor-right ":(C===(h-7)?"blueBor-bottom ":""))):"";m[C]=(A===0?"<tr>":"")+'<td type="mini" pos="'+C+'" class="'+l+(p>0?"":"c6 ")+bd_str+(E&&v===p?' blueBor">':' ">')+j+"</td>"+(A===6?"</tr>":"");A++}if(D<42){s=s>10?1:Math.abs(s)+1;for(;;r++){if(r===7){break}m[D+r]=(r===0?"<tr>":"")+'<td class="c6" pos="'+(D+r)+'" type="mini">'+(s+r)+"</td>"+(r===6?"</tr>":"")}}return w+m.join("")+"</tbody></table></div>"},clickMini:function(g){var j=this,o="blueBg",f="c6",h=j.showType,n=j.oneday,e=j.mini_date,l=parseInt(g.attr("pos")),k=parseInt(g.html()),m=(!g.hasClass(f)?e[0]:((g.hasClass(f)&&l<7)?j.getPrevDateTime(e[0],"month"):e[1]))+(k-1)*n,i=h==="day"&&g.hasClass(o)?true:false;if(i){return true}j.setDay(m);j.showType=h==="month"?(g.hasClass(o)?"week":h):(h==="week"?(g.hasClass(o)?"day":h):"day");h=j.showType;j.activeMode(c("#"+h+"Calendar"));j.openCalendarView(h);return true},drawMonthCalendar:function(g,f,e,h){var i=this,j="";h=h||1;switch(h){case 1:j=i.drawBigMonth(g,f,e);break;case 2:j=i.drawMiniMonth(g,f,e);break}return j},hasToday:function(h,f){var g=this,e=g.getTimestamp();return !!(e>=h&&e<f)},getTimestamp:function(h){var f,g,e;if(typeof h==="object"||typeof h==="undefined"){h=h||new Date();f=h.getFullYear(),g=h.getMonth()+1,e=h.getDate()}else{f=h;g=arguments[1];e=arguments[2]}return Date.parse(g+"/"+e+"/"+f)/1000},getDateObj:function(e){return e?new Date(e*1000):new Date()},formatDate:function(k,m){if(!k){return false}k=typeof k!=="object"?[k]:k;m=m||2;var l=this,q=null,p=l.week_name,n,j,o,e,f=[],g=0,h=k.length;switch(m){case 1:dateformat="{year}年{month}月{day}日";break;case 2:dateformat="{year}-{month}-{day}";break;case 3:dateformat="{year}年{month}月{day}日({week})";break;case 4:dateformat="{year}年{month}月"}for(;g<h;g++){q=l.getDateObj(k[g]);n=q.getFullYear();j=q.getMonth()+1;o=q.getDate();e=q.getDay();f[g]=dateformat.replace("{year}",n).replace("{month}",j).replace("{day}",o).replace("{week}",p[e])}return f},formatTime:function(k,m){if(!k){return false}k=typeof k!=="object"?[k]:k;m=m||1;var l=this,n=null,g,f,e=[],h=0,j=k.length;switch(m){case 1:timeformat="{hour}";break;case 2:timeformat="{hour}点{minute}分";break}for(;h<j;h++){n=l.getDateObj(k[h]);g=n.getHours();f=n.getMinutes();e[h]=timeformat.replace("{hour}",g);e[h]=f?e[h].replace("{minute}",mimute):e[h].replace("{minute}分","")}return e},getPrevDateObj:function(h,f){var g=this,e=g.getPrevDateTime(h,f);return new Date(e*1000)},getPrevDateTime:function(g,j){var i=this;g=(g||i.month[0])*1000;j=j||i.showType;var f=0,h=new Date(g),n=h.getFullYear(),m=h.getMonth()+1,e=h.getDate();switch(j){case"month":var l=m-1,k=n;if(l===0){l=12;k-=1}f=Date.parse(l+"/1/"+k);break;case"week":f=Date.parse(m+"/"+e+"/"+n)-i.oneweek*1000;break;case"day":f=Date.parse(m+"/"+e+"/"+n)-i.oneday*1000;break;case"year":f=Date.parse(m+"/1/"+(n-1));break}return f/1000},getNextDateObj:function(h,e){var f=this,g=f.getNextDateTime(h,e);return new Date(g*1000)},getNextDateTime:function(h,k){h=(h||j.month[0])*1000;k=k||j.showType;var j=this,g=0,i=new Date(h),n=i.getFullYear(),l=i.getMonth()+1,e=i.getDate();switch(k){case"month":var m=l+1,f=n;if(m===13){m=1;f+=1}g=Date.parse(m+"/1/"+f);break;case"week":g=Date.parse(l+"/"+e+"/"+n)+j.oneweek*1000;break;case"day":g=Date.parse(l+"/"+e+"/"+n)+j.oneday*1000;break;case"year":g=Date.parse(l+"/1/"+(n+1));break}return g/1000},nextWeek:function(){var e=this;e.setDay(e.day[0]+e.oneweek);e.showWeek()},prevWeek:function(){var e=this;e.setDay(e.day[0]-e.oneweek);e.showWeek()},showWeek:function(){var p=this,q=p.oneday,o=p.month,j=p.fixed_date,h=p.week;var k=p.getWeekDateArr(h[0],h[1]),r=k[0],e=k[1],g=k[2],m=k[3],l=[h[0],h[1]-q],f=p.formatDate(l,1),s=p.drawWeekCalendar(r,e,g,m),n=p.getMonthDateArr(o[0],o[1],j[0],j[1]),i=p.drawMiniMonth(n[0],n[1],n[2]);p.$mainGridOuter.html(s);p.fixGridHeight("week");p.scrollToNowPos();c("#yyMiniCalendar").html(i);c("#yyCalendarDate").html(f[0]+"-"+f[1])},scrollToNowPos:function(){var f=this,e=c("#yyCalendarWeekBlock");e.scrollTop(f.nowPos-e.height()/2)},getWeekDateArr:function(u,q){var C=this,m=C.oneday,g=C.getDateObj(u),B=C.getDateObj(q-m),x=[g.getFullYear(),B.getFullYear()],h=g.getMonth()+1,r=B.getMonth()+1,v=g.getDay(),f=B.getDay(),e=g.getDate(),A=B.getDate(),p=(q-u)/m,l=[],n=[],o=[],z=0,y=0,w=0,s=0;if(h===r){for(;w<p;w++){l[w]=e+w;o[w]=h;n[w]=v++;if(v===7){v=0}}}else{while(A){s=p-1-z;l[s]=A;o[s]=r;n[s]=f--;if(f===-1){f=6}z++;A--}while((y+z)<p){l[y]=e+y;o[y]=h;n[y]=v++;if(v===7){v=0}y++}}return[l,n,o,x]},nowPos:0,drawWeekCalendar:function(o,q,t,E,f){f=f||7;var L=this,x=L.line_height,J=L.week_name,p=L.oneday,K=L.today,B=K.timestamp,y=f===1?L.day:L.week,C=L.hour_height,H=0,G=0,F=24,v=0,r=[],s=[],z=C*F,I=parseInt(new Date().getTime()/1000),l=((I-B)/p)*z,u=L.getTimestamp(E[0],t[0],o[0]),h=L.hasToday(y[0],y[1]),m=h?(B-y[0])/p:0;L.nowPos=l;r.push('<div class="yy-calendar-main-header" style="padding-right:16px;*padding-right:0px; height:auto; overflow:hidden;"><table width="100%" cellspacing="0" cellpadding="0" border="0" class="riliTable"><tr><td style="width:42px; *width:43px;overflow:hidden; text-align:center;">24小<br />时制 </td>');for(;H<f;H++){r.push("<td"+(f===7?' style="width:93px; *width:93px;"':' style="text-align:center;"')+'><span class="alignLeft">',t[H],"/",o[H],"</span>",J[q[H]],"</td>");s.push('<td day="',o[H],'" week="',(q[H]?q[H]:7),'" timestamp="',(u+p*H),'" class="yy-calendar-valid yy-calendar-day-grid',(h&&m===H?" yy-calendar-today":""),'"><div class="yy-calendar-content relative"></div></td>')}r.push('</tr><tr class="yy-calendar-allday yueliTable" style="height:',(x+5),'px;"><td style="width:42px; *width:43px;text-align:center;vertical-align:middle;">全天</td>',s.join(""),"</tr></table></div>");r.push('<div class="yy-calendar-week-block yy-calendar-main" id="yyCalendarWeekBlock" style="position:relative;"><div style="margin-top:0px;" class="yy-mainwrapper">','<table cellspacing="0" cellpadding="0" style="height:',z,'px" class="yy-calendar-day-table"><tbody>','<tr height="1"><td style="width:42px;"></td>','<td colspan="',f,'"><div class="yy-spanningwrapper"><div class="yy-hourmarkers">');for(;F>0;F--){r.push('<div class="yy-markercell"><div class="yy-dualmarker"></div></div>')}r.push('</div></div><div id="yySpanningWrapper" class="yy-spanningwrapper yy-chipspanningwrapper"></div></td></tr>');r.push('<tr><td class="yy-calendar-day-times">');for(;G<24;G++){r.push('<div style="height:',C,'px;"><div style="height:',C,'px;" class="yy-calendar-day-time">',G,"点</div></div>")}r.push('<div style="left:0px;top:',(l-4),'px;" class="yy-nowptr" id="yyNowptr"></div></td>');var g="",n="yy-gutter",e="",D="",A="";for(;v<f;v++){g="yy-calendar-day-block",A="",e="";if(h&&m===v){g="yy-calendar-today-block",A='<div style="height:'+z+"px;margin-bottom:-"+z+'px;" class="yy-calendar-today">&nbsp;</div>',e='<div style="top:'+l+'px;" id="yyNowmarker" class="yy-hourmarker yy-nowmarker"></div>'}g+=v>4?" yy-calendar-weekend":"";r.push('<td class="',g,'"'+(f===7?' style="width:93px; *width:93px;"':"")+">",A,'<div style="height:',z,"px;margin-bottom:-",z,'px" class="yy-col-taskwrapper" id="yyCol',v,'"><div class="',n,'">',D,'</div></div><div class="yy-col-overlaywrapper" id="yyOver',v,'">',e,"</div></td>")}r.push("</tr></tbody></table></div></div>");return r.join("")},nextDay:function(){var e=this;e.setDay(e.day[0]+e.oneday);e.showDay()},prevDay:function(){var e=this;e.setDay(e.day[0]-e.oneday);e.showDay()},showDay:function(){var n=this,o=n.day,m=n.month,j=n.fixed_date;var h=n.getWeekDateArr(o[0],o[1]),q=h[0],e=h[1],f=h[2],k=h[3],i=n.drawDayCalendar(q,e,f,k),p=n.formatDate(o[0],1),l=n.getMonthDateArr(m[0],m[1],j[0],j[1]),g=n.drawMiniMonth(l[0],l[1],l[2]);n.$mainGridOuter.html(i);n.fixGridHeight("day");n.scrollToNowPos();c("#yyMiniCalendar").html(g);c("#yyCalendarDate").html(p[0])},getDayArr:function(i,f){var l=this,n=l.week_name,h=l.getDateObj(i),k=[h.getFullYear()],g=[h.getMonth()+1],m=[h.getDate()],o=h.getDay(),e=[g[0]+"/"+m[0]];o=o===0?6:(o-1);var j=[n[o]];return[e,j,g,k]},drawDayCalendar:function(i,h,e,f){var g=this;return g.drawWeekCalendar(i,h,e,f,1)},fixMonthDate:function(i,f){var j=this,l=j.oneday,g=j.getDateObj(i),h=g.getDay(),k=j.getDateObj(f),m=k.getDay(),e=[];h=h?h:7;m=m?m:7;e[0]=i-(h-1)*l;e[1]=f+(8-m)*l;return e},getTaskPos:function(f,g){var e=0;if(typeof f[g]!=="undefined"){for(;e<999;e++){if(c.inArray(e,f[g])===-1){f[g].push(e);break}}}else{f[g]=[e]}return e},setTaskPos:function(g,l,e,f){var j=this,m=j.oneday,h=0;l=parseInt(l);f=f||1;for(;h<f;h++){timestamp=l+h*m;if(typeof g[timestamp]!=="undefined"){c.inArray(e,g[timestamp])===-1&&g[timestamp].push(e)}else{g[timestamp]=[e]}}},addTaskLine:function(r,I,J,x,y,o,t){var p=this,l=r[I],v=l[9]==25?p.taskcolor:p.schecolor,j=p.oneday,D=p.task,w=D.segment_width,O=D.segment_height,g=p.month,K=g[0],z=g[1],u=p.fixMonthDate(K,z),M=p.top_start,f=p.line_height,m=f-2,F=Math.floor((O-M)/f),B=J.closest("td"),h=parseInt(B.attr("timestamp")),n=parseInt(B.attr("week")),k,N=J.children(".absolute").filter(".more-task"),E,s,L=1,q,P,G,H,e="",C,A=p.arrow_width;if(x<F&&!(x===(F-1)&&N.length)){G=o?'<div class="st-ad-ml"></div><div class="st-ad-ml2"></div>':"";H=t?'<div class="st-ad-mr"></div><div class="st-ad-mr2"></div>':"";C=y*w-4;C=o?(C-A):C;C=t?(C-A):C;e='<div cid="'+l[0]+'" fromid="'+l[8]+'" type="'+l[9]+'" feedid="'+l[11]+'" class="yy-calendar-task absolute '+(l[14]?"rc":v)+'" endtime="'+l[3]+'" style="width:'+C+"px;height:"+m+"px;line-height:"+m+"px;top:"+(M+f*x)+"px;left:"+(o?(A+1):1)+'px">'+G+H+'<span class="yy-calendar-task-line">'+l[1]+"</span></div>";J.append(e)}else{k=N.length?N:J.children(".absolute").last();if(k.length){if(k.hasClass("more-task")){E=parseInt(k.attr("num"));k.attr("num",E+1).children("span").html("+"+(E+1)+"更多项")}else{taskLast_width=parseInt(k.css("width"));cross_day=Math.round((taskLast_width+4)/w);if(cross_day>1){B.nextUntil('[timestamp="'+(h+cross_day*j)+'"]').each(function(Q){var R='<div class="absolute rlhid more-task" num="1" style="width:'+(w-4)+"px;height:"+m+"px;line-height:"+m+"px;top:"+(M+f*(F-1))+'px;left:1px"><span class="yy-calendar-task-line">+1更多项</span></div>';c(this).children(".yy-calendar-content").append(R)})}k.removeClass().addClass("absolute rlhid more-task").attr("num",2).css({width:(w-4),left:"1px"}).html('<span class="yy-calendar-task-line">+2更多项</span>')}}else{e='<div class="absolute rlhid more-task" num="2" style="width:'+(w-4)+"px;height:"+m+"px;line-height:"+m+"px;top:"+(M+f*(F-1))+'px;left:1px"><span class="yy-calendar-task-line">+2更多项</span></div>';J.append(e);for(;;L++){if(L>I){break}s=r[I-L];if(s[2]<l[2]&&s[3]>=l[2]){K=u[0];z=u[1];q=s[2];P=s[3];q=q>=K?q:K;P=P>=z?z:P;q=(h-(n-1)*j)<q?q:(h-(n-1)*j);$taskStartGrid_prev=B.siblings('[timestamp="'+q+'"]').eq(0);$taskStartGrid_prevTaskLast=$taskStartGrid_prev.find(".absolute").last();taskStartGrid_prevTaskLast_width=$taskStartGrid_prevTaskLast.width();$taskStartGrid_prevTaskLast.removeClass().addClass("absolute rlhid more-task").attr("num",1).css({width:(w-4),left:"1px"}).html('<span class="yy-calendar-task-line">+1更多项</span>');cross_day=Math.round((taskStartGrid_prevTaskLast_width+4)/w);if(cross_day>2){$taskStartGrid_prev.nextUntil('[timestamp="'+(q+cross_day*j)+'"]').each(function(Q){var S=c(this).children(".yy-calendar-content"),R="";if(!S.children(".absolute").last().hasClass("more-task")){R='<div class="absolute rlhid more-task" num="1" style="width:'+(w-4)+"px;height:"+m+"px;line-height:"+m+"px;top:"+(M+f*(F-1))+'px;left:1px"><span class="yy-calendar-task-line">+1更多项</span></div>';S.append(R)}})}break}}}if(y>1){B.nextUntil('[timestamp="'+(h+y*j)+'"]').each(function(S){var R=c(this).children(".yy-calendar-content"),Q=R.children(".absolute").last(),T="",U;if(Q.hasClass("more-task")){U=parseInt(Q.attr("num"));Q.attr("num",U+1).children("span").html("+"+(U+1)+"更多项")}else{T='<div class="absolute rlhid more-task" num="1" style="width:'+(w-4)+"px;height:"+m+"px;line-height:"+m+"px;top:"+(M+f*(F-1))+'px;left:1px"><span class="yy-calendar-task-line">+1更多项</span></div>';R.append(T)}})}}},drawCrossDayTask:function(q,o,C,y){y=(typeof y==="undefined")?true:y;var L=this,r=L.oneday,z=L.$mainGridOuter.find(C),M=z.clone(),v=M.find("td.yy-calendar-day-grid"),n=2,l=0,J,N,H,t,f;var g=null,e=L.getTaskData(q,o),u,p,K,x,s,A,h,j,w,G={};for(var E=0,F=e.length;E<F;E++){g=e[E];if(g[3]<=q||g[2]>=o){continue}if(!y&&g[14]){continue}u=g[2];p=g[3];K=u>=q?u:q;x=p>=o?o:p;s=(x-K)/r;A=Math.floor((K-q)/r);h=v.eq(A);j=h.children(".yy-calendar-content");w=parseInt(h.attr("week"));var B=L.getTaskPos(G,K);var D=(s+w)>8?Math.ceil((s+w-1)/7):1;var m=D>1?((s+w-1)%7===0?7:(s+w-1)%7):0;var I=D>1?(8-w):s;L.setTaskPos(G,K,B,I);var t=(K===u)?false:true,f=(x===p&&m===0)?false:true;L.addTaskLine(e,E,j,B,I,t,f);for(;n<=D;n++){N=A+(8-w)+(n-2)*7;J=v.eq(N);if(J.length){H=parseInt(J.attr("timestamp"));I=n===D?m:7;l=L.getTaskPos(G,H);L.setTaskPos(G,H,l,I);t=true;f=(n===D&&x===g[3])?false:true;L.addTaskLine(e,E,J.children(".yy-calendar-content"),l,I,t,f)}}n=2}z.replaceWith(M)},getTaskData:function(j,f){var i=this,g=i.responseData,h=i.getTaskDataKey(j,f),e=[];c.each(h,function(m,l){if(m===0){e=e.concat(g[l])}else{var k=l.split("-");c.each(g[l],function(n,o){if(o[2]>=k[0]){e.push(o)}})}});return e},getTaskDataKey:function(i,e){var h=this,f=h.responseData,g=[];c.each(f,function(l){var j=l.split("-");if(j[0]>=e||j[1]<=i){return true}g.push(l)});return g},initTask:function(){var f=this,g=f.$mainGridOuter.children("#yyCalendarMonthGrid"),h=g.offset(),e=c(".yy-calendar-valid",g).eq(0);f.task={mainGrid_width:g.width(),mainGrid_height:g.height(),mainGrid_left:h.left,mainGrid_top:h.top,segment_time:f.oneday,segment_width_average:g.outerWidth()/7,segment_height_average:g.outerHeight()/f.week_count,segment_width:e.outerWidth(),segment_height:e.outerHeight(),$start:null,$end:null,start_time:0,end_time:0,start_left:0,start_top:0,end_left:0,end_top:0,start_x:0,start_y:0,end_x:0,end_y:0}},fixTask:function(){var g=this,e=g.task,h=g.$mainGridOuter.children("#yyCalendarMonthGrid"),i=h.offset(),f=c(".yy-calendar-valid",h).eq(0);e.mainGrid_width=h.width();e.mainGrid_height=h.height();e.mainGrid_left=i.left;e.mainGrid_top=i.top;e.segment_time=g.oneday;e.segment_width=f.outerWidth();e.segment_height=f.outerHeight()},noSelect:function(e){var f=this;f.$body.noSelect(e)},isInMainGrid:function(l,j){var k=this,h=k.task,i=h.mainGrid_width,f=h.mainGrid_height,g=h.mainGrid_left,e=h.mainGrid_top;return l>g&&j>e&&l<(g+i)&&j<(e+f)},closeFloatBox:function(){var e=c("#yyFloatbox");e.hide().css({visibility:"hidden"});return true},closeCreatePanel:function(){var e=this,f=c("#yyCreatePanel");f.hide().css({visibility:"hidden"});e.removeCoverContainer();e.removeErrorFloatbox();e.removeNoPermissionFloatbox();if(this.timeSelectValue.div!=null){this.timeSelectValue.div.remove();this.timeSelectValue.div=null}return true},removeErrorFloatbox:function(){c("#yyErrorFloatbox").remove()},removeNoPermissionFloatbox:function(){c("#yyNoPermissionFloatbox").remove()},removeCoverContainer:function(){var e=c(".yy-calendar-cover-container");e.remove()},openMoreTaskBox:function(z,r,w){w=typeof w==="undefined"?true:false;var h=z.$mainGridOuter,k=parseInt(r.attr("timestamp")),o=z.oneday,f=z.getTaskData(k,k+o),t=z.line_height,p=t-2,y='<div style="z-index:180;width:225px;" class="cc" id="yyMoreTaskBox"><div class="cc-titlebar"><div class="cc-close" id="yyMoreTaskBoxClose">×</div><div class="cc-title">'+z.formatDate(k,3)[0]+'</div></div><div class="cc-body"><div class="st-contents"><table cellspacing="0" cellpadding="0" class="st-grid">',q='<div class="st-ad-ml"></div><div class="st-ad-ml2"></div>',x='<div class="st-ad-mr"></div><div class="st-ad-mr2"></div>',u="height:"+p+"px;line-height:"+p+"px;";c.each(f,function(C,B){if(!w&&B[14]){return true}var A=B[9]==25?z.taskcolor:z.schecolor;if(k>=B[2]&&k<B[3]){y+='<tr class="yy-calendar-task borderFff" cid="'+B[0]+'" fromid="'+B[8]+'" type="'+B[9]+'" feedid="'+B[11]+'"><td class="st-c"><div class="st-c-pos"><div class="st-ad-mpad st-ad-mpadr rb-n '+(B[14]?"rc":A)+'" style="'+u+'"><div class="rb-ni">'+(k>B[2]?q:"")+((k+o)<B[3]?x:"")+B[1]+"</div></div></div></td></tr>"}});y+="</table></div></div></div>";$moreTaskBox=c(y);h.append($moreTaskBox);var l=$moreTaskBox.outerHeight(),m=$moreTaskBox.outerWidth(),i=h.height(),s=h.width(),g=r.position(),j=g.left,e=g.top,n=(s-j)>m?j:(s-m),v=(i-e)>l?e:(i-l);$moreTaskBox.css({visibility:"visible",left:n,top:v});return true},closeMoreTaskBox:function(){var e=c("#yyMoreTaskBox");e.remove();return true},changeToNext:function(){var e=this;switch(e.showType){case"month":e.nextMonth();break;case"week":e.nextWeek();break;case"day":e.nextDay();break}e.getData();return true},changeToPrev:function(){var e=this;switch(e.showType){case"month":e.prevMonth();break;case"week":e.prevWeek();break;case"day":e.prevDay();break}e.getData();return true},refreshCalendar:function(){var e=this;switch(e.showType){case"month":e.showMonth();break;case"week":e.showWeek();break;case"day":e.showDay();break}e.getData()},saveForm:function(f){var j=this,h=j.mid,g={beforeSubmit:e,success:i};f.ajaxSubmit(g);function i(p,q,r,l){var k=null,m=null,n=null;if(q==="success"){try{k=c.parseJSON(p);if(k.rs===false){c.yy.rscallback(k.error)}else{m=k.data[0];n=j.responseData;c.each(n,function(t,s){var u=t.split("-");if((m[2]>=u[0]&&m[2]<u[1])||(m[3]>u[0]&&m[3]<=u[1])){s.push(m);s.sort(function(w,v){return j.sortTaskData(w,v)})}});j.refreshCalendar();c.yy.rscallback("恭喜你创建成功！")}}catch(o){a.util.trace("error")}j.closeCreatePanel()}}function e(m,l,k){if(h){c.yy.rscallback("您没有在此日历创建日程和任务的权限！");j.closeCreatePanel();return false}this.url=l.attr("action")+"?ajaxsubmit=1";return true}return false},activeMode:function(f){var g=this,e=g.viewType,i=g.showType,h=(i===e[0])?"本月":(i===e[1]?"本周":"今天");f.addClass("cur").siblings("a").removeClass("cur");c(".yy-calendar-hastoday").attr("mode",g.showType).html(h)},documentMouseMove:function(j,i){var f=c(j.target);if(i.flagMousedown===1){if(i.flagSelectDay){var h=j.pageX,g=j.pageY,k=i.coverRange;if(k[0][0]<h&&h<k[1][0]&&k[0][1]<g&&g<k[1][1]){i.selectChange(j,i)}}if(i.flagSelectTime){i.timeSelectChange(j,i)}}},documentMouseDown:function(i,h){var g=c(i.target),f=null;!g.closest("#yyMoreTaskBox").length&&h.closeMoreTaskBox();if(!(g.closest("#yyFloatbox").length||g.closest("#fancybox-overlay").length||g.closest("#fancybox-wrap").length)){h.closeFloatBox()}if(!(g.closest("#yyCreatePanel").length||g.closest("#fancybox-overlay").length||g.closest("#fancybox-wrap").length)){h.closeCreatePanel()}if((f=g.closest("#yyMiniCalendar")).length){f.noSelect()}if(g.closest(".yy-calendar-day-grid").length){h.noSelect();b.trace(1111);!g.closest(".absolute").length&&h.selectStart(i,h)}if(!g.closest(".yy-gutter").length&&g.closest(".yy-col-taskwrapper").length){h.noSelect();h.timeSelectStart(i,h)}},documentMouseUp:function(g,f){if(f.flagMousedown===1){f.flagSelectDay&&f.selectEnd(g,f);f.flagSelectTime&&f.timeSelectEnd(g,f)}},documentClick:function(j,n){if(!(j.which===1||j.which===0)){return true}var g=c(j.target),q=null,k=g.attr("click"),l=true,i=a.calendarBiz;g.closest("#yyCalendarNavNext").length&&n.changeToNext()&&(l=false);g.closest("#yyCalendarNavPrev").length&&n.changeToPrev()&&(l=false);(q=g.closest(".more-task")).length&&(q.closest(".yy-calendar-allday").length?n.openMoreTaskBox(n,q.closest("td"),false):n.openMoreTaskBox(n,q.closest("td")))&&(l=false);g.closest("#yyMoreTaskBoxClose").length&&n.closeMoreTaskBox()&&(l=false);(q=g.closest(".yy-calendar-task")).length&&i.openTaskDetailBox(j,q.attr("fromid"),q.attr("feedid"),q.attr("type"))&&(l=false);if(g.closest(".yy-floatbox-close").length||g.closest(".yy-create-cancel").length){n.closeFloatBox();n.closeCreatePanel();l=false}g.closest(".yy-next-month").length&&n.nextMiniMonth()&&(l=false);g.closest(".yy-prev-month").length&&n.prevMiniMonth()&&(l=false);g.closest(".yy-next-year").length&&n.nextMiniYear()&&(l=false);g.closest(".yy-prev-year").length&&n.prevMiniYear()&&(l=false);g.attr("type")=="mini"&&n.clickMini(g)&&(l=false);if(g.closest(".yy-calendar-view-button").length){if((q=g.closest(".yy-view-button")).length){if(!q.hasClass("cur")){c(".rili_cont").show();c("#yyCalendarMainSearch").hide();n.openCalendarView(q.attr("view"))}n.activeMode(q);l=false}}(q=g.closest(".yy-calendar-hastoday")).length&&n.changeToToday(q.attr("mode"))&&(l=false);if((q=g.closest(".yy-user-item")).length){if(g.closest(".yy-user-item-delete").length){}else{if(g.closest(".yy-user-item-lock").length){}else{n.changeToTheUser(q)&&(l=false)}}}(q=g.closest(".yy-calendar-operate")).length&&i.activeOperate(q)&&(l=false);g.closest(".yy-back-calendar").length&&i.backCalendar()&&(l=false);if(g.closest(".yy-task-tab").length){!g.hasClass("yy-task-tab")&&i.changeCreateTab(g)&&(falg=false)}if((q=g.closest(".yy-delete")).length){var o=q.closest("div"),h=o.attr("feed_id"),f=o.attr("start");end=o.attr("end");i.deleteTask(h,f,end)&&(l=false)}if((q=g.closest(".yy-follow")).length){var o=q.closest("div"),p=o.attr("from_id"),m=o.attr("type");i.followTask(q,p,m,0)&&(l=false)}if((q=g.closest(".yy-followed")).length){var o=q.closest("div");i.followTask(q,o.attr("from_id"),o.attr("type"),1)&&(l=false)}if((q=g.closest(".yy-calendar-search-detail-toggle")).length){i.toggleSearchLineDetail(q)&&(l=false)}if(k){var k=i.actMap[k];typeof k!=="undefined"&&i[k](g)}return l},documentKeyDown:function(g,f){if(g.keyCode===27){c("#yyFloatbox").css("visibility")==="visible"&&f.closeFloatBox();(!!c("#yyNoPermissionFloatbox").length||!!c("#yyErrorFloatbox").length||c("#yyCreatePanel").css("visibility")==="visible")&&f.closeCreatePanel();c("#yyMoreTaskBox").css("visibility")==="visible"&&f.closeMoreTaskBox()}},documentKeyUp:function(h,g){var f=c(h.target),i=a.calendarBiz;if(f.is('input[name="title"]')){i.handleFormStatus(f)}},documentSubmit:function(h,g){var f=c(h.target),i=a.calendarBiz;if(f.is("#calendarSearchForm")){i.taskSearch(f)}else{!f.find('input[type="submit"]').hasClass("darkGrayButton")&&g.saveForm(f)}},documentMouseOver:function(i,h){var g=c(i.target),f=null,j=a.calendarBiz;if(g.closest(".yy-calendar-operates").length){j.openOperateList(g)}},documentMouseOut:function(i,h){var f=c(i.target),g=c(i.relatedTarget),j=a.calendarBiz;if(($realTarget=f.closest(".yy-calendar-operates")).length&&!g.closest(".yy-calendar-operates").length){j.closeOpereateList($realTarget)}},initEventHandler:function(){var e=this;e.$document.on({click:function(f){return e.documentClick(f,e)},mouseover:function(f){e.documentMouseOver(f,e)},mouseout:function(f){e.documentMouseOut(f,e)},mousemove:function(f){e.documentMouseMove(f,e)},mouseup:function(f){e.documentMouseUp(f,e)},mousedown:function(f){e.documentMouseDown(f,e)},keydown:function(f){e.documentKeyDown(f,e)},keyup:function(f){e.documentKeyUp(f,e)},submit:function(f){e.documentSubmit(f,e);return false}});e.$mainSearchOuter.on({mouseenter:function(g){var f=c(this);f.find(".operate").show()},mouseleave:function(g){var f=c(this);f.find(".operate").hide()}},".yy-calendar-search-line")},initTaskCreatePanel:function(n,l){var w=this,h=w.oneday,m=w.formatDate([n,l],2),f,u,j,o="",k=w.getNextDateTime(n,"day"),s=a.util.url("/common/search/ccnotice");var g="yyCreatePanel";var t=c("#"+g),r=t.length;if(!r){var v=c("#"+g+"Template").html();if(!!v){var e={title1:"创建日程",title2:"创建任务",scheduleUrl:b.url("/schedule/add/subadd"),forNotice:b.url("/space/ajax/selectmember/for/notice_div"),taskUrl:b.url("/task/add/subadd"),forManageuser:b.url("/space/ajax/selectmember/for/manageuser_div"),forJoinuser:b.url("/space/ajax/selectmember/for/joinuser_div"),forNoticeuser:b.url("/space/ajax/selectmember/for/noticeuser_div")};var i=v.format(e);w.$body.append(i)}}else{t.replaceWith(w.editPanelHtml)}t=c("#"+g);c('#calendar_sche [name="notice_p"]').yyautocomplete({inputName:"notice_div",appendTo:"#calendar_sche .notice_div_p",selAppendTo:"#calendar_sche .notice_list_p",ajaxUrl:s});c('#calendar_task [name="notice_p"]').yyautocomplete({inputName:"joinuser_div",appendTo:"#calendar_task .notice_div_p",selAppendTo:"#calendar_task .notice_list_p",ajaxUrl:s});c('#calendar_task [name="notice_n"]').yyautocomplete({inputName:"manageuser_div",appendTo:"#calendar_task .notice_div_n",selAppendTo:"#calendar_task .notice_list_n",ajaxUrl:s});c('#calendar_task [name="notice_u"]').yyautocomplete({inputName:"noticeuser_div",appendTo:"#calendar_task .notice_div_u",selAppendTo:"#calendar_task .notice_list_u",ajaxUrl:s});c(".rcAddmenr").fancybox({onComplete:function(y){var z={};z=c(y).parent().parent().find(".rcAddmenListUl");var x=c(y).attr("for");c("#consoleBtn_"+x).bind("click",function(){var C="",A=c("#selectedContainter").find("figure");if(A.length<1){c("#msgNote").html("请选择人员!");return}for(var B=0;B<A.length;B++){var E=c(A[B]).attr("itemid");var D=c(A[B]).text().split("(");if(c("#yyauto_li_"+E).length==0){C+='<li id="yyauto_li_'+E+'" class="clearfix rcAddmenListli"><span>'+D[0]+'</span><input type="hidden" value="'+E+'" name="'+x+'_value[]"><a class="close" href="javascript:;"></a></li>'}}c(z).prepend(C).find(".close").bind("click",function(){c(this).parent().remove()});c.fancybox.cancel();c.fancybox.close()})}});if(a.util.isIE()){var p={};if(c('#calendar_sche [name="title"]').val()==""){p.sche_title={txt:"日程主题"}}if(c('#calendar_sche [name="notice_p"]').val()==""){p.sche_notice_p={txt:"添加参与人"}}if(c('#calendar_sche [name="address"]').val()==""){p.sche_address={txt:"地点"}}if(c('#calendar_task [name="title"]').val()==""){p.task_title={txt:"任务名称"}}if(c('#calendar_task [name="notice_n"]').val()==""){p.task_notice_n={txt:"负责人"}}if(c('#calendar_task [name="notice_p"]').val()==""){p.task_notice_p={txt:"参与者"}}if(c('#calendar_task [name="notice_u"]').val()==""){p.task_notice_u={txt:"知会人"}}c.yy.defaultText(p)}if(m[0]===m[1]||((l-n)<h&&k===l)){u=w.formatTime([n,l],1);f=w.formatDate(n,3);j=w.formatTime([n,l],2);if(!!(k===l)){u[1]=24;j[1]="24点";m[1]=m[0]}o=f[0]+","+j[0]+"-"+j[1]}else{u=[0,24];l=l-h;m=w.formatDate([n,l],2);if(l==n){f=w.formatDate(n,3);o=f[0]}else{f=w.formatDate([n,l],3);o=f[0]+"-"+f[1]}}var q=c(".yy-floatbox-content",t);c('input[name="startdate"]',q).val(m[0]);c('input[name="enddate"]',q).val(m[1]);c('input[name="starthour"], input[name="starthours"]',q).val(u[0]);c('input[name="endhour"], input[name="endhours"]',q).val(u[1]);c(".yy-formatdate-str",q).html(o);(!!(l==n)&&w.hasToday(n,n+h))&&c(".yy-calendar-task-create .yy-formatdate-str",q).html(o+'<lable style="margin-left:5px"><input type="checkbox" checked="checked" name="fastcomplete" value="1" />尽快完成</lable>')},getTaskHtml:function(){var i=this,g="yyCreatePanel";var j=c("#"+g),e=j.length;if(!e){var h=c("#"+g+"Template").html();if(!!h){var f={title1:"创建日程",title2:"创建任务",scheduleUrl:b.url("/schedule/add/subadd"),forNotice:b.url("/space/ajax/selectmember/for/notice_div"),taskUrl:b.url("/task/add/subadd"),forManageuser:b.url("/space/ajax/selectmember/for/manageuser_div"),forJoinuser:b.url("/space/ajax/selectmember/for/joinuser_div"),forNoticeuser:b.url("/space/ajax/selectmember/for/noticeuser_div")};var k=h.format(f);i.editPanelHtml=k;i.$body.append(k)}}},changeToTheUser:function(e){var f=this;if(e.hasClass("actived")){return true}if(f.mid=parseInt(e.attr("mid"))){e.addClass("actived").siblings().removeClass("actived");c("#yySelfItem").removeClass("actived")}else{f.mid=0;e.addClass("actived");c("#yyOtheruserList").children().removeClass("actived")}f.setCalendarTitle(e);f.setClickTaskUrl();f.showType=f.viewType[0];f.activeMode(c("#"+f.showType+"Calendar"));f.initCalendar();return true},setCalendarTitle:function(e){var g=this,f=g.mid;if(f){var h=e.children().eq(1).html();h="<label id='cantitle'>"+h+"的日历</label>"}else{h="<label id='cantitle'>我的日历</label>"}c("#cantitle").replaceWith(h)},setClickTaskUrl:function(){var g=this,f=g.mid,e=c(".yy-calendar-big-tab a");if(e.length){e.each(function(m){var l=c(this),j=l.attr("href");var k=j.indexOf("/member_id");if(k!==-1){j=j.slice(0,k)}else{var h=j.length,n=j.charAt(h-1);if(n==="/"){j=j.slice(0,h-1)}}j+=f?"/member_id/"+f:"";l.attr("href",j)})}},changeToToday:function(f){var e=this;e.setDay(e.today.timestamp);e.showType=f;e.activeMode(c("#"+f+"Calendar"));e.openCalendarView(f);return true},deleteTaskData:function(f,i,e){var h=this,g=h.responseData;c.each(g,function(l,m){var n=l.split("-");if((i>=n[0]&&i<n[1])||(e>n[0]&&e<=n[1])){for(var k=0,j=m.length;k<j;k++){if(typeof m[k]!=="undefined"&&m[k][11]==f){m.splice(k,1);break}}}})}}}(jQuery,YY,YY.util));$(function(){var e=location.href;if(e.indexOf("member_id")!==-1){var a=e.split("/"),f=a.length,b=0;while(f--){var d=a[f];if(!!$.trim(d)){b=parseInt(d);break}}if(b){YY.calendar.setMid(b);var c=$('[mid="'+b+'"]');if(c.length){$("#yySelfItem").removeClass("actived");c.addClass("actived")}}}YY.calendar.init();YY.calendarBiz.initTaskSearch();YY.util.loadScript(["plugin/jquery.form.js"]);YY.util.loadScript(["lib/jq/jquery-ui-1.8.18.custom.min.js"],{fn:function(){var h=$("#yyOtheruserList"),g,i;h.sortable({disabled:true,revert:true,cursor:"move",opacity:0.5,start:function(l,k){var j=k.item;g=j.index()},stop:function(p,n){var k=n.item;i=k.index();if(i!==g){if(g>i){var m=g;g=i;i=m}var j=h.children().slice(g,i+1);var l={"mid[]":[],"sort[]":[]};j.each(function(r){var q=$(this).attr("mid");l["mid[]"].push(q);l["sort[]"].push(g+r+1)});var o=YY.util.url("/calendar/user/dragsort/");YY.util.ajaxApi(o,function(r,q){},"POST","json",l)}}});$(".yy-active-sort").on({click:function(){var j=$(this);if(j.attr("sort")){j.removeAttr("sort").html("拖拽排序");h.sortable("disable")}else{j.attr("sort","1").html("完成排序");h.sortable("enable")}}})}})});