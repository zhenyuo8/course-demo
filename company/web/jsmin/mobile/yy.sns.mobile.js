var $Tool={globalId:(function(){var a=0;return function(){return a++}})(),extendClass:function(){var a=Object.prototype.constructor;return function(b,f){var c=f.prototype;var e=b.prototype;var d=function(){};d.prototype=c;e=b.prototype=new d();b.superclass=c;e.constructor=b;if(c.constructor==a){c.constructor=f}b.prototype.toString=f.prototype.toString;return b}}(),isDefined:function(a){return typeof a!="undefined"&&a!=null},getParameter:function(b){var a=location.search.replace(/\?/g,"");return Iss.Base.convert(a,"=","&")[b]},exec:function(a){return a()}};String.prototype.format=function(d){if(d!=null){var a=this;for(var b in d){var c=new RegExp("\\<\\%\\="+b+"\\%\\>","gi");a=a.replace(c,d[b]?(d[b]=="null"?"":d[b]):"")}}return a};var YYM={baseUrl:yyBaseurl,flag:"/mwebapp/1",replayFlag:false,_ajaxApi:function(b,c){if(typeof c!=="function"){return false}var a=arguments.length,e=a>2?arguments[2]:"",f=a>3?arguments[3]:"",d=a>4?arguments[4]:"";$.mobile.loadingMessageTextVisible=false;$.mobile.showPageLoadingMsg();$.ajax({async:true,type:(e?e:"GET"),url:b,cache:true,data:d,dataType:(f?f:"html"),success:function(h,g){c(h,g);$.mobile.hidePageLoadingMsg()},error:function(g,i,h){alert("网络出错。");$.mobile.hidePageLoadingMsg()}})},getTarget:function(b,c){var a=b.closest("."+c);return a.hasClass(c)?a:null},execCallback:function(a,c,b){$target=this.getTarget(a,c);if($target){return b($target)}},hasOneOfClasses:function(c,b){var a=false;if(b instanceof Array){$.each(b,function(d,e){if(c.hasClass(e)){a=true;return false}})}return a},tapOrClick:function(d,k){var c=$(d),f=$(k.target),p="";if(YYM.execCallback(f,"yy-m-getmore-reply",a)||YYM.execCallback(f,"yy-m-reply-block",l)||YYM.execCallback(f,"yy-m-content-block",j)){return true}function a(e){if(!YYM.replayFlag){e.parent().find(".gzContHuifu").show();e.parent().find("#displayOrHide").html("隐藏");$(".yy-m-reply-block",c).slideDown();YYM.replayFlag=true}else{var o=e.parent().find(".gzContHuifu").length;e.parent().find(".gzContHuifu").each(function(q,r){if(q<o-2){$(this).hide()}});e.parent().find("#displayOrHide").html("显示");$(".yy-m-reply-block",c).slideUp();YYM.replayFlag=false}return true}function l(e){return true}function m(o){var r=o.attr("href"),q='<div class="yy-m-bigimg-block"><img src="'+r+'" /></div><div class="yy-m-imgmask" style="opacity: 0.2;"><span class="yy-m-bigimg-block-close">X</span></div>',e=$(q);e.appendTo(c);return true}function i(e){e.hide(100,function(){$(this).remove()});$("yy-m-bigimg-block").hide(100,function(){$(this).remove()});return true}function j(e){var o=e.attr("data-url");if(e.closest(".yy-main-list-block").length){$.mobile.changePage(o,{reverse:true})}return true}function n(e){$.mobile.changePage(YYM.baseUrl+"/speech/index/speech"+YYM.flag,{reverse:true,data:{}});return true}function g(e){p=YYM.baseUrl+"/api/feed/favorite";YYM._ajaxApi(p,function(q,o){if(q&&o==="success"){e.removeClass("yy-m-feed-collect").addClass("yy-m-feed-uncollect")}},"GET","json",{id:e.closest("section").attr("feed-id")});return true}function h(e){p=YYM.baseUrl+"/api/feed/favorite/cancel/1";YYM._ajaxApi(p,function(q,o){if(q&&o==="success"){e.removeClass("yy-m-feed-uncollect").addClass("yy-m-feed-collect")}},"GET","json",{id:e.closest("section").attr("feed-id")});return true}function b(e){p=YYM.baseUrl+"/api/feed/dropfeed";YYM._ajaxApi(p,function(q,o){if(q&&o==="success"){e.closest("section").closest("li").remove()}},"GET","json",{id:e.closest("section").attr("feed-id")});return true}}};YYM.View={};YYM.Moudle={};YYM.Moudle.interFace={replySubmit:function(c,b){var a=YYM.baseUrl+"/space/ajax/reply";YYM._ajaxApi(a,c,"POST","json",b)},voteSubmit:function(b,a){YYM._ajaxApi(YYM.baseUrl+"/vote/vote/voteOption",b,"POST","",a)},shield:function(b,a){YYM._ajaxApi(yyBaseurl+"/api/feed/hidden",b,"POST","json",a)},moreDetail:function(c,b,a){YYM._ajaxApi(a+YYM.flag,c,"GET","html",b)},scheduleInivte:function(b,a){$.getJSON(YYM.baseUrl+"/schedule/index/response/sid/"+a.val+"/accept/"+a.accept,null,b)},like:function(c,b){var a=YYM.baseUrl+"/api/feed/like"+(b.isCancel?"/cancel/1":"");YYM._ajaxApi(a,c,"GET","json",{id:b.id})}};YYM.Control={};var Interface=YYM.Moudle.interFace;YYM.Control.vote=$Tool.exec(function(){return{voteChoose:function(a){var c=a.parent().parent(),b=c.find(":button[value='投票']");if(c.find(":input:checked").size()>0){b.attr("class","button blueButton voteSubmit").removeAttr("disabled")}else{b.attr("class","button grayButton voteSubmit").attr("disabled","true")}},voteSubmit:function(b){var f=b,d=f.attr("vote_id"),c=f.attr("is_checkbox"),e="vote_id="+d;if(c==1){$("#voteBox"+d).find(":checkbox:checked[name='optionsub"+d+"[]']").each(function(){e+="&optionsub[]="+$(this).val()})}else{var a=$("#voteBox"+d).find(":radio:checked[name='optionsub"+d+"']").val();e+="&optionsub="+a}Interface.voteSubmit(function(g){$("#voteBox"+d).html(g)},e)}}});YYM.Control.reply=$Tool.exec(function(){function b(){$("textarea[role=replyContent]").val("");$("[id=yy-space-home-index]").toggle();$("[id=replyPage]").toggle();$("[id=footer_morefeed]").toggle();$("span:contains('后退')").parent().parent().toggle()}function i(){$("textarea[role=replyContent]").val("");$("[id=yy-space-home-index]").hide();$("[id=replyPage]").show();$("[id=footer_morefeed]").hide();$("span:contains('后退')").parent().parent().hide()}function d(){$("textarea[role=replyContent]").val("");$("[id=yy-space-home-index]").show();$("[id=replyPage]").hide();$("[id=footer_morefeed]").show();$("span:contains('后退')").parent().parent().show()}function a(j){$("[id=oldHead]").hide();$("[id=newHead]").show();$("[id=headText]").html("TO："+j);g=$("html").scrollTop(0);b();$("html").scrollTop(0)}function c(){$("[id=oldHead]").show();$("[id=newHead]").hide();b();$("html").scrollTop(g);$("[id=replyPage]").find("textarea").trigger("blur");$("[id=footer_morefeed]").show()}var f="";var e=0;var g="";var h={};return{show:function(j){f=j;e=j.attr("flag");var n=j.closest("section"),q=n.find(".reply-block"),r=q.length,m=j.closest("section[ele-role=oneMessage]");$hideDiv=m.find("div[role=hideVlaues]");var s=$(".yy-name",n),k=r?0:n.attr("resource-id"),l=s.attr("user-id"),p=s.html(),o=r?"":s.attr("href");$hideDiv.find('input[name="feed_reply_to_id"]').eq(0).val(k).siblings('input[name="feed_reply_to_mid"]').eq(0).val(l).siblings('input[name="feed_reply_to_name"]').eq(0).val(p).siblings('input[name="feed_reply_to_url"]').eq(0).val(o).find('input[name="fids"]').eq(0).val("").find(".yy-upload-file_containter").html("");h.id=$hideDiv.find('[name="qzfeed_id"]').eq(0).val(),h.feed_id=$hideDiv.find('[name="feed_id"]').eq(0).val(),h.feed_type=$hideDiv.find('[name="feed_type"]').eq(0).val(),h.feed_reply_to_id=$hideDiv.find('[name="feed_reply_to_id"]').eq(0).val(),h.feed_reply_to_mid=$hideDiv.find('[name="feed_reply_to_mid"]').eq(0).val(),h.feed_reply_to_name=$hideDiv.find('[name="feed_reply_to_name"]').eq(0).val(),h.feed_reply_fileids=$hideDiv.find('[name="feed_reply_fileids"]').eq(0).val(),h.feed_reply_obj_mid=$hideDiv.find('[name="feed_reply_obj_mid"]').eq(0).val(),h.feed_reply_fileids=$hideDiv.find('[name="fids"]').eq(0).val();a(p)},back:function(){c()},submit:function(){h.feed_reply_content=$("textarea[role=replyContent]").val();if(!h.feed_reply_content){return}Interface.replySubmit(function(n,k){if(n.error!=""){return}var m=$("#replyTemplete").html();n.data.costTime="1秒前";if(e==1){var l=f.closest("section").find("a[user-id]").parent().html().split("：")[0];n.data.nameReply=" 回复 "+l.split("回复")[0]}else{n.data.nameReply=""}var j=m.format(n.data);f.closest("section[ele-role=oneMessage]").append(j);f=null;c()},h)},getValue:function(){return h}}});YYM.Control.like=function(a){this.temp=a};YYM.Control.like.prototype={likeOrUnlike:function(a){var c=a,b;YYM.Moudle.interFace.like(function(g,f){if(g&&f==="success"){if(c.attr("ele-step")=="p"){var e=c.find("span");b=e.hasClass("yy-like-cancel");b?e.removeClass("iconNoAtt").addClass("iconAtt").attr("title","喜欢"):e.removeClass("iconAtt").addClass("iconNoAtt").attr("title","不喜欢了");e.toggleClass("yy-like-cancel")}else{b=c.hasClass("yy-like-cancel");b?c.removeClass("iconNoAtt").addClass("iconAtt").attr("title","喜欢"):c.removeClass("iconAtt").addClass("iconNoAtt").attr("title","不喜欢了");c.toggleClass("yy-like-cancel")}}},{id:c.closest("section").attr("feed-id"),isCancel:b});return false}};YYM.Control.detail=$Tool.exec(function(){return{deleteOne:function(a){var b=a.closest("li[ele-role=oneDetail]").remove();Interface.shield(function(){if(b.attr("type")=="detail"){location.href=yyBaseurl+"/space/home/index?"+YYM.flag}a=null;b=null},{id:a.attr("for")})},moreDetail:function(b){var f=b;f.html("加载中...");var h=f.attr("resource-id");var g=$("#yy-space-home-index").find("li[ele-role=oneDetail]");var c=g.last().find("section[ele-role=oneMessage]");var d=c.attr("feed-id");var a=c.attr("feed-updatetime");var e=$("#aside_att span.icor").length>0?$("#aside_att span.icor").attr("data"):"";YYM.Moudle.interFace.moreDetail(function(i){if(i.indexOf("nodata")>=0){f.html("没有更多内容了");f.die("click")}else{$("ul[id=yy-space-home-index]").append(i);f.html("查看更多>>")}},{offset:g.length,ajaxpend:1,fid:d,updatetime:a,filter:e,ajaxsubmit:1,_:new Date().getTime()},b.attr("data"))}}});YYM.Control.notice=function(a){this.temp=a};YYM.Control.notice.prototype={scheduleInvite:function(a){var c=a;var b={};b.accept=c.attr("name")=="acceptSchedule"?1:2;b.val=c.attr("data");YYM.Moudle.interFace.scheduleInivte(function(f,e){if(f&&e=="success"){c.parent().fadeOut()}else{}},b)}};(function(){$(document).bind("mobileinit",function(){$.mobile.page.prototype.options.backBtnText="后退";$.mobile.page.prototype.options.backBtnTheme="a";$.yy={};$.extend($.yy,{follow:function(d){var c=this;var b={setsId:"body",confirm:{txt:"加关注",css:"blueGz"},cancel:{txt:"取消关注",css:"grayGz"},callback:function(e,f,g){}};$.extend(b,d);$(b.setsId).find(".yy-follow").live("click",function(){var f=$(this);var e=0;if(f.hasClass(b.confirm.css)){e=1}$.mobile.loadingMessageTextVisible=false;$.mobile.showPageLoadingMsg();$.post(yyBaseurl+"/space/ajax/follow",{status:e,id:$(this).attr("for"),type:$(this).attr("role")},function(g){if(!g.rs){alert(g.error);return}f.toggleClass(b.confirm.css);f.toggleClass(b.cancel.css);var h="关注成功";if(e==0){h="已取消关注";f.html(b.confirm.txt)}else{f.html(b.cancel.txt)}$.mobile.hidePageLoadingMsg();b.callback(e,g,f)},"json");return false})}});$(".mobBox").live({tap:function(b){if(YYM.tapOrClick(this,b)){return false}},vclick:function(b){if(YYM.tapOrClick(this,b)){return false}},click:function(b){},vmousedown:function(g){var f=$(this),b=$(g.target),d=["yy-m-feed-reply","yy-m-feed-like","yy-m-feed-unlike","yy-m-feed-collect","yy-m-feed-uncollect","yy-m-feed-delete"];if(!YYM.hasOneOfClasses(b,d)){YYM.execCallback(b,"yy-m-content-block",c)}function c(e){if(e.closest(".yy-main-list-block").length){e.addClass("hover")}}},vmouseup:function(g){var f=$(this),b=$(g.target),d=["yy-m-feed-reply","yy-m-feed-like","yy-m-feed-unlike","yy-m-feed-collect","yy-m-feed-uncollect","yy-m-feed-delete"];if(!YYM.hasOneOfClasses(b,d)){YYM.execCallback(b,"yy-m-content-block",c)}function c(e){if(e.closest(".yy-main-list-block").length){e.removeClass("hover")}}},vmouseout:function(b){}});var a=0;$(document).live({vmouseup:function(f){var c=true;var b=$(f.target);var d=b.parent();if(b.attr("ele-role")=="reply"){YYM.Control.reply.show(b)}},tap:function(g){var c=true;var b=$(g.target);var f=b.parent();if(b.attr("vote")=="vote"){YYM.Control.vote.voteChoose(b)}if(b.attr("vote")=="voteSubmit"){YYM.Control.vote.voteSubmit(b)}if(b.attr("icon")=="iconLeft"){YYM.Control.reply.back(b)}if(b.attr("icon")=="iconRight"){YYM.Control.reply.submit(b)}if(b.attr("ele-role")=="like"){var d=new YYM.Control.like();d.likeOrUnlike(b)}if(b.attr("ele-role")=="delete"){YYM.Control.detail.deleteOne(b)}if(b.attr("ele-role")=="moreDetail"){YYM.Control.detail.moreDetail(b)}if(b.attr("name")=="acceptSchedule"||b.attr("name")=="refuseSchedule"){var d=new YYM.Control.notice();d.scheduleInvite(b)}if(c&&YYM.tapOrClick(this,g)){return false}}});$("[name='acceptTask'], [name='refuseTask']").live("click",function(){var c=$(this);var b=c.attr("name")=="acceptTask"?1:2;var d=c.attr("data");$.mobile.loadingMessageTextVisible=false;$.mobile.showPageLoadingMsg();$.getJSON(yyBaseurl+"/task/task/response/tid/"+d+"/accept/"+b,null,function(f,e){if(f&&f.type==="success"){c.parent().fadeOut()}else{}$.mobile.hidePageLoadingMsg()})});$.yy.follow({setsId:"#flowFile",cancel:{txt:"取消",css:"yy-follow-cancel"},callback:function(b,d,f){var e=f.attr("role");var c=f.attr("for");if(b==1&&d.rs){$('<span class="buttonBox"><a class="c3Link icoBluer" href="#">已关注</a> | <a class="yy-follow yy-follow-cancel" href="###" role="'+e+'" for="'+c+'">取消</a></span>').appendTo("#flowFile");f.remove()}else{if(b==0&&d.rs){$("#flowFile").html("");$('<a class="yy-follow button blueGz" role="'+e+'" for="'+c+'">加关注</a>').appendTo("#flowFile")}}}});$.yy.follow({setsId:"#follow-member",confirm:{txt:"关注",css:"gzButton"},callback:function(b,d,e){if(b==1&&d.rs){var f=e.attr("role"),c=e.attr("for");$('.yy-follow[role="'+f+'"][for="'+c+'"]',$("body")).remove()}}})})})();