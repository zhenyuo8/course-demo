$(document).ready(function(){$(".rcAddmenr").fancybox({onComplete:function(c){var f={};f=$(c).parent().parent().find(".rcAddmenListUl");var b=$(c).attr("for");$("#consoleBtn_"+b).bind("click",function(){if(b=="keywords"){self.searchMemberAdd($(this))}else{var h="";var e=$("#selectedContainter").find("figure");if(e.length<1){$("#msgNote").html("请选择人员!");return}for(var g=0;g<e.length;g++){var k=$(e[g]).attr("itemid");var j=$(e[g]).text().split("(");if($("#yyauto_li_"+k).length==0){h+='<li id="yyauto_li_'+k+'" class="clearfix rcAddmenListli"><span>'+j[0]+'</span><input type="hidden" value="'+k+'" name="'+b+'_value[]"><a class="close" href="javascript:;"></a></li>'}}$(f).prepend(h).find(".close").bind("click",function(){$(this).parent().remove()});$.fancybox.cancel();$.fancybox.close()}})}});$("#addannouncetype").live("click",function(){var g=$("#atypename").val();if(g==""){$.yy.rscallback("分类名称不能为空");return false}var f=$("input[name='manageuser_div_value[]']");var e=$("input[name='browseuser_div_value[]']");var j="",c="";f.each(function(){j+=$(this).val()+","});e.each(function(){c+=$(this).val()+","});if($("#is_public").attr("checked")){var k=1}else{var k=0;if(c.length==0){$.yy.rscallback("请添加浏览者");return false}}if($("#is_admin").attr("checked")=="checked"){var h=1}else{var h=0;if(j.length==0){$.yy.rscallback("请添加管理员");return false}}data="atypename="+g+"&ispublic="+k+"&publisher="+j+"&browser="+c+"&isadmin="+h;$.ajax({type:"POST",url:yyBaseurl+"/announce/act/atypeadd",data:data,success:function(b){if(b!=0){$.yy.rscallback("操作成功");window.location.reload();window.location.href="/announce/index/atypeadmin/"}else{if(b==0){$.yy.rscallback("操作失败")}}}})});$("#manageuser").live("click",function(){$("#manageuser_yy_dl").html("")});$("#manageuser").yyautocomplete({appendTo:"#manageuser_div",ajaxUrl:url("/common/search/ccnotice"),selAppendTo:"#manageuser_list",select:function(c,b){if(b.item){$("#manageuser_yy_dl").html("");$("#manageuser").val("");return false}}});$("#browseuser").live("click",function(){$("#browseuser_yy_dl").html("")});$("#browseuser").yyautocomplete({appendTo:"#browseuser_div",ajaxUrl:url("/common/search/ccnotice"),selAppendTo:"#browseuser_list",select:function(c,b){if(b.item){$("#browseuser_yy_dl").html("");$("#browseuser").val("");return false}}});$("#is_public").live("click",function(){$("#atypeblist").toggle()});var a=$("#is_publicval").val();if(a==0){$("#atypeblist").show()}$("#announcehandle").live("click",function(){var h=$("#atypename").val();var l=$("#is_public").val();var j=$("#is_admin").val();var f=$("#atid").val();var g=$("input[name='manageuser_div_value[]']");var e=$("input[name='browseuser_div_value[]']");var k="",c="";g.each(function(){k+=$(this).val()+","});e.each(function(){c+=$(this).val()+","});if($("#is_admin").attr("checked")=="checked"){j=1}else{j=0;if(k.length==0){$.yy.rscallback("请添加管理员");return false}}if($("#is_public").attr("checked")=="checked"){l=1}else{l=0;if(c.length==0){$.yy.rscallback("请添加浏览者");return false}}data="atypename="+h+"&ispublic="+l+"&atid="+f+"&publisher="+k+"&browser="+c+"&isadmin="+j;$.ajax({type:"POST",url:yyBaseurl+"/announce/act/atypeadd",data:data,success:function(b){if(b!=0||f){$.yy.rscallback("操作成功");window.location.href="/announce/index/atypeadmin/"}else{if(b==0){$.yy.rscallback("操作失败")}}}})});$(".feed-delete-confirm").live("click",function(){var c=$(this);var b=c.attr("aid");var e=c.attr("announceid");if(b){data="aid="+b;$.ajax({type:"POST",url:yyBaseurl+"/announce/act/delatype",data:data,success:function(f){if(f==1){$.yy.rscallback("操作成功");window.location.reload()}else{if(f==0){$.yy.rscallback("操作失败")}else{if(f==2){$.yy.rscallback("操作失败,该分类含有公告不能删除")}}}}})}if(e){data="id="+e;$.ajax({type:"POST",url:yyBaseurl+"/announce/act/delannounce",data:data,success:function(f){if(f==1){$.yy.rscallback("操作成功");window.location.reload()}else{if(f==0){$.yy.rscallback("操作失败")}}}})}});$("#publish").live("click",function(){var n=$("#title").val();var h=$("#atype_id").val();var l=$("#content").val();if(n==""){$.yy.rscallback("标题不能为空");return false}if(l==""){$.yy.rscallback("内容不能为空");return false}var p=$("#dept_id").val();var e=$("#deptname").val();var m=$("#phone").val();var f=$("input[name='allowcomment']:checked").val();var o=$("input[name='sticky']:checked").val();var g=1;var b="/announce/act/announceadd";var c=$("#qz_id").val();var k="发布";var j=$("#fids").val();$(this).attr("disabled",true);saveAnnounce(h,n,l,p,e,m,f,o,g,b,k,0,c,j)});$("#draft").live("click",function(){var h=$("#atype_id").val();var n=$("#title").val();var l=$("#content").val();var p=$("#dept_id").val();var e=$("#deptname").val();var m=$("#phone").val();var f=$("input[name='allowcomment']:checked").val();var o=$("input[name='sticky']:checked").val();var g=0;var b="/announce/act/announceadd";var c=$("#qz_id").val();var k="保存草稿";var j=$("#fids").val();saveAnnounce(h,n,l,p,e,m,f,o,g,b,k,0,c,j)});$("#preview").live("click",function(){$.fancybox({padding:0,autoScale:true,centerOnScroll:true,overlayShow:true,showCloseButton:false,scrolling:"no",height:"600px",href:yyBaseurl+"/announce/act/announceaddbox/",onComplete:function(){request_url=yyBaseurl+"/announce/act/announceaddbox/";submitData={atype_id:$("#atype_id").val(),atype:$("#atype_id").find("option:selected").text(),title:$("#title").val(),deptname:$("#deptname").val(),phone:$("#phone").val(),allowcomment:$("input[name='allowcomment']:checked").val(),fids:$("#fids").val(),content:$("#content").val()};YY.util.ajaxApi(request_url,function(b){$("#previewan").html(b)},"POST","HTML",submitData)}});return false});$("#update").live("click",function(){var o=$("#title").val();var j=$("#atype_id").val();var m=$("#content").val();if(o==""){$.yy.rscallback("标题不能为空");return false}if(m==""){$.yy.rscallback("内容不能为空");return false}var q=$("#dept_id").val();var f=$("#deptname").val();var n=$("#phone").val();var g=$("input[name='allowcomment']:checked").val();var p=$("input[name='sticky']:checked").val();var h=$("#status").val();var e=$("#announceid").val();var b="/announce/act/announceadd";var c=$("#qz_id").val();var l="更新";var k=$("#fids").val();saveAnnounce(j,o,m,q,f,n,g,p,h,b,l,e,c,k)});$(".upJl").live("click",function(){$("#showalog").toggle()});$(".cz01").live("click",function(){var e=$(this);var c=e.attr("aid");var b=$("#atype").val();if(c){saveStatus(c,"status",2,"updatepublish","撤销",b)}});$(".cz05").live("click",function(){var e=$(this);var c=e.attr("aid");var b=$("#atype").val();if(c){saveStatus(c,"status",1,"updatepublish","发布",b)}});$(".cz02").live("click",function(){var e=$(this);var c=e.attr("aid");var b=$("#atype").val();if(c){saveStatus(c,"sticky",0,"updatesticky","取消置顶",b)}});$(".cz06").live("click",function(){var e=$(this);var c=e.attr("aid");var b=$("#atype").val();if(c){saveStatus(c,"sticky",1,"updatesticky","置顶",b)}});$(".plDetList li:not(:first)").mouseover(function(){$(this).addClass("liHover")});$(".plDetList li").mouseout(function(){$(this).removeClass("liHover")});$("table.xheLayout").css({width:"572"});$(".sTabMenu .relative").mouseover(function(){$("#moretype").show()});$(".sTabMenu .relative").mouseout(function(){$("#moretype").hide()});$(".zsDown").live("click",function(){var b=$(this).attr("atid");var c=$(this).attr("weight");if(b){data="atid="+b+"&add=1&weight="+c;$.ajax({type:"POST",url:yyBaseurl+"/announce/act/updateweight",data:data,success:function(e){if(e==1){$.yy.rscallback("操作成功");window.location.reload()}else{if(e==0){$.yy.rscallback("操作失败")}}}})}});$(".zsUp").live("click",function(){var b=$(this).attr("atid");var c=$(this).attr("weight");if(b){data="atid="+b+"&add=0&weight="+c;$.ajax({type:"POST",url:yyBaseurl+"/announce/act/updateweight",data:data,success:function(e){if(e==1){$.yy.rscallback("操作成功");window.location.reload()}else{if(e==0){$.yy.rscallback("操作失败")}}}})}});$(".yy-file-upload-ico").mouseover(function(){var b=(new Date()).getTime();var c=$(this).closest("section").find(".yy-file-uploadbtn");c.attr("id",b);YY.util.initUpload(function(){new InitUpload({button_placeholder_id:b,upload_url:YY.util.url("/file/act/swfupload/fileFrom/")+20+"/gid/"+c.find('input[name="file_group_id"]').eq(0).val()})})});$("#title").live("blur",function(){var g=$("#title");var e=g.val();if(!e){e=""}e=$.trim(e);var b=0;for(var f=0;f<e.length;f++){var h=e.charCodeAt(f);if((h>=1&&h<=126)||(65376<=h&&h<=65439)){b++}else{b+=2}}if(b>80){$.yy.rscallback("公告标题不能超过40个汉字",1);g.css("color","red");$("#publish").attr("disabled",true)}else{g.removeAttr("style");$("#publish").attr("disabled",false)}})});function saveAnnounce(h,n,l,p,e,m,f,o,g,a,k,c,b,j){data="atype_id="+h+"&title="+encodeURIComponent(n)+"&dept_id="+p+"&deptname="+e+"&phone="+m+"&allowcomment="+f+"&sticky="+o+"&status="+g+"&id="+c+"&qz_id="+b+"&fids="+j+"&content="+encodeURIComponent(l);$.ajax({type:"POST",url:yyBaseurl+a,data:data,success:function(q){if(q!=0){$("#announceid").val(q);if(k!=""){$.yy.rscallback(k+"成功");if(k=="发布"){window.location.href="/announce/index/announceadmin/atype/"+h}else{if(k=="保存草稿"){window.location.href="/announce/index/announceadmin/flag/draft"}else{if(k=="更新"){if(g==0){window.location.href="/announce/index/announceadmin/flag/draft"}else{window.location.href="/announce/index/announceadmin/atype/"+h}}}}}}else{if(q==0){if(k!=""){$.yy.rscallback(k+"失败")}}}}});return d}function saveStatus(c,e,g,b,f,a){data="id="+c+"&"+e+"="+g+"&atype="+a;$.ajax({type:"POST",url:yyBaseurl+"/announce/act/"+b,data:data,success:function(h){if(h>0){if(f!=""){$.yy.rscallback(f+"成功");window.location.reload()}}else{if(h==0){if(f!=""){$.yy.rscallback(f+"失败")}}else{if(h==-1){if(f=="置顶"){$.yy.rscallback(f+"失败，每个分类置顶不能超过三个")}}}}}})}function delafile(c){$("#afile"+c).hide();var b=$("#fids").val();b=b.split(",");if(b==c){$("#fids").val("");return}else{var a="";for(i=0;i<b.length;i++){if(b[i]!=c){a+=b[i]+","}}a=a.replace(/,$/,"")}$("#fids").val(a)}$(".cz04").live("click",function(){$(this).closest("div").find(".yy-delete:first").trigger("click")});var tv1=10,tv2=10;$(".yy-delete").live("click",function(){var a=$(this);clearTimeout(tv1);tv2=setTimeout(function(){a.children(".delTk").length?a.children(".delTk").removeClass("hidden"):a.append('<aside class="delTk">确定要删除该文档？<br/><a href="#yy-delete-confirm" class="yy-delete-confirm">删除</a> <a href="#yy-delete-cancel" class="yy-delete-cancel">不删除</a><span class="sj xsj"></span></aside>');$(".yy-file-operate-list").trigger("mouseleave");a.closest("td").removeClass("yy-file-operate-list")},300)});$(".yy-delete-cancel").live("click",function(){var a=$(this);a.closest(".delTk").addClass("hidden");$(this).closest("td").addClass("yy-file-operate-list");return false});setTimeout(function(){$("#xhe0_iframearea").css({height:"295"})},100);