(function(c,a){var f=Date.parse;var i=new Date();var e={year:i.getFullYear(),month:i.getMonth()+1,day:i.getDate(),week:d(i.getDay())};e.timestamp=f(e.month+"/"+e.day+"/"+e.year);var g=86400000;function d(j){return j?j:7}function b(j){j=j.toString();return j.length<2?"0"+j:j}function h(j){var l=this;var m={selector:"",day_attr:null,rel:a.util.url("/space/ajax/calendar/iscalendar/1/date/")};j=l.options=c.extend(m,j);m=null;var n=c(j.selector);var k=h.prototype;if(typeof l.init!=="function"){k.init=function(){var o=this;o.setDate(e.timestamp);o.render();o.bindEvents()};k.getCalendar=function(){var o=this;return'<div class="riliSmall">'+o.getHeader()+o.getMainBody()+"</div>"};k.getHeader=function(){var p=this,o=p.year,q=p.month;return'<header class="clearfix today new_rili_head"><p class="fl year alignCenter"><a class="icoLeft yy-prev-month" href="#"></a><span>'+o+"年"+q+'月</span><a class="icoRt yy-next-month" href="#"></a></p></header><div class="new_rili_title"><ul><li>M</li><li>T</li><li>W</li><li>T</li><li>F</li><li>S</li><li>S</li></ul></div>'};k.getMainBody=function(){var z=this;var p=z.date_arr,s=z.date,B=e.day,C=z.hasToday(s[0],s[1]),D=[];var o=j.day_attr;if(o&&typeof o==="object"){var r="";c.each(o,function(t,F){r+=t+'="'+F+'" '})}var u=0,E=0,q=0;for(var v=0,w=p.length;v<w;v++){u=(u===7)?0:u;E=p[v];q=Math.abs(E);var y=z.year,x=z.month,A=b(q);x=E>0?x:(A>10?(x-1):(x+1));switch(x){case 0:x="12";y--;break;case 13:x="01";y++;break;default:x=b(x);break}D[v]=(u===0?"<ul>":"")+"<li "+r+' rel="'+j.rel+y+x+A+'" class="'+(E>0?"":"c6")+(C&&B===E?' redBor">':'">')+q+"</li>"+(u===6?"</ul>":"");u++}return'<div class="new_rili_data clearfix">'+D.join("")+"</div>"};k.hasToday=function(p,o){var q=e.timestamp;return !!(q>=p&&q<o)};k.setDate=function(t){var s=this,u,r;var p=typeof s.date!=="undefined"?s.date:[0,0];if(t<p[0]||t>=p[1]){var o=s.getDateObj(t);s.year=o.getFullYear();s.month=o.getMonth()+1}else{s.year=e.year;s.month=e.month}var u=s.month,r=s.year,v=u+1,q=r;if(v===13){v=1;q+=1}p[0]=f(u+"/1/"+r);p[1]=f(v+"/1/"+q);s.date=p};k.getDateObj=function(o){return o?new Date(o):new Date()};k.nextMonth=function(){var o=this;o.setDate(o.date[1]);o.render()};k.prevMonth=function(){var o=this;o.setDate(o.date[0]-g);o.render()};k.render=function(){var p=this;p.setDateArr();var o=p.getCalendar();n.html(o)};k.fixDate=function(u,q){var s=this;var p=s.getDateObj(u),t=d(p.getDay()),o=s.getDateObj(q),r=d(o.getDay());return[u-(t-1)*g,q+(8-r)*g]};k.setDateArr=function(){var E=this;var B=E.date,u=B[0],s=B[1];var t=E.fixDate(u,s),o=t[0],p=t[1];var q=E.getDateObj(s-g),r=q.getDate(),y=(u-o)/g,x=(p-s)/g;var F=typeof E.date_arr!=="undefined"?E.date_arr:[];E.date_arr=F;var A=(r+y+x)<42?true:false;var z=0;if(y){var w=E.getDateObj(o),v=w.getDate();while(y--){F[z++]=-v++}}for(var D=1;D<=r;D++){F[z++]=D}if(x){for(var C=1;C<=x;C++){F[z++]=-C}}if(A){for(;z<42;z++){F[z]=-C++}}};k.bindEvents=function(){var o=this;n.live({click:function(q){var p=c(q.target);if(p.closest(".yy-prev-month").length){o.prevMonth();return false}else{if(p.closest(".yy-next-month").length){o.nextMonth();return false}}}})}}}a.MiniCalendar=h}(jQuery,YY));