function ubb2html(j){function h(c){return null!=c&&""!=c?!isNaN(c):!1}var d,f=[],i=0,a="10px,13px,16px,18px,24px,32px,48px".split(",");d=(""+j).replace(/[<>&"]/g,function(c){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[c]});d=d.replace(/\r?\n/g,"<br />");d=d.replace(/\[code\s*(?:=\s*([^\]]+?))?\]([\s\S]*?)\[\/code\]/ig,function(c){i++;f[i]=c;return"[\tubbcodeplace_"+i+"\t]"});d=d.replace(/\[(\/?)(b|u|i|s|sup|sub)\]/ig,"<$1$2>");d=d.replace(/\[color\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/ig,'<font color="$1">');d=d.replace(/\[font\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/ig,'<font face="$1">');d=d.replace(/\[\/(color|font)\]/ig,"</font>");d=d.replace(/\[size\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/ig,function(c,e){e.match(/^\d+$/)&&(e=a[e-1]);return'<span style="font-size:'+e+';">'});d=d.replace(/\[back\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/ig,'<span style="background-color:$1;">');d=d.replace(/\[\/(size|back)\]/ig,"</span>");for(j=0;3>j;j++){d=d.replace(/\[align\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\](((?!\[align(?:\s+[^\]]+)?\])[\s\S])*?)\[\/align\]/ig,'<p align="$1">$2</p>')}d=d.replace(/\[img\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/img\]/ig,'<img src="$1" alt="" />');d=d.replace(/\[img\s*=([^,\]]*)(?:\s*,\s*(\d*%?)\s*,\s*(\d*%?)\s*)?(?:,?\s*(\w+))?\s*\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*)?\s*\[\/img\]/ig,function(g,k,o,l,n,m){g='<img src="'+m+'" alt="'+k+'"';n=n?n:!h(o)?o:"";h(o)&&(g+=' width="'+o+'"');h(l)&&(g+=' height="'+l+'"');n&&(g+=' align="'+n+'"');return g+" />"});d=d.replace(/\[emot\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\/\]/ig,'<img emot="$1" />');d=d.replace(/\[url\]\s*(((?!")[\s\S])*?)(?:"[\s\S]*?)?\s*\[\/url\]/ig,'<a href="$1">$1</a>');d=d.replace(/\[url\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]\s*([\s\S]*?)\s*\[\/url\]/ig,'<a href="$1">$2</a>');d=d.replace(/\[email\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/email\]/ig,'<a href="mailto:$1">$1</a>');d=d.replace(/\[email\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]\s*([\s\S]+?)\s*\[\/email\]/ig,'<a href="mailto:$1">$2</a>');d=d.replace(/\[quote\]/ig,"<blockquote>");d=d.replace(/\[\/quote\]/ig,"</blockquote>");d=d.replace(/\[flash\s*(?:=\s*(\d+)\s*,\s*(\d+)\s*)?\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/flash\]/ig,function(g,k,m,l){k||(k=480);m||(m=400);return'<embed type="application/x-shockwave-flash" src="'+l+'" wmode="opaque" quality="high" bgcolor="#ffffff" menu="false" play="true" loop="true" width="'+k+'" height="'+m+'"/>'});d=d.replace(/\[media\s*(?:=\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+)\s*)?)?\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/media\]/ig,function(k,l,o,n,m){l||(l=480);o||(o=400);return'<embed type="application/x-mplayer2" src="'+m+'" enablecontextmenu="false" autostart="'+("1"==n?"true":"false")+'" width="'+l+'" height="'+o+'"/>'});d=d.replace(/\[table\s*(?:=\s*(\d{1,4}%?)\s*(?:,\s*([^\]"]+)(?:"[^\]]*?)?)?)?\s*\]/ig,function(e,g,k){e="<table";g&&(e+=' width="'+g+'"');k&&(e+=' bgcolor="'+k+'"');return e+">"});d=d.replace(/\[tr\s*(?:=\s*([^\]"]+?)(?:"[^\]]*?)?)?\s*\]/ig,function(c,e){return"<tr"+(e?' bgcolor="'+e+'"':"")+">"});d=d.replace(/\[td\s*(?:=\s*(\d{1,2})\s*,\s*(\d{1,2})\s*(?:,\s*(\d{1,4}%?))?)?\s*\]/ig,function(g,k,m,l){return"<td"+(1<k?' colspan="'+k+'"':"")+(1<m?' rowspan="'+m+'"':"")+(l?' width="'+l+'"':"")+">"});d=d.replace(/\[\/(table|tr|td)\]/ig,"</$1>");d=d.replace(/\[\*\]((?:(?!\[\*\]|\[\/list\]|\[list\s*(?:=[^\]]+)?\])[\s\S])+)/ig,"<li>$1</li>");d=d.replace(/\[list\s*(?:=\s*([^\]"]+?)(?:"[^\]]*?)?)?\s*\]/ig,function(e,g){var k="<ul";g&&(k+=' type="'+g+'"');return k+">"});d=d.replace(/\[\/list\]/ig,"</ul>");d=d.replace(/\[hr\/\]/ig,"<hr />");for(j=1;j<=i;j++){d=d.replace("[\tubbcodeplace_"+j+"\t]",f[j])}return d=d.replace(/(^|<\/?\w+(?:\s+[^>]*?)?>)([^<$]+)/ig,function(e,g,k){return g+k.replace(/[\t ]/g,function(b){return{"\t":"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"," ":"&nbsp;"}[b]})})}function html2ubb(t){function r(b,l,e,j){if(!e){return j}var b=[],l=[],g;if(g=e.match(/ face\s*=\s*"\s*([^"]+)\s*"/i)){b.push("[font="+g[1]+"]"),l.push("[/font]")}if(g=e.match(/ size\s*=\s*"\s*(\d+)\s*"/i)){b.push("[size="+g[1]+"]"),l.push("[/size]")}if(g=e.match(/ color\s*=\s*"\s*([^"]+)\s*"/i)){b.push("[color="+u(g[1])+"]"),l.push("[/color]")}return b.join("")+j+l.join("")}function u(e){var c;if(c=e.match(/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i)){for(e=(65536*c[1]+256*c[2]+1*c[3]).toString(16);6>e.length;){e="0"+e}e="#"+e}return e=e.replace(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,"#$1$1$2$2$3$3")}var k=/\s+src\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i,s=/\s+width\s*=\s*(["']?)\s*(\d+(?:\.\d+)?%?)\s*\1(\s|$)/i,i=/\s+height\s*=\s*(["']?)\s*(\d+(?:\.\d+)?%?)\s*\1(\s|$)/i,h=/(?:background|background-color|bgcolor)\s*[:=]\s*(["']?)\s*((rgb\s*\(\s*\d{1,3}%?,\s*\d{1,3}%?\s*,\s*\d{1,3}%?\s*\))|(#[0-9a-f]{3,6})|([a-z]{1,20}))\s*\1/i,v,f=[],q=0;v=(""+t).replace(/\s*\r?\n\s*/g,"");v=v.replace(/<(script|style)(\s+[^>]*?)?>[\s\S]*?<\/\1>/ig,"");v=v.replace(/<\!--[\s\S]*?--\>/ig,"");v=v.replace(/<br(\s+[^>]*)?\/?>/ig,"\r\n");v=v.replace(/\[code\s*(=\s*([^\]]+?))?\]([\s\S]*?)\[\/code\]/ig,function(b){q++;f[q]=b;return"[\tubbcodeplace_"+q+"\t]"});v=v.replace(/<(\/?)(b|u|i|s)(\s+[^>]*?)?>/ig,"[$1$2]");v=v.replace(/<(\/?)strong(\s+[^>]*?)?>/ig,"[$1b]");v=v.replace(/<(\/?)em(\s+[^>]*?)?>/ig,"[$1i]");v=v.replace(/<(\/?)(strike|del)(\s+[^>]*?)?>/ig,"[$1s]");v=v.replace(/<(\/?)(sup|sub)(\s+[^>]*?)?>/ig,"[$1$2]");v=v.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,r);v=v.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/ig,r);v=v.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/ig,r);for(t=0;3>t;t++){v=v.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)*\s*(?:font-family|font-size|color|background|background-color)\s*:[^"]*)"(?: [^>]+)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,function(b,o,j,n){var b=j.match(/(?:^|;)\s*font-family\s*:\s*([^;]+)/i),o=j.match(/(?:^|;)\s*font-size\s*:\s*([^;]+)/i),l=j.match(/(?:^|;)\s*color\s*:\s*([^;]+)/i),j=j.match(/(?:^|;)\s*(?:background|background-color)\s*:\s*([^;]+)/i),m=[],g=[];b&&(m.push("[font="+b[1]+"]"),g.push("[/font]"));o&&(m.push("[size="+o[1]+"]"),g.push("[/size]"));l&&(m.push("[color="+u(l[1])+"]"),g.push("[/color]"));j&&(m.push("[back="+u(j[1])+"]"),g.push("[/back]"));return m.join("")+n+g.join("")})}for(t=0;3>t;t++){v=v.replace(/<(div|p)(?:\s+[^>]*?)?[\s"';]\s*(?:text-)?align\s*[=:]\s*(["']?)\s*(left|center|right)\s*\2[^>]*>(((?!<\1(\s+[^>]*?)?>)[\s\S])+?)<\/\1>/ig,"[align=$3]$4[/align]")}for(t=0;3>t;t++){v=v.replace(/<(center)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/ig,"[align=center]$2[/align]")}for(t=0;3>t;t++){v=v.replace(/<(p|div)(?:\s+[^>]*?)?\s+style\s*=\s*"(?:[^;"]*;)*\s*text-align\s*:([^;"]*)[^"]*"(?: [^>]+)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,function(g,e,l,j){return"[align="+l+"]"+j+"[/align]"})}v=v.replace(/<a(?:\s+[^>]*?)?\s+href=(["'])\s*(.+?)\s*\1[^>]*>\s*([\s\S]*?)\s*<\/a>/ig,function(g,e,l,j){if(!l||!j){return""}g="url";l.match(/^mailto:/i)&&(g="email",l=l.replace(/mailto:(.+?)/i,"$1"));e="["+g;l!=j&&(e+="="+l);return e+"]"+j+"[/"+g+"]"});v=v.replace(/<img(\s+[^>]*?)\/?>/ig,function(j,e){var w=e.match(/\s+emot\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i);if(w){return"[emot="+w[2]+"/]"}var w=e.match(k),p=e.match(/\s+alt\s*=\s*(["']?)\s*(.*?)\s*\1(\s|$)/i),o=e.match(s),m=e.match(i),l=e.match(/\s+align\s*=\s*(["']?)\s*(\w+)\s*\1(\s|$)/i),n="[img";if(!w){return""}p=""+p[2];if(o||m){p+=","+(o?o[2]:"")+","+(m?m[2]:"")}l&&(p+=","+l[2]);p&&(n+="="+p);return n+="]"+w[2]+"[/img]"});v=v.replace(/<blockquote(?:\s+[^>]*?)?>/ig,"[quote]");v=v.replace(/<\/blockquote>/ig,"[/quote]");v=v.replace(/<embed((?:\s+[^>]*?)?(?:\s+type\s*=\s*"\s*application\/x-shockwave-flash\s*"|\s+classid\s*=\s*"\s*clsid:d27cdb6e-ae6d-11cf-96b8-4445535400000\s*")[^>]*?)\/?>/ig,function(g,e){var n=e.match(k),m=e.match(s),l=e.match(i),j="[flash";if(!n){return""}m&&l&&(j+="="+m[2]+","+l[2]);j+="]"+n[2];return j+"[/flash]"});v=v.replace(/<embed((?:\s+[^>]*?)?(?:\s+type\s*=\s*"\s*application\/x-mplayer2\s*"|\s+classid\s*=\s*"\s*clsid:6bf52a52-394a-11d3-b153-00c04f79faa6\s*")[^>]*?)\/?>/ig,function(l,e){var x=e.match(k),w=e.match(s),p=e.match(i),n=e.match(/\s+autostart\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i),o="[media",m="0";if(!x){return""}n&&"true"==n[2]&&(m="1");w&&p&&(o+="="+w[2]+","+p[2]+","+m);o+="]"+x[2];return o+"[/media]"});v=v.replace(/<table(\s+[^>]*?)?>/ig,function(g,e){var m="[table";if(e){var l=e.match(s),j=e.match(h);l&&(m+="="+l[2],j&&(m+=","+j[2]))}return m+"]"});v=v.replace(/<tr(\s+[^>]*?)?>/ig,function(g,e){var l="[tr";if(e){var j=e.match(h);j&&(l+="="+j[2])}return l+"]"});v=v.replace(/<(?:th|td)(\s+[^>]*?)?>/ig,function(j,e){var o="[td";if(e){var n=e.match(/\s+colspan\s*=\s*(["']?)\s*(\d+)\s*\1(\s|$)/i),m=e.match(/\s+rowspan\s*=\s*(["']?)\s*(\d+)\s*\1(\s|$)/i),l=e.match(s),n=n?n[2]:1,m=m?m[2]:1;if(1<n||1<m||l){o+="="+n+","+m}l&&(o+=","+l[2])}return o+"]"});v=v.replace(/<\/(table|tr)>/ig,"[/$1]");v=v.replace(/<\/(th|td)>/ig,"[/td]");v=v.replace(/<ul(\s+[^>]*?)?>/ig,function(g,e){var j;e&&(j=e.match(/\s+type\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i));return"[list"+(j?"="+j[2]:"")+"]"});v=v.replace(/<ol(\s+[^>]*?)?>/ig,"[list=1]");v=v.replace(/<li(\s+[^>]*?)?>/ig,"[*]");v=v.replace(/<\/li>/ig,"");v=v.replace(/<\/(ul|ol)>/ig,"[/list]");v=v.replace(/<h([1-6])(\s+[^>]*?)?>/ig,function(e,c){return"\r\n\r\n[size="+(7-c)+"][b]"});v=v.replace(/<\/h[1-6]>/ig,"[/b][/size]\r\n\r\n");v=v.replace(/<address(\s+[^>]*?)?>/ig,"\r\n[i]");v=v.replace(/<\/address>/ig,"[i]\r\n");v=v.replace(/<hr(\s+[^>]*?)?\/>/ig,"[hr/]");for(t=0;3>t;t++){v=v.replace(/<(p)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,"\r\n\r\n$2\r\n\r\n")}for(t=0;3>t;t++){v=v.replace(/<(div)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,"\r\n$2\r\n")}v=v.replace(/((\s|&nbsp;)*\r?\n){3,}/g,"\r\n\r\n");v=v.replace(/^((\s|&nbsp;)*\r?\n)+/g,"");v=v.replace(/((\s|&nbsp;)*\r?\n)+$/g,"");for(t=1;t<=q;t++){v=v.replace("[\tubbcodeplace_"+t+"\t]",f[t])}v=v.replace(/<[^<>]+?>/g,"");var d={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};v=v.replace(/&(lt|gt|nbsp|amp|quot);/ig,function(e,c){return d[c]});return v=v.replace(/\[([a-z]+)(?:=[^\[\]]+)?\]\s*\[\/\1\]/ig,"")};